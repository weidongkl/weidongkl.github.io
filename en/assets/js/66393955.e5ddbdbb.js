"use strict";(self.webpackChunkweidongkl_github_io=self.webpackChunkweidongkl_github_io||[]).push([[1325],{30453:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>t,contentTitle:()=>i,default:()=>a,frontMatter:()=>s,metadata:()=>c,toc:()=>o});const c=JSON.parse('{"id":"note/os/container/docker/docker_net_err","title":"Docker \u7f51\u7edc \u65e0\u6cd5\u8fde\u63a5\u8fdc\u7a0b IP \u7684\u95ee\u9898\u5b9a\u4f4d","description":"1. \u95ee\u9898\u80cc\u666f","source":"@site/docs/note/os/container/docker/docker_net_err.md","sourceDirName":"note/os/container/docker","slug":"/note/os/container/docker/docker_net_err","permalink":"/en/docs/note/os/container/docker/docker_net_err","draft":false,"unlisted":false,"editUrl":"https://github.com/weidongkl/weidongkl.github.io/tree/master/docs/note/os/container/docker/docker_net_err.md","tags":[],"version":"current","lastUpdatedBy":"weidongkl","lastUpdatedAt":1763901202000,"frontMatter":{},"sidebar":"note","previous":{"title":"Docker \u955c\u50cf\u4fe1\u606f\u7ba1\u7406","permalink":"/en/docs/note/os/container/docker/docker_info"},"next":{"title":"\u591a\u67b6\u6784\u5bb9\u5668\u955c\u50cf\u6784\u5efa","permalink":"/en/docs/note/os/container/multiarch_container"}}');var r=d(74848),l=d(28453);const s={},i="Docker \u7f51\u7edc \u65e0\u6cd5\u8fde\u63a5\u8fdc\u7a0b IP \u7684\u95ee\u9898\u5b9a\u4f4d",t={},o=[{value:"1. \u95ee\u9898\u80cc\u666f",id:"1-\u95ee\u9898\u80cc\u666f",level:2},{value:"2. \u95ee\u9898\u5206\u6790\u8fc7\u7a0b",id:"2-\u95ee\u9898\u5206\u6790\u8fc7\u7a0b",level:2},{value:"2.1 Docker build \u9ed8\u8ba4\u7f51\u7edc\u73af\u5883",id:"21-docker-build-\u9ed8\u8ba4\u7f51\u7edc\u73af\u5883",level:3},{value:"2.2 \u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc\u9a8c\u8bc1",id:"22-\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc\u9a8c\u8bc1",level:3},{value:"2.3 \u68c0\u67e5 NAT \u8f6c\u53d1\u94fe\u8868\uff08iptables\uff09",id:"23-\u68c0\u67e5-nat-\u8f6c\u53d1\u94fe\u8868iptables",level:3},{value:"2.4 \u91cd\u542f Docker \u670d\u52a1",id:"24-\u91cd\u542f-docker-\u670d\u52a1",level:3},{value:"2.5 \u518d\u6b21\u6d4b\u8bd5\u5bb9\u5668\u7f51\u7edc\u8bbf\u95ee",id:"25-\u518d\u6b21\u6d4b\u8bd5\u5bb9\u5668\u7f51\u7edc\u8bbf\u95ee",level:3},{value:"3. \u95ee\u9898\u603b\u7ed3",id:"3-\u95ee\u9898\u603b\u7ed3",level:2},{value:"4. \u540e\u7eed\u5efa\u8bae",id:"4-\u540e\u7eed\u5efa\u8bae",level:2},{value:"4.1 \u5207\u6362\u4e3a iptables-legacy",id:"41-\u5207\u6362\u4e3a-iptables-legacy",level:3},{value:"4.2 \u68c0\u67e5\u9632\u706b\u5899\u548c\u5b89\u5168\u7b56\u7565",id:"42-\u68c0\u67e5\u9632\u706b\u5899\u548c\u5b89\u5168\u7b56\u7565",level:3},{value:"4.3 \u7a33\u5b9a\u6027\u5efa\u8bae",id:"43-\u7a33\u5b9a\u6027\u5efa\u8bae",level:3}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"docker-\u7f51\u7edc-\u65e0\u6cd5\u8fde\u63a5\u8fdc\u7a0b-ip-\u7684\u95ee\u9898\u5b9a\u4f4d",children:"Docker \u7f51\u7edc \u65e0\u6cd5\u8fde\u63a5\u8fdc\u7a0b IP \u7684\u95ee\u9898\u5b9a\u4f4d"})}),"\n",(0,r.jsx)(n.h2,{id:"1-\u95ee\u9898\u80cc\u666f",children:"1. \u95ee\u9898\u80cc\u666f"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u8fdb\u884c\u955c\u50cf\u6784\u5efa\u65f6\uff0c",(0,r.jsx)(n.code,{children:"Dockerfile"})," \u4e2d\u5305\u542b\u5982\u4e0b\u547d\u4ee4\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"RUN curl http://<\u8fdc\u7a0bIP>:<\u7aef\u53e3>/something\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u73b0\u8c61\u5982\u4e0b\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5bbf\u4e3b\u673a\u4e0a\u6267\u884c curl \u80fd\u6b63\u5e38\u8fde\u63a5\uff1b"}),"\n",(0,r.jsx)(n.li,{children:"\u5728\u6267\u884c docker build \u65f6\uff0c\u62a5 curl: connection timed out\uff1b"}),"\n",(0,r.jsx)(n.li,{children:"\u521d\u6b65\u5224\u65ad\u662f\u6784\u5efa\u8fc7\u7a0b\u4e2d\u5bb9\u5668\u7684\u7f51\u7edc\u65e0\u6cd5\u8fde\u63a5\u5230\u8fdc\u7a0b IP\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"2-\u95ee\u9898\u5206\u6790\u8fc7\u7a0b",children:"2. \u95ee\u9898\u5206\u6790\u8fc7\u7a0b"}),"\n",(0,r.jsx)(n.h3,{id:"21-docker-build-\u9ed8\u8ba4\u7f51\u7edc\u73af\u5883",children:"2.1 Docker build \u9ed8\u8ba4\u7f51\u7edc\u73af\u5883"}),"\n",(0,r.jsx)(n.p,{children:"Docker build \u9ed8\u8ba4\u4f7f\u7528 Docker \u7684\u9694\u79bb\u7f51\u7edc\uff08\u5982 bridge \u6a21\u5f0f\uff09\u8fdb\u884c\u6784\u5efa\u3002\u8be5\u7f51\u7edc\u4e0e\u5bbf\u4e3b\u673a\u9694\u79bb\uff0c\u4f7f\u7528 NAT \u8f6c\u53d1\u89c4\u5219\u4e0e\u5916\u754c\u901a\u4fe1\u3002\u5bb9\u5668\u4e2d curl \u547d\u4ee4\u5931\u8d25\u800c\u5bbf\u4e3b\u673a\u6210\u529f\uff0c\u8bf4\u660e\u95ee\u9898\u51fa\u5728 Docker \u7684\u9ed8\u8ba4\u7f51\u7edc\u9694\u79bb\u73af\u5883\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"22-\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc\u9a8c\u8bc1",children:"2.2 \u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc\u9a8c\u8bc1"}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u5c06\u5bb9\u5668\u6784\u5efa\u8fc7\u7a0b\u6539\u4e3a\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker build --network=host -t myimage .\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6d4b\u8bd5\u7ed3\u679c\u663e\u793a\u53ef\u4ee5\u6210\u529f\u8fde\u63a5\u8fdc\u7a0b IP\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u7ed3\u8bba\uff1a\u5bb9\u5668\u9ed8\u8ba4\u7f51\u7edc\u65e0\u6cd5\u8fde\u901a\u76ee\u6807 IP\uff0c\u800c\u4f7f\u7528\u5bbf\u4e3b\u7f51\u7edc\u53ef\u4ee5\uff0c\u95ee\u9898\u5b9a\u4f4d\u5728 Docker \u7f51\u7edc\u914d\u7f6e\u6216\u8f6c\u53d1\u89c4\u5219\u4e0a\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"23-\u68c0\u67e5-nat-\u8f6c\u53d1\u94fe\u8868iptables",children:"2.3 \u68c0\u67e5 NAT \u8f6c\u53d1\u94fe\u8868\uff08iptables\uff09"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Docker"})," \u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"iptables"})," \u7ba1\u7406 NAT \u8f6c\u53d1\u89c4\u5219\u3002\u5982\u679c\u8fd9\u4e9b\u89c4\u5219\u4e22\u5931\uff0c\u5bb9\u5668\u65e0\u6cd5\u8bbf\u95ee\u5916\u90e8\u7f51\u7edc\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u6267\u884c\u547d\u4ee4\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo iptables -t nat -L\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u89c2\u5bdf NAT \u8868\u4e2d\u7684\u94fe\u662f\u5426\u5b58\u5728 ",(0,r.jsx)(n.code,{children:"DOCKER"}),"\u3002\u5982 ",(0,r.jsx)(n.code,{children:"DOCKER"})," \u94fe\u7f3a\u5931\uff0c\u5219\u8bf4\u660e\u8f6c\u53d1\u89c4\u5219\u672a\u521d\u59cb\u5316\u6216\u88ab\u6e05\u9664\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"24-\u91cd\u542f-docker-\u670d\u52a1",children:"2.4 \u91cd\u542f Docker \u670d\u52a1"}),"\n",(0,r.jsxs)(n.p,{children:["\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u91cd\u542f ",(0,r.jsx)(n.code,{children:"Docker"})," \u670d\u52a1\uff0c\u5f3a\u5236\u91cd\u65b0\u52a0\u8f7d\u8f6c\u53d1\u89c4\u5219\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart docker\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u968f\u540e\u518d\u6b21\u68c0\u67e5 ",(0,r.jsx)(n.code,{children:"NAT"})," \u8868\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo iptables -t nat -L\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7ed3\u679c\u663e\u793a ",(0,r.jsx)(n.code,{children:"DOCKER"})," \u94fe\u5df2\u6062\u590d\uff0c\u5bb9\u5668\u7f51\u7edc\u89c4\u5219\u52a0\u8f7d\u6b63\u5e38\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"25-\u518d\u6b21\u6d4b\u8bd5\u5bb9\u5668\u7f51\u7edc\u8bbf\u95ee",children:"2.5 \u518d\u6b21\u6d4b\u8bd5\u5bb9\u5668\u7f51\u7edc\u8bbf\u95ee"}),"\n",(0,r.jsxs)(n.p,{children:["\u91cd\u65b0\u6267\u884c ",(0,r.jsx)(n.code,{children:"docker build"}),"\uff0c\u5bb9\u5668\u5185\u53ef\u4ee5\u8bbf\u95ee\u8fdc\u7a0b ",(0,r.jsx)(n.code,{children:"IP"}),"\uff0c\u8bf4\u660e\u7f51\u7edc\u8bbf\u95ee\u5df2\u6062\u590d\u6b63\u5e38\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"3-\u95ee\u9898\u603b\u7ed3",children:"3. \u95ee\u9898\u603b\u7ed3"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u9879\u76ee"}),(0,r.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u95ee\u9898\u73b0\u8c61"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"docker build"})," \u4e2d\u7f51\u7edc\u8bbf\u95ee\u5931\u8d25\uff0c\u5bbf\u4e3b\u673a\u53ef\u8fde\u63a5"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u539f\u56e0"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"iptables"})," \u4e2d ",(0,r.jsx)(n.code,{children:"DOCKER chain"})," \u7f3a\u5931\uff0c\u5bfc\u81f4\u5bb9\u5668\u7f51\u7edc\u89c4\u5219\u5f02\u5e38"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u4e34\u65f6\u89e3\u51b3\u65b9\u6848"}),(0,r.jsxs)(n.td,{children:["\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"--network=host"})," \u53c2\u6570\u6784\u5efa\u955c\u50cf"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u6839\u672c\u89e3\u51b3\u65b9\u6cd5"}),(0,r.jsxs)(n.td,{children:["\u91cd\u542f ",(0,r.jsx)(n.code,{children:"Docker"})," \u670d\u52a1\uff0c\u6062\u590d ",(0,r.jsx)(n.code,{children:"NAT"})," \u8f6c\u53d1\u89c4\u5219"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u68c0\u67e5\u547d\u4ee4"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"sudo iptables -t nat -L"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u6062\u590d\u547d\u4ee4"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"sudo systemctl restart docker"})})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"4-\u540e\u7eed\u5efa\u8bae",children:"4. \u540e\u7eed\u5efa\u8bae"}),"\n",(0,r.jsx)(n.h3,{id:"41-\u5207\u6362\u4e3a-iptables-legacy",children:"4.1 \u5207\u6362\u4e3a iptables-legacy"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"RHEL8+"}),"\u3001",(0,r.jsx)(n.code,{children:"openEuler"}),"\u3001",(0,r.jsx)(n.code,{children:"CentOS Stream"})," \u7b49\u7cfb\u7edf\u4e2d\uff0c\u9ed8\u8ba4\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"nftables"}),"\uff0c\u53ef\u80fd\u4e0e Docker \u4e0d\u517c\u5bb9\u3002\u5efa\u8bae\u5207\u6362\u4e3a ",(0,r.jsx)(n.code,{children:"iptables-legacy"}),"\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo alternatives --set iptables /usr/sbin/iptables-legacy\n"})}),"\n",(0,r.jsx)(n.h3,{id:"42-\u68c0\u67e5\u9632\u706b\u5899\u548c\u5b89\u5168\u7b56\u7565",children:"4.2 \u68c0\u67e5\u9632\u706b\u5899\u548c\u5b89\u5168\u7b56\u7565"}),"\n",(0,r.jsxs)(n.p,{children:["\u786e\u8ba4 ",(0,r.jsx)(n.code,{children:"firewalld"}),"\u3001",(0,r.jsx)(n.code,{children:"SELinux"})," \u6216\u5176\u4ed6\u5b89\u5168\u7b56\u7565\u672a\u4e3b\u52a8\u6e05\u9664 ",(0,r.jsx)(n.code,{children:"NAT"})," \u8868\u4e2d ",(0,r.jsx)(n.code,{children:"DOCKER"})," \u94fe\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"43-\u7a33\u5b9a\u6027\u5efa\u8bae",children:"4.3 \u7a33\u5b9a\u6027\u5efa\u8bae"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u9891\u7e41\u51fa\u73b0\u8be5\u95ee\u9898\uff0c\u5efa\u8bae\u5c06\u7f51\u7edc\u7b56\u7565\u4e2d\u5bf9 Docker NAT \u94fe\u7684\u4f9d\u8d56\u6700\u5c0f\u5316\uff0c\u6216\u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u9a71\u52a8\u8fdb\u884c\u66ff\u4ee3\u3002"})]})}function a(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},28453:(e,n,d)=>{d.d(n,{R:()=>s,x:()=>i});var c=d(96540);const r={},l=c.createContext(r);function s(e){const n=c.useContext(l);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),c.createElement(l.Provider,{value:n},e.children)}}}]);