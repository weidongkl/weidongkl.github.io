"use strict";(self.webpackChunkweidongkl_github_io=self.webpackChunkweidongkl_github_io||[]).push([[38],{73267:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>x,contentTitle:()=>r,default:()=>j,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"note/os/kernel/build_flag","title":"Kernel Module Makefile: -y vs -objs","description":"\u5728 Linux \u5185\u6838\u6a21\u5757\u7684 Makefile \u4e2d\uff0c\u7ecf\u5e38\u4f1a\u770b\u5230\u5982\u4e0b\u5199\u6cd5\uff1a","source":"@site/docs/note/os/kernel/build_flag.md","sourceDirName":"note/os/kernel","slug":"/note/os/kernel/build_flag","permalink":"/en/docs/note/os/kernel/build_flag","draft":false,"unlisted":false,"editUrl":"https://github.com/weidongkl/weidongkl.github.io/tree/master/docs/note/os/kernel/build_flag.md","tags":[],"version":"current","lastUpdatedBy":"weidongkl","lastUpdatedAt":1761902071000,"frontMatter":{},"sidebar":"note","previous":{"title":"chroot Usage","permalink":"/en/docs/note/os/chroot"},"next":{"title":"Zombie Processes","permalink":"/en/docs/note/os/zombie"}}');var l=o(74848),d=o(28453);const i={},r="Kernel Module Makefile: -y vs -objs",x={},c=[{value:"1. \u533a\u522b\u8bf4\u660e",id:"1-\u533a\u522b\u8bf4\u660e",level:2},{value:"<code>xxx-y</code>",id:"xxx-y",level:3},{value:"<code>xxx-objs</code>",id:"xxx-objs",level:3},{value:"2. \u5355\u6a21\u5757\u7f16\u8bd1\u6d41\u7a0b",id:"2-\u5355\u6a21\u5757\u7f16\u8bd1\u6d41\u7a0b",level:2},{value:"3. \u591a\u6a21\u5757\u7f16\u8bd1\u6d41\u7a0b",id:"3-\u591a\u6a21\u5757\u7f16\u8bd1\u6d41\u7a0b",level:2},{value:"4. \u603b\u7ed3",id:"4-\u603b\u7ed3",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"kernel-module-makefile--y-vs--objs",children:"Kernel Module Makefile: -y vs -objs"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5728 Linux \u5185\u6838\u6a21\u5757\u7684 ",(0,l.jsx)(n.code,{children:"Makefile"})," \u4e2d\uff0c\u7ecf\u5e38\u4f1a\u770b\u5230\u5982\u4e0b\u5199\u6cd5\uff1a"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"xxx-y"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"xxx-objs"})}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u5b83\u4eec\u90fd\u7528\u4e8e\u6307\u5b9a ",(0,l.jsx)(n.strong,{children:"\u7ec4\u6210\u67d0\u4e2a\u6a21\u5757\u7684\u5bf9\u8c61\u6587\u4ef6\u5217\u8868"}),"\u3002"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"1-\u533a\u522b\u8bf4\u660e",children:"1. \u533a\u522b\u8bf4\u660e"}),"\n",(0,l.jsx)(n.h3,{id:"xxx-y",children:(0,l.jsx)(n.code,{children:"xxx-y"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u63a8\u8350\u7684\u5199\u6cd5"}),"\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u7528\u4e8e\u6307\u5b9a ",(0,l.jsx)(n.code,{children:"xxx.o"})," \u7531\u54ea\u4e9b ",(0,l.jsx)(n.code,{children:".o"})," \u6587\u4ef6\u7ec4\u6210\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u5e38\u89c1\u7528\u6cd5\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-makefile",children:"obj-m += foo.o\nfoo-y := a.o b.o c.o\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u8bd1\u540e\u4f1a\u751f\u6210\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"a.o b.o c.o"})}),"\n",(0,l.jsxs)(n.li,{children:["\u94fe\u63a5\u6210 ",(0,l.jsx)(n.code,{children:"foo.o"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u6700\u7ec8 ",(0,l.jsx)(n.code,{children:"foo.ko"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"xxx-objs",children:(0,l.jsx)(n.code,{children:"xxx-objs"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u65e7\u5199\u6cd5"}),"\uff0c\u4f5c\u7528\u4e0e ",(0,l.jsx)(n.code,{children:"xxx-y"})," \u5b8c\u5168\u7b49\u4ef7\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u5e38\u89c1\u7528\u6cd5\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-makefile",children:"obj-m += foo.o\nfoo-objs := a.o b.o c.o\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"2-\u5355\u6a21\u5757\u7f16\u8bd1\u6d41\u7a0b",children:"2. \u5355\u6a21\u5757\u7f16\u8bd1\u6d41\u7a0b"}),"\n",(0,l.jsxs)(n.p,{children:["\u4e0b\u9762\u7528 ",(0,l.jsx)(n.code,{children:"foo.ko"})," \u4e3a\u4f8b\u8bf4\u660e\u6784\u5efa\u6d41\u7a0b\uff1a"]}),"\n",(0,l.jsx)(n.mermaid,{value:'flowchart TD\n    subgraph Source["\u6e90\u7801\u6587\u4ef6"]\n        A[a.c] --\x3e Aobj[a.o]\n        B[b.c] --\x3e Bobj[b.o]\n        C[c.c] --\x3e Cobj[c.o]\n    end\n\n    subgraph Makefile["Makefile \u6307\u5b9a"]\n        Y1["foo-y := a.o b.o c.o"] \n        Y2["foo-objs := a.o b.o c.o (\u65e7\u5199\u6cd5)"]\n    end\n\n    subgraph Build["\u7f16\u8bd1\u8fc7\u7a0b"]\n        Link["ld \u94fe\u63a5 -> foo.o"]\n        Mod["modpost -> foo.ko"]\n    end\n\n    Aobj --\x3e Y1\n    Bobj --\x3e Y1\n    Cobj --\x3e Y1\n\n    Y1 --\x3e Link\n    Y2 --\x3e Link\n    Link --\x3e Mod\n'}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"3-\u591a\u6a21\u5757\u7f16\u8bd1\u6d41\u7a0b",children:"3. \u591a\u6a21\u5757\u7f16\u8bd1\u6d41\u7a0b"}),"\n",(0,l.jsxs)(n.p,{children:["\u5f53 ",(0,l.jsx)(n.code,{children:"Makefile"})," \u4e2d\u6709\u591a\u4e2a\u6a21\u5757\u65f6\uff0c\u4f8b\u5982\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-makefile",children:"obj-m += foo.o\nobj-m += bar.o\n\nfoo-y := a.o b.o\nbar-y := x.o y.o z.o\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5bf9\u5e94\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.mermaid,{value:'flowchart TD\n    subgraph Source["\u6e90\u7801\u6587\u4ef6"]\n        A[a.c] --\x3e Aobj[a.o]\n        B[b.c] --\x3e Bobj[b.o]\n        X[x.c] --\x3e Xobj[x.o]\n        Y[y.c] --\x3e Yobj[y.o]\n        Z[z.c] --\x3e Zobj[z.o]\n    end\n\n    subgraph Makefile["Makefile \u6307\u5b9a"]\n        Foo["foo-y := a.o b.o"]\n        Bar["bar-y := x.o y.o z.o"]\n    end\n\n    subgraph Build["\u7f16\u8bd1\u8fc7\u7a0b"]\n        LinkFoo["ld -> foo.o"]\n        LinkBar["ld -> bar.o"]\n        ModFoo["modpost -> foo.ko"]\n        ModBar["modpost -> bar.ko"]\n    end\n\n    Aobj --\x3e Foo\n    Bobj --\x3e Foo\n    Xobj --\x3e Bar\n    Yobj --\x3e Bar\n    Zobj --\x3e Bar\n\n    Foo --\x3e LinkFoo --\x3e ModFoo\n    Bar --\x3e LinkBar --\x3e ModBar\n'}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"4-\u603b\u7ed3",children:"4. \u603b\u7ed3"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"xxx-y"})," \u662f\u63a8\u8350\u7528\u6cd5"]}),"\uff0c\u7528\u4e8e\u6307\u5b9a\u4e00\u4e2a\u6a21\u5757\u7531\u54ea\u4e9b\u5bf9\u8c61\u6587\u4ef6\u7ec4\u6210\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"xxx-objs"})," \u662f\u65e7\u5199\u6cd5"]}),"\uff0c\u4f5c\u7528\u548c ",(0,l.jsx)(n.code,{children:"-y"})," \u5b8c\u5168\u76f8\u540c\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u7f16\u8bd1\u6d41\u7a0b\u5927\u81f4\u4e3a\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:".c \u2192 .o"}),"\uff08gcc \u7f16\u8bd1\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:".o \u2192 xxx.o"}),"\uff08ld \u94fe\u63a5\uff0c\u6839\u636e ",(0,l.jsx)(n.code,{children:"xxx-y"})," / ",(0,l.jsx)(n.code,{children:"xxx-objs"}),"\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"xxx.o \u2192 xxx.ko"}),"\uff08modpost \u751f\u6210\u5185\u6838\u6a21\u5757\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"obj-m += xxx.o"})," \u7528\u4e8e\u544a\u8bc9\u5185\u6838\u7f16\u8bd1\u7cfb\u7edf\u6700\u7ec8\u9700\u8981\u751f\u6210\u4e00\u4e2a ",(0,l.jsx)(n.code,{children:"xxx.ko"})," \u6a21\u5757\u3002"]}),"\n"]})]})}function j(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>r});var s=o(96540);const l={},d=s.createContext(l);function i(e){const n=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);