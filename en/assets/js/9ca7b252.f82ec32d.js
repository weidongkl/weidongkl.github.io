"use strict";(self.webpackChunkweidongkl_github_io=self.webpackChunkweidongkl_github_io||[]).push([[1521,7723],{93499:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"note/golang/design/reliability","title":"\u7cfb\u7edf\u53ef\u9760\u6027\u8bbe\u8ba1","description":"1. \u6838\u5fc3\u6982\u5ff5","source":"@site/docs/note/golang/design/reliability.md","sourceDirName":"note/golang/design","slug":"/note/golang/design/reliability","permalink":"/en/docs/note/golang/design/reliability","draft":false,"unlisted":false,"editUrl":"https://github.com/weidongkl/weidongkl.github.io/tree/master/docs/note/golang/design/reliability.md","tags":[],"version":"current","lastUpdatedBy":"weidongkl","lastUpdatedAt":1754635698000,"frontMatter":{},"sidebar":"note","previous":{"title":"Golang \u591agoroutine\u4ea4\u4e92\u6a21\u578b","permalink":"/en/docs/note/golang/design/multi_goroutine"},"next":{"title":"Golang bcrypt","permalink":"/en/docs/note/golang/bcrypt"}}');var s=r(74848),i=r(28453);const l={},d="\u7cfb\u7edf\u53ef\u9760\u6027\u8bbe\u8ba1",c={},o=[{value:"1. \u6838\u5fc3\u6982\u5ff5",id:"1-\u6838\u5fc3\u6982\u5ff5",level:2},{value:"1.1 \u5b9a\u4e49",id:"11-\u5b9a\u4e49",level:3},{value:"1.2 \u8bbe\u8ba1\u539f\u5219",id:"12-\u8bbe\u8ba1\u539f\u5219",level:3},{value:"1.3 \u53ef\u9760\u6027\u8bbe\u8ba1\u65b9\u6cd5",id:"13-\u53ef\u9760\u6027\u8bbe\u8ba1\u65b9\u6cd5",level:3},{value:"1.4 Golang \u53ef\u9760\u6027\u4f18\u52bf",id:"14-golang-\u53ef\u9760\u6027\u4f18\u52bf",level:3},{value:"2. \u5b9e\u8df5\u6307\u5357",id:"2-\u5b9e\u8df5\u6307\u5357",level:2},{value:"2.1 \u9519\u8bef\u5904\u7406",id:"21-\u9519\u8bef\u5904\u7406",level:3},{value:"2.1.1 \u9519\u8bef\u6355\u83b7\u548c\u4f20\u9012",id:"211-\u9519\u8bef\u6355\u83b7\u548c\u4f20\u9012",level:4},{value:"2.1.2 \u9519\u8bef\u5305\u88c5\u4e0e\u5206\u7c7b",id:"212-\u9519\u8bef\u5305\u88c5\u4e0e\u5206\u7c7b",level:4},{value:"2.1.3 \u9519\u8bef\u6062\u590d\u7b56\u7565\u77e9\u9635",id:"213-\u9519\u8bef\u6062\u590d\u7b56\u7565\u77e9\u9635",level:4},{value:"2.2 \u8d44\u6e90\u7ba1\u7406",id:"22-\u8d44\u6e90\u7ba1\u7406",level:3},{value:"2.2.1 \u786e\u4fdd\u8d44\u6e90\u91ca\u653e",id:"221-\u786e\u4fdd\u8d44\u6e90\u91ca\u653e",level:4},{value:"2.2.2 \u9632\u6b62goroutine \u6cc4\u9732",id:"222-\u9632\u6b62goroutine-\u6cc4\u9732",level:4},{value:"2.2.3 \u8fde\u63a5\u6c60\u914d\u7f6e\u6a21\u677f",id:"223-\u8fde\u63a5\u6c60\u914d\u7f6e\u6a21\u677f",level:4},{value:"2.2.4 \u8d85\u65f6\u63a7\u5236",id:"224-\u8d85\u65f6\u63a7\u5236",level:4},{value:"2.2.5 \u6027\u80fd\u5206\u6790\u5de5\u5177",id:"225-\u6027\u80fd\u5206\u6790\u5de5\u5177",level:4},{value:"2.3 \u5e76\u53d1\u5b89\u5168",id:"23-\u5e76\u53d1\u5b89\u5168",level:3},{value:"2.3.1 \u9501\u673a\u5236\u4e0e\u539f\u5b50\u64cd\u4f5c",id:"231-\u9501\u673a\u5236\u4e0e\u539f\u5b50\u64cd\u4f5c",level:4},{value:"2.3.2 Worker Pool\u5b9e\u73b0",id:"232-worker-pool\u5b9e\u73b0",level:4},{value:"2.4 \u9632\u5fa1\u6027\u7f16\u7a0b",id:"24-\u9632\u5fa1\u6027\u7f16\u7a0b",level:3},{value:"2.4.1 \u8f93\u5165\u6821\u9a8c\u4e0e\u65e9\u5931\u8d25",id:"241-\u8f93\u5165\u6821\u9a8c\u4e0e\u65e9\u5931\u8d25",level:4},{value:"2.4.2 \u5065\u5eb7\u68c0\u67e5\u4e0e\u81ea\u68c0",id:"242-\u5065\u5eb7\u68c0\u67e5\u4e0e\u81ea\u68c0",level:4},{value:"2.4.3 \u53ef\u89c2\u6d4b\u6027\u4e0e\u65e5\u5fd7\u57cb\u70b9",id:"243-\u53ef\u89c2\u6d4b\u6027\u4e0e\u65e5\u5fd7\u57cb\u70b9",level:4},{value:"2.5 \u5f02\u6b65\u901a\u4fe1",id:"25-\u5f02\u6b65\u901a\u4fe1",level:3},{value:"2.5.1 \u786e\u8ba4\u673a\u5236",id:"251-\u786e\u8ba4\u673a\u5236",level:4},{value:"2.5.2 \u901a\u77e5\u673a\u5236/\u76d1\u542c\u6a21\u5f0f",id:"252-\u901a\u77e5\u673a\u5236\u76d1\u542c\u6a21\u5f0f",level:4},{value:"2.6 \u5355\u5143\u6d4b\u8bd5\u4e0e\u538b\u529b\u6d4b\u8bd5",id:"26-\u5355\u5143\u6d4b\u8bd5\u4e0e\u538b\u529b\u6d4b\u8bd5",level:3},{value:"2.6.1 \u8986\u76d6\u7387\u9a8c\u8bc1\u53ef\u9760\u6027",id:"261-\u8986\u76d6\u7387\u9a8c\u8bc1\u53ef\u9760\u6027",level:4},{value:"3. \u6545\u969c\u6f14\u7ec3\u65b9\u6848",id:"3-\u6545\u969c\u6f14\u7ec3\u65b9\u6848",level:2},{value:"3.1 \u6df7\u6c8c\u5de5\u7a0b\u6d4b\u8bd5\u77e9\u9635",id:"31-\u6df7\u6c8c\u5de5\u7a0b\u6d4b\u8bd5\u77e9\u9635",level:3},{value:"3.2 \u5178\u578b\u6545\u969c\u5904\u7406\u6d41\u7a0b",id:"32-\u5178\u578b\u6545\u969c\u5904\u7406\u6d41\u7a0b",level:3},{value:"4. \u751f\u4ea7\u73af\u5883\u68c0\u67e5\u6e05\u5355",id:"4-\u751f\u4ea7\u73af\u5883\u68c0\u67e5\u6e05\u5355",level:2},{value:"4.1 \u90e8\u7f72\u524d\u5fc5\u68c0\u9879",id:"41-\u90e8\u7f72\u524d\u5fc5\u68c0\u9879",level:3},{value:"4.2 \u8fd0\u884c\u65f6\u76d1\u63a7\u5173\u952e\u6307\u6807",id:"42-\u8fd0\u884c\u65f6\u76d1\u63a7\u5173\u952e\u6307\u6807",level:3},{value:"5. \u63a8\u8350\u5de5\u5177\u94fe\u589e\u5f3a",id:"5-\u63a8\u8350\u5de5\u5177\u94fe\u589e\u5f3a",level:2},{value:"5.1 \u53ef\u9760\u6027\u589e\u5f3a\u5de5\u5177\u5305",id:"51-\u53ef\u9760\u6027\u589e\u5f3a\u5de5\u5177\u5305",level:3},{value:"5.2 \u5178\u578b\u914d\u7f6e\u793a\u4f8b",id:"52-\u5178\u578b\u914d\u7f6e\u793a\u4f8b",level:3},{value:"6. \u9644\u5f55\uff1a\u53ef\u9760\u6027\u8bbe\u8ba1\u6a21\u5f0f\u901f\u67e5\u8868",id:"6-\u9644\u5f55\u53ef\u9760\u6027\u8bbe\u8ba1\u6a21\u5f0f\u901f\u67e5\u8868",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",input:"input",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u7cfb\u7edf\u53ef\u9760\u6027\u8bbe\u8ba1",children:"\u7cfb\u7edf\u53ef\u9760\u6027\u8bbe\u8ba1"})}),"\n",(0,s.jsx)(n.h2,{id:"1-\u6838\u5fc3\u6982\u5ff5",children:"1. \u6838\u5fc3\u6982\u5ff5"}),"\n",(0,s.jsx)(n.h3,{id:"11-\u5b9a\u4e49",children:"1.1 \u5b9a\u4e49"}),"\n",(0,s.jsxs)(n.p,{children:["\u7cfb\u7edf\u53ef\u9760\u6027\uff08Reliability\uff09\u6307\u7cfb\u7edf\u5728\u89c4\u5b9a\u6761\u4ef6\u548c\u65f6\u95f4\u5185\uff0c",(0,s.jsx)(n.strong,{children:"\u6301\u7eed\u63d0\u4f9b\u6b63\u786e\u670d\u52a1\u7684\u80fd\u529b"}),"\u3002\u4e00\u4e2a\u771f\u6b63\u9ad8\u53ef\u7528\u7684\u7cfb\u7edf\uff0c\u5e94\u5177\u5907\u4ee5\u4e0b\u80fd\u529b\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5931\u8d25\u53ef\u6062\u590d"}),"\uff1a\u9047\u5230\u6545\u969c\u80fd\u5feb\u901f\u81ea\u6211\u4fee\u590d\u6216\u964d\u7ea7\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u72b6\u6001\u53ef\u63a7"}),"\uff1a\u7cfb\u7edf\u8fd0\u884c\u72b6\u6001\u53ef\u88ab\u89c2\u6d4b\u548c\u63a7\u5236\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8d44\u6e90\u53ef\u56de\u6536"}),"\uff1a\u51fa\u73b0\u95ee\u9898\u65f6\u4e0d\u4f1a\u9020\u6210\u8d44\u6e90\u6cc4\u6f0f\u6216\u8017\u5c3d\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5e38\u7528\u53ef\u9760\u6027\u6307\u6807\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u670d\u52a1\u8fde\u7eed\u6027"}),"\uff1aMTBF\uff08\u5e73\u5747\u65e0\u6545\u969c\u65f6\u95f4\uff09 \u2265 99.9%"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u6570\u636e\u5b8c\u6574\u6027"}),"\uff1a\u6570\u636e\u9519\u8bef\u7387 < 0.001%"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u6545\u969c\u6062\u590d\u80fd\u529b"}),"\uff1aMTTR\uff08\u5e73\u5747\u4fee\u590d\u65f6\u95f4\uff09 \u2264 5\u5206\u949f"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"12-\u8bbe\u8ba1\u539f\u5219",children:"1.2 \u8bbe\u8ba1\u539f\u5219"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5931\u8d25\u53ef\u6062\u590d\uff08Fail Recovery\uff09"}),"\n\u7cfb\u7edf\u5e94\u8be5\u80fd\u6355\u83b7\u9519\u8bef\uff0c\u5e76\u505a\u51fa\u9002\u5f53\u5904\u7406\u6216\u964d\u7ea7\uff0c\u4e0d\u5e94\u76f4\u63a5 panic \u6216\u5d29\u6e83\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8d85\u65f6\u4e0e\u91cd\u8bd5\uff08Timeout & Retry\uff09"}),"\n\u6bcf\u4e00\u6b21\u8bf7\u6c42\u5e94\u8bbe\u7f6e\u8d85\u65f6\u673a\u5236\uff0c\u8d85\u65f6\u540e\u5e94\u6709\u91cd\u8bd5\u7b56\u7565\uff0c\u5e76\u8003\u8651\u5e42\u7b49\u6027\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8d44\u6e90\u53ef\u63a7\uff08Resource Bound\uff09"}),"\n\u9650\u5236 goroutine\u3001channel\u3001\u5185\u5b58\u3001\u8fde\u63a5\u7b49\u8d44\u6e90\uff0c\u9632\u6b62\u8d44\u6e90\u6cc4\u6f0f\u548c\u8017\u5c3d\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5e42\u7b49\u6027\u8bbe\u8ba1\uff08Idempotency\uff09"}),"\n\u91cd\u8bd5\u4e0d\u80fd\u5f15\u53d1\u526f\u4f5c\u7528\uff0c\u5e94\u786e\u4fdd\u63a5\u53e3\u6216\u64cd\u4f5c\u5e42\u7b49\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u89c2\u5bdf\u4e0e\u544a\u8b66\uff08Observability\uff09"}),"\n\u7cfb\u7edf\u5185\u90e8\u5e94\u5177\u5907\u65e5\u5fd7\u3001\u6307\u6807\u3001trace \u7b49\u624b\u6bb5\uff0c\u4fbf\u4e8e\u6392\u969c\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"13-\u53ef\u9760\u6027\u8bbe\u8ba1\u65b9\u6cd5",children:"1.3 \u53ef\u9760\u6027\u8bbe\u8ba1\u65b9\u6cd5"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u5173\u952e\u70b9"}),(0,s.jsx)(n.th,{children:"\u8bf4\u660e"}),(0,s.jsx)(n.th,{children:"\u63a8\u8350\u5de5\u5177/\u5e93"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9650\u5236\u8d44\u6e90"}),(0,s.jsx)(n.td,{children:"\u63a7\u5236 goroutine\u3001channel\u3001\u8fde\u63a5\u6570\u7b49"}),(0,s.jsx)(n.td,{children:"\u4f7f\u7528\u7f13\u51b2\u3001\u4fe1\u53f7\u91cf\u3001\u8fde\u63a5\u6c60\u7b49\u65b9\u5f0f"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u660e\u786e\u8d85\u65f6"}),(0,s.jsx)(n.td,{children:"\u7f51\u7edc/IO \u64cd\u4f5c\u5fc5\u987b\u8bbe\u7f6e\u8d85\u65f6"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"context.WithTimeout"}),"\u3001",(0,s.jsx)(n.code,{children:"avast/retry-go"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9519\u8bef\u6062\u590d"}),(0,s.jsx)(n.td,{children:"\u6240\u6709\u9519\u8bef\u9700\u6355\u83b7\u5904\u7406\uff0c\u907f\u514d panic"}),(0,s.jsx)(n.td,{children:"\u660e\u786e\u9519\u8bef\u7c7b\u578b\u548c\u6062\u590d\u7b56\u7565"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u53ef\u89c2\u6d4b\u6027"}),(0,s.jsx)(n.td,{children:"\u65e5\u5fd7 + \u6307\u6807 + Trace"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"prometheus"}),"\u3001",(0,s.jsx)(n.code,{children:"zap"}),"\u3001",(0,s.jsx)(n.code,{children:"pprof"}),"\u3001",(0,s.jsx)(n.code,{children:"otel"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u53ef\u9000\u51fa\u6027"}),(0,s.jsx)(n.td,{children:"goroutine \u5e94\u53ef\u88ab\u5b89\u5168\u7ec8\u6b62"}),(0,s.jsxs)(n.td,{children:["\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"channel + select"})," \u63a7\u5236"]})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"14-golang-\u53ef\u9760\u6027\u4f18\u52bf",children:"1.4 Golang \u53ef\u9760\u6027\u4f18\u52bf"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph TD\n    A[\u5e76\u53d1\u5b89\u5168] --\x3e B[goroutine\u8f7b\u91cf\u7ea7]\n    A --\x3e C[channel\u901a\u4fe1]\n    D[\u5185\u7f6e\u9519\u8bef\u5904\u7406] --\x3e E[\u591a\u8fd4\u56de\u503c]\n    F[\u6807\u51c6\u5e93\u652f\u6301] --\x3e G[context/time\u5305]"}),"\n",(0,s.jsx)(n.h2,{id:"2-\u5b9e\u8df5\u6307\u5357",children:"2. \u5b9e\u8df5\u6307\u5357"}),"\n",(0,s.jsx)(n.h3,{id:"21-\u9519\u8bef\u5904\u7406",children:"2.1 \u9519\u8bef\u5904\u7406"}),"\n",(0,s.jsx)(n.h4,{id:"211-\u9519\u8bef\u6355\u83b7\u548c\u4f20\u9012",children:"2.1.1 \u9519\u8bef\u6355\u83b7\u548c\u4f20\u9012"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// \u6c38\u8fdc\u5ffd\u7565\u9519\u8bef = \u57cb\u4e0b\u5b9a\u65f6\u70b8\u5f39\nfunc ReadConfig(path string) (*Config, error) {\n    data, err := os.ReadFile(path)\n    if err != nil {\n        // \u8ffd\u52a0\u4e0a\u4e0b\u6587\u4fe1\u606f\u5411\u4e0a\u4f20\u9012\n        return nil, fmt.Errorf("read config failed: %w", err)\n    }\n    var cfg Config\n    if err := json.Unmarshal(data, &cfg); err != nil {\n        return nil, fmt.Errorf("parse config failed: %w", err)\n    }\n    return &cfg, nil\n}\n\n// \u8c03\u7528\u65b9\u5fc5\u987b\u5904\u7406\u9519\u8bef\ncfg, err := ReadConfig("config.json")\nif err != nil {\n    log.Fatalf("Fatal error: %v", err) // \u6216\u4f18\u96c5\u964d\u7ea7\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"212-\u9519\u8bef\u5305\u88c5\u4e0e\u5206\u7c7b",children:"2.1.2 \u9519\u8bef\u5305\u88c5\u4e0e\u5206\u7c7b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'type BusinessError struct {\n    Code    int\n    Message string\n    Cause   error\n}\n\nfunc (e *BusinessError) Error() string {\n    return fmt.Sprintf("code=%d, msg=%s, cause=%v", e.Code, e.Message, e.Cause)\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nfunc ProcessOrder() error {\n    if err := validate(); err != nil {\n        return &BusinessError{\n            Code:    40001,\n            Message: "invalid order",\n            Cause:   err,\n        }\n    }\n    // ...\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"213-\u9519\u8bef\u6062\u590d\u7b56\u7565\u77e9\u9635",children:"2.1.3 \u9519\u8bef\u6062\u590d\u7b56\u7565\u77e9\u9635"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u9519\u8bef\u7c7b\u578b"}),(0,s.jsx)(n.th,{children:"\u6062\u590d\u7b56\u7565"}),(0,s.jsx)(n.th,{children:"Golang\u5b9e\u73b0\u793a\u4f8b"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u4e34\u65f6\u6027\u9519\u8bef"}),(0,s.jsx)(n.td,{children:"\u91cd\u8bd5+\u9000\u907f\u7b56\u7565"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"retry-go"}),"\u5e93+",(0,s.jsx)(n.code,{children:"context"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u4e1a\u52a1\u903b\u8f91\u9519\u8bef"}),(0,s.jsx)(n.td,{children:"\u7194\u65ad\u964d\u7ea7"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"gobreaker"}),"\u7194\u65ad\u5668"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u8d44\u6e90\u4e0d\u8db3\u9519\u8bef"}),(0,s.jsx)(n.td,{children:"\u81ea\u52a8\u6269\u5bb9+\u9650\u6d41"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"golang.org/x/time/rate"})})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u91cd\u8bd5\u673a\u5236+backoff\u7b56\u7565"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'func Retry(attempts int, sleep time.Duration, fn func() error) error {\n\tfor i := 0; i < attempts; i++ {\n\t\tif err := fn(); err != nil {\n\t\t\tlog.Printf("attempt %d failed: %v", i+1, err)\n\t\t\ttime.Sleep(sleep)\n\t\t\tsleep *= 2\n\t\t} else {\n\t\t\treturn nil\n\t\t}\n\t}\n\treturn fmt.Errorf("all attempts failed")\n}\n\n// \u8c03\u7528\u793a\u4f8b\uff1a\nerr := Retry(3, 100*time.Millisecond, func() error {\n\t// your logic here\n\treturn errors.New("simulate failure")\n})\n'})}),"\n",(0,s.jsx)(n.h3,{id:"22-\u8d44\u6e90\u7ba1\u7406",children:"2.2 \u8d44\u6e90\u7ba1\u7406"}),"\n",(0,s.jsx)(n.h4,{id:"221-\u786e\u4fdd\u8d44\u6e90\u91ca\u653e",children:"2.2.1 \u786e\u4fdd\u8d44\u6e90\u91ca\u653e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"func ProcessFile(path string) error {\n    file, err := os.Open(path)\n    if err != nil {\n        return err\n    }\n    defer file.Close() // \u65e0\u8bba\u51fd\u6570\u5982\u4f55\u9000\u51fa\u90fd\u4f1a\u6267\u884c\n\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        // \u5904\u7406\u6570\u636e\n    }\n    return scanner.Err() // \u8fd4\u56de\u626b\u63cf\u9519\u8bef\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"222-\u9632\u6b62goroutine-\u6cc4\u9732",children:"2.2.2 \u9632\u6b62goroutine \u6cc4\u9732"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// \u9000\u51fa\u4fe1\u53f7 + select \u63a7\u5236\nfunc worker(stop <-chan struct{}) {\n\tticker := time.NewTicker(time.Second)\n\tdefer ticker.Stop()\n\n\tfor {\n\t\tselect {\n\t\tcase <-ticker.C:\n\t\t\tlog.Println("working...")\n\t\tcase <-stop:\n\t\t\tlog.Println("worker stopped")\n\t\t\treturn\n\t\t}\n\t}\n}\n\n// \u8c03\u7528\u65b9\u5f0f\uff1a\nstopCh := make(chan struct{})\ngo worker(stopCh)\ntime.Sleep(5 * time.Second)\nclose(stopCh)\n'})}),"\n",(0,s.jsx)(n.h4,{id:"223-\u8fde\u63a5\u6c60\u914d\u7f6e\u6a21\u677f",children:"2.2.3 \u8fde\u63a5\u6c60\u914d\u7f6e\u6a21\u677f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// Database\u8fde\u63a5\u6c60\u914d\u7f6e\ndb, err := sql.Open("mysql", dsn)\ndb.SetMaxOpenConns(25)          // \u6700\u5927\u8fde\u63a5\u6570\ndb.SetMaxIdleConns(5)           // \u7a7a\u95f2\u8fde\u63a5\u6570\ndb.SetConnMaxLifetime(5*time.Minute) // \u6700\u5927\u5b58\u6d3b\u65f6\u95f4\n\n// HTTP Client\u914d\u7f6e\ntransport := &http.Transport{\n    MaxIdleConns:        100,\n    IdleConnTimeout:     90 * time.Second,\n    TLSHandshakeTimeout: 10 * time.Second,\n}\nclient := &http.Client{\n    Transport: transport,\n    Timeout:   30 * time.Second, // \u5305\u62ec\u8fde\u63a5+\u4f20\u8f93+\u8bfb\u53d6\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"224-\u8d85\u65f6\u63a7\u5236",children:"2.2.4 \u8d85\u65f6\u63a7\u5236"}),"\n",(0,s.jsxs)(n.p,{children:["\u901a\u8fc7",(0,s.jsx)(n.code,{children:"context.WithTimeout"}),"\u5b9e\u73b0"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'func FetchData(ctx context.Context, url string) ([]byte, error) {\n    req, _ := http.NewRequestWithContext(ctx, "GET", url, nil)\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        return nil, err\n    }\n    defer resp.Body.Close()\n    return io.ReadAll(resp.Body)\n}\n\n// \u8c03\u7528\u65b9\u8bbe\u7f6e\u8d85\u65f6\nctx, cancel := context.WithTimeout(context.Background(), 3*time.Second)\ndefer cancel()\ndata, err := FetchData(ctx, "https://api.example.com")\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u9632\u6b62\u4efb\u52a1\u963b\u585e"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:""}),"\n",(0,s.jsx)(n.h4,{id:"225-\u6027\u80fd\u5206\u6790\u5de5\u5177",children:"2.2.5 \u6027\u80fd\u5206\u6790\u5de5\u5177"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"pprof"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expvar"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"go tool trace"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"23-\u5e76\u53d1\u5b89\u5168",children:"2.3 \u5e76\u53d1\u5b89\u5168"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"sync.Mutex"})," /",(0,s.jsx)(n.code,{children:"atomic"}),"/",(0,s.jsx)(n.code,{children:"channel"})]}),"\n",(0,s.jsx)(n.h4,{id:"231-\u9501\u673a\u5236\u4e0e\u539f\u5b50\u64cd\u4f5c",children:"2.3.1 \u9501\u673a\u5236\u4e0e\u539f\u5b50\u64cd\u4f5c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"type SafeCounter struct {\n    mu    sync.Mutex\n    count int\n}\n\nfunc (c *SafeCounter) Increment() {\n    c.mu.Lock()\n    defer c.mu.Unlock() // defer \u89e3\u9501\u786e\u4fdd\u5f02\u5e38\u5b89\u5168\n    c.count++\n}\n\n// \u4f7f\u7528 sync/atomic \u7684\u65e0\u9501\u4f18\u5316\nvar atomicCount int64\natomic.AddInt64(&atomicCount, 1) // \u539f\u5b50\u64cd\u4f5c\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u68c0\u6d4b\u5de5\u5177"}),"\uff1a",(0,s.jsx)(n.code,{children:"go run -race your_app.go"})]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"232-worker-pool\u5b9e\u73b0",children:"2.3.2 Worker Pool\u5b9e\u73b0"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"type Task func()\n\nfunc NewWorkerPool(size int) chan Task {\n    tasks := make(chan Task, size)\n    for i := 0; i < size; i++ {\n        go worker(tasks)\n    }\n    return tasks\n}\n\nfunc worker(tasks <-chan Task) {\n    for task := range tasks {\n        task()\n    }\n}\n\n// \u4f7f\u7528\u793a\u4f8b\npool := NewWorkerPool(10)\npool <- func() { /* \u4efb\u52a1\u903b\u8f91 */ }\n"})}),"\n",(0,s.jsx)(n.h3,{id:"24-\u9632\u5fa1\u6027\u7f16\u7a0b",children:"2.4 \u9632\u5fa1\u6027\u7f16\u7a0b"}),"\n",(0,s.jsx)(n.h4,{id:"241-\u8f93\u5165\u6821\u9a8c\u4e0e\u65e9\u5931\u8d25",children:"2.4.1 \u8f93\u5165\u6821\u9a8c\u4e0e\u65e9\u5931\u8d25"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'func ValidateInput(input UserInput) error {\n    if input.Email == "" {\n        // \u5b58\u5728\u9519\u8bef\uff0c\u7acb\u523b\u8fd4\u56de\n        return errors.New("email cannot be empty")\n    }\n    if !strings.Contains(input.Email, "@") {\n        return errors.New("invalid email format")\n    }\n    if input.Age < 18 {\n        return errors.New("age must be >= 18")\n    }\n    return nil\n}\n\n// \u5728\u5165\u53e3\u5904\u5f3a\u5236\u6821\u9a8c\nerr := ValidateInput(req.Data)\nif err != nil {\n    http.Error(w, err.Error(), http.StatusBadRequest)\n    return\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"242-\u5065\u5eb7\u68c0\u67e5\u4e0e\u81ea\u68c0",children:"2.4.2 \u5065\u5eb7\u68c0\u67e5\u4e0e\u81ea\u68c0"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'http.HandleFunc("/healthz", func(w http.ResponseWriter, r *http.Request) {\n\tw.WriteHeader(http.StatusOK)\n\tw.Write([]byte("ok"))\n})\n//  \u652f\u6301\u670d\u52a1\u81ea\u68c0\uff0c\u53ef\u914d\u5408 k8s\u3001ELB \u5b9e\u73b0\u5065\u5eb7\u63a2\u9488\u3002\n'})}),"\n",(0,s.jsx)(n.h4,{id:"243-\u53ef\u89c2\u6d4b\u6027\u4e0e\u65e5\u5fd7\u57cb\u70b9",children:"2.4.3 \u53ef\u89c2\u6d4b\u6027\u4e0e\u65e5\u5fd7\u57cb\u70b9"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'import (\n    "go.uber.org/zap"\n    "github.com/prometheus/client_golang/prometheus"\n)\n\nvar (\n    requestCounter = prometheus.NewCounterVec(\n        prometheus.CounterOpts{\n            Name: "api_requests_total",\n            Help: "Total API requests",\n        },\n        []string{"method", "status"},\n    )\n    logger, _ = zap.NewProduction()\n)\n\nfunc HandleRequest(w http.ResponseWriter, r *http.Request) {\n    start := time.Now()\n    \n    // \u4e1a\u52a1\u903b\u8f91...\n    \n    latency := time.Since(start)\n    requestCounter.WithLabelValues(r.Method, "200").Inc()\n    logger.Info("request completed",\n        zap.String("path", r.URL.Path),\n        zap.Duration("latency", latency),\n    )\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"25-\u5f02\u6b65\u901a\u4fe1",children:"2.5 \u5f02\u6b65\u901a\u4fe1"}),"\n",(0,s.jsx)(n.h4,{id:"251-\u786e\u8ba4\u673a\u5236",children:"2.5.1 \u786e\u8ba4\u673a\u5236"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// \u591a\u670d\u52a1\u786e\u8ba4\n// payment/handler.go\nfunc (p *PaymentService) HandlePay(ctx context.Context, msg OrderCreatedEvent) error {\n\t// ...\u5904\u7406\u652f\u4ed8\u903b\u8f91...\n\tif success {\n\t\treturn notifyAck("payment", msg.OrderID) // \u663e\u5f0f\u786e\u8ba4\n\t} else {\n\t\treturn errors.New("payment failed")\n\t}\n}\n// order/notify.go\nfunc notifyAck(source, orderID string) error {\n\treturn postJSON("http://order-service/ack", map[string]string{\n\t\t"source": source,\n\t\t"order_id": orderID,\n\t})\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// \u591agoroutine \u786e\u8ba4\npackage main\n\nimport (\n\t"fmt"\n\t"time"\n)\n\n// EventAggregator manages a set of rules and processes updates through channels\ntype EventAggregator struct {\n\trules         []string\n\tupdateChannel chan *rulesUpdateRequest\n\tshutdownChan  chan struct{}\n}\n\n// rulesUpdateRequest represents a request to update the rules\ntype rulesUpdateRequest struct {\n\tnewRules []string\n\tresponse chan error\n}\n\n// NewEventAggregator creates and starts a new EventAggregator\nfunc NewEventAggregator() *EventAggregator {\n\tagg := &EventAggregator{\n\t\trules:         []string{},\n\t\tupdateChannel: make(chan *rulesUpdateRequest),\n\t\tshutdownChan:  make(chan struct{}),\n\t}\n\t\n\tgo agg.processRequests()\n\treturn agg\n}\n\n// UpdateRules safely updates the rules by sending a request through the channel\nfunc (a *EventAggregator) UpdateRules(newRules []string) error {\n\treq := &rulesUpdateRequest{\n\t\tnewRules: newRules,\n\t\tresponse: make(chan error, 1), // Buffered to avoid blocking\n\t}\n\t\n\ta.updateChannel <- req\n\treturn <-req.response\n}\n\n// Shutdown gracefully stops the aggregator\nfunc (a *EventAggregator) Shutdown() {\n\tclose(a.shutdownChan)\n}\n\n// processRequests handles incoming requests in a thread-safe manner\nfunc (a *EventAggregator) processRequests() {\n\tfor {\n\t\tselect {\n\t\tcase req := <-a.updateChannel:\n\t\t\ta.rules = req.newRules\n\t\t\tfmt.Println("Updated rules:", a.rules)\n\t\t\treq.response <- nil\n\t\tcase <-a.shutdownChan:\n\t\t\tfmt.Println("Shutting down aggregator")\n\t\t\treturn\n\t\t}\n\t}\n}\n\nfunc main() {\n\t// Create and start the aggregator\n\taggregator := NewEventAggregator()\n\tdefer aggregator.Shutdown()\n\n\t// Simulate some updates\n\tgo func() {\n\t\ttime.Sleep(500 * time.Millisecond)\n\t\tif err := aggregator.UpdateRules([]string{"a", "b", "c"}); err != nil {\n\t\t\tfmt.Println("Error updating rules:", err)\n\t\t}\n\t}()\n\n\tgo func() {\n\t\ttime.Sleep(1 * time.Second)\n\t\tif err := aggregator.UpdateRules([]string{"d", "e", "f"}); err != nil {\n\t\t\tfmt.Println("Error updating rules:", err)\n\t\t}\n\t}()\n\n\t// Give time for the updates to process\n\ttime.Sleep(2 * time.Second)\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"252-\u901a\u77e5\u673a\u5236\u76d1\u542c\u6a21\u5f0f",children:"2.5.2 \u901a\u77e5\u673a\u5236/\u76d1\u542c\u6a21\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// inventory/consumer.go\nfunc (s *InventoryService) OnPaymentSuccess(event PaymentSuccessEvent) {\n\t// \u53d8\u66f4\u5e93\u5b58\u72b6\u6001\n\ts.updateStock(event.OrderID)\n\t\n\t// \u901a\u77e5\u8ba2\u5355\u7cfb\u7edf\n\ts.notifyStatus(event.OrderID, "inventory_updated")\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"26-\u5355\u5143\u6d4b\u8bd5\u4e0e\u538b\u529b\u6d4b\u8bd5",children:"2.6 \u5355\u5143\u6d4b\u8bd5\u4e0e\u538b\u529b\u6d4b\u8bd5"}),"\n",(0,s.jsx)(n.h4,{id:"261-\u8986\u76d6\u7387\u9a8c\u8bc1\u53ef\u9760\u6027",children:"2.6.1 \u8986\u76d6\u7387\u9a8c\u8bc1\u53ef\u9760\u6027"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// \u5355\u5143\u6d4b\u8bd5 + \u9519\u8bef\u6ce8\u5165\nfunc TestReadConfig_FileNotExist(t *testing.T) {\n    _, err := ReadConfig("non_existent.json")\n    if err == nil {\n        t.Fatal("Expected error but got nil")\n    }\n    if !os.IsNotExist(err) {\n        t.Errorf("Unexpected error: %v", err)\n    }\n}\n\n// \u538b\u529b\u6d4b\u8bd5\nfunc BenchmarkConcurrentIncrement(b *testing.B) {\n    counter := SafeCounter{}\n    b.RunParallel(func(pb *testing.PB) {\n        for pb.Next() {\n            counter.Increment()\n        }\n    })\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"3-\u6545\u969c\u6f14\u7ec3\u65b9\u6848",children:"3. \u6545\u969c\u6f14\u7ec3\u65b9\u6848"}),"\n",(0,s.jsx)(n.h3,{id:"31-\u6df7\u6c8c\u5de5\u7a0b\u6d4b\u8bd5\u77e9\u9635",children:"3.1 \u6df7\u6c8c\u5de5\u7a0b\u6d4b\u8bd5\u77e9\u9635"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u6d4b\u8bd5\u7c7b\u578b"}),(0,s.jsx)(n.th,{children:"\u5b9e\u65bd\u5de5\u5177"}),(0,s.jsx)(n.th,{children:"\u9a8c\u8bc1\u6307\u6807"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u7f51\u7edc\u5ef6\u8fdf"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"tc netem add delay"})}),(0,s.jsx)(n.td,{children:"\u8d85\u65f6\u91cd\u8bd5\u673a\u5236\u662f\u5426\u751f\u6548"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u670d\u52a1\u4e2d\u65ad"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"kubectl delete pod"}),"/",(0,s.jsx)(n.code,{children:"kill -9"})]}),(0,s.jsx)(n.td,{children:"\u670d\u52a1\u81ea\u6108\u65f6\u95f4"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5185\u5b58\u6cc4\u6f0f"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"go tool pprof"})}),(0,s.jsx)(n.td,{children:"\u5185\u5b58\u589e\u957f\u66f2\u7ebf"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u78c1\u76d8\u6ee1"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"dd if=/dev/zero"})}),(0,s.jsx)(n.td,{children:"\u9519\u8bef\u65e5\u5fd7\u662f\u5426\u51c6\u786e"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"32-\u5178\u578b\u6545\u969c\u5904\u7406\u6d41\u7a0b",children:"3.2 \u5178\u578b\u6545\u969c\u5904\u7406\u6d41\u7a0b"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant Service\n    participant DB\n    \n    Client->>Service: \u8bf7\u6c42\n    Service->>DB: \u67e5\u8be2\n    DB--xService: \u8d85\u65f6\u9519\u8bef\n    Service->>Service: \u91cd\u8bd5(2\u6b21)\n    Service--\x3e>Client: \u8fd4\u56de\u964d\u7ea7\u6570\u636e\n    Service->>Logger: \u8bb0\u5f55\u9519\u8bef\u8be6\u60c5\n    Service->>Monitor: \u89e6\u53d1\u544a\u8b66"}),"\n",(0,s.jsx)(n.h2,{id:"4-\u751f\u4ea7\u73af\u5883\u68c0\u67e5\u6e05\u5355",children:"4. \u751f\u4ea7\u73af\u5883\u68c0\u67e5\u6e05\u5355"}),"\n",(0,s.jsx)(n.h3,{id:"41-\u90e8\u7f72\u524d\u5fc5\u68c0\u9879",children:"4.1 \u90e8\u7f72\u524d\u5fc5\u68c0\u9879"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u6240\u6709\u7f51\u7edc\u8c03\u7528\u8bbe\u7f6e\u8d85\u65f6\uff08\u22643s\uff09"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u5df2\u6b63\u786e\u914d\u7f6e"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5173\u952e\u8def\u5f84\u9519\u8bef\u65e5\u5fd7\u5df2\u57cb\u70b9"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u63a5\u5165\u76d1\u63a7\u7cfb\u7edf\uff08\u5982 Prometheus\uff09"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Goroutine\u6cc4\u6f0f\u6d4b\u8bd5\u901a\u8fc7"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"42-\u8fd0\u884c\u65f6\u76d1\u63a7\u5173\u952e\u6307\u6807",children:"4.2 \u8fd0\u884c\u65f6\u76d1\u63a7\u5173\u952e\u6307\u6807"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u76d1\u63a7\u547d\u4ee4\u793a\u4f8b\ngo tool pprof http://localhost:6060/debug/pprof/goroutine\ncurl -s http://localhost:9090/metrics | grep api_requests_total\njournalctl -u myapp -f | grep "ERROR"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"5-\u63a8\u8350\u5de5\u5177\u94fe\u589e\u5f3a",children:"5. \u63a8\u8350\u5de5\u5177\u94fe\u589e\u5f3a"}),"\n",(0,s.jsx)(n.h3,{id:"51-\u53ef\u9760\u6027\u589e\u5f3a\u5de5\u5177\u5305",children:"5.1 \u53ef\u9760\u6027\u589e\u5f3a\u5de5\u5177\u5305"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'import (\n    "github.com/avast/retry-go"          // \u91cd\u8bd5\u7b56\u7565\n    "github.com/sony/gobreaker"          // \u7194\u65ad\u5668\n    "golang.org/x/time/rate"             // \u9650\u6d41\u5668\n    "go.uber.org/goleak"                // Goroutine\u6cc4\u6f0f\u68c0\u6d4b\n    "github.com/fortytw2/leaktest"       // \u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\n)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"52-\u5178\u578b\u914d\u7f6e\u793a\u4f8b",children:"5.2 \u5178\u578b\u914d\u7f6e\u793a\u4f8b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// \u7194\u65ad\u5668\u914d\u7f6e\ncb := gobreaker.NewCircuitBreaker(gobreaker.Settings{\n    Name:        "API_CALL",\n    MaxRequests: 5,\n    Interval:    10 * time.Second,\n    Timeout:     30 * time.Second,\n})\n\n// \u9650\u6d41\u5668\u914d\u7f6e\nlimiter := rate.NewLimiter(rate.Every(100*time.Millisecond), 10)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"6-\u9644\u5f55\u53ef\u9760\u6027\u8bbe\u8ba1\u6a21\u5f0f\u901f\u67e5\u8868",children:"6. \u9644\u5f55\uff1a\u53ef\u9760\u6027\u8bbe\u8ba1\u6a21\u5f0f\u901f\u67e5\u8868"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u573a\u666f"}),(0,s.jsx)(n.th,{children:"\u6a21\u5f0f"}),(0,s.jsx)(n.th,{children:"\u5b9e\u73b0\u793a\u4f8b"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u6279\u91cf\u64cd\u4f5c"}),(0,s.jsx)(n.td,{children:"\u5206\u7247\u5904\u7406+\u5e76\u884c"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"errgroup"})," + ",(0,s.jsx)(n.code,{children:"sync.WaitGroup"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u7b2c\u4e09\u65b9\u670d\u52a1\u8c03\u7528"}),(0,s.jsx)(n.td,{children:"\u7194\u65ad+\u964d\u7ea7"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"gobreaker"})," + \u672c\u5730\u7f13\u5b58"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u6570\u636e\u5904\u7406\u7ba1\u9053"}),(0,s.jsx)(n.td,{children:"\u6709\u754c\u961f\u5217+\u80cc\u538b"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"buffered channel"})," + ",(0,s.jsx)(n.code,{children:"select"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5b9a\u65f6\u4efb\u52a1"}),(0,s.jsx)(n.td,{children:"\u5206\u5e03\u5f0f\u9501+\u5e42\u7b49"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"redislock"})," + \u4efb\u52a1ID\u53bb\u91cd"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u914d\u7f6e\u70ed\u66f4\u65b0"}),(0,s.jsx)(n.td,{children:"\u539f\u5b50\u6307\u9488\u4ea4\u6362"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"atomic.Value"})," + ",(0,s.jsx)(n.code,{children:"fsnotify"})]})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>d});var t=r(96540);const s={},i=t.createContext(s);function l(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);