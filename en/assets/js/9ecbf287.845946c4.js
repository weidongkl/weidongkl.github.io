"use strict";(self.webpackChunkweidongkl_github_io=self.webpackChunkweidongkl_github_io||[]).push([[678,3429],{50317:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"note/golang/design/future_proof","title":"Future-Proof \u673a\u5236","description":"\u5728\u7f16\u7a0b\u548c\u7cfb\u7edf\u8bbe\u8ba1\u4e2d\uff0cFuture-Proof \u673a\u5236\u6307\u7684\u662f\u901a\u8fc7\u5408\u7406\u7684\u67b6\u6784\u8bbe\u8ba1\u548c\u6280\u672f\u9009\u62e9\uff0c\u4f7f\u4ee3\u7801\u6216\u7cfb\u7edf\u80fd\u591f\u9002\u5e94\u672a\u6765\u7684\u9700\u6c42\u53d8\u5316\u3001\u6280\u672f\u6f14\u8fdb\u548c\u89c4\u6a21\u6269\u5c55\uff0c\u800c\u65e0\u9700\u5927\u89c4\u6a21\u91cd\u6784\u6216\u91cd\u5199\u3002\u5176\u6838\u5fc3\u76ee\u6807\u662f\u964d\u4f4e\u957f\u671f\u7ef4\u62a4\u6210\u672c\uff0c\u63d0\u9ad8\u53ef\u6269\u5c55\u6027\u3002","source":"@site/docs/note/golang/design/future_proof.md","sourceDirName":"note/golang/design","slug":"/note/golang/design/future_proof","permalink":"/en/docs/note/golang/design/future_proof","draft":false,"unlisted":false,"editUrl":"https://github.com/weidongkl/weidongkl.github.io/tree/master/docs/note/golang/design/future_proof.md","tags":[],"version":"current","lastUpdatedBy":"weidongkl","lastUpdatedAt":1756977992000,"frontMatter":{},"sidebar":"note","previous":{"title":"Token Bucket\uff08\u4ee4\u724c\u6876\uff09\u7b97\u6cd5","permalink":"/en/docs/note/golang/design/algorithm/token_bucket"},"next":{"title":"Golang \u591agoroutine\u4ea4\u4e92\u6a21\u578b","permalink":"/en/docs/note/golang/design/multi_goroutine"}}');var s=t(74848),i=t(28453);const o={},l="Future-Proof \u673a\u5236",a={},c=[{value:"1.1.  \u677e\u8026\u5408\uff08Loose Coupling\uff09",id:"11--\u677e\u8026\u5408loose-coupling",level:3},{value:"1.2. \u53ef\u6269\u5c55\u6027\uff08Extensibility\uff09",id:"12-\u53ef\u6269\u5c55\u6027extensibility",level:3},{value:"1.3. \u914d\u7f6e\u5316\u800c\u975e\u786c\u7f16\u7801",id:"13-\u914d\u7f6e\u5316\u800c\u975e\u786c\u7f16\u7801",level:3},{value:"1.4. \u534f\u8bae\u4e0e\u6570\u636e\u683c\u5f0f\u7684\u517c\u5bb9\u6027",id:"14-\u534f\u8bae\u4e0e\u6570\u636e\u683c\u5f0f\u7684\u517c\u5bb9\u6027",level:3},{value:"1.5. \u5e76\u53d1\u6a21\u578b\u7684\u53ef\u9002\u5e94\u6027",id:"15-\u5e76\u53d1\u6a21\u578b\u7684\u53ef\u9002\u5e94\u6027",level:3},{value:"1.6. \u53ef\u89c2\u6d4b\u6027\uff08Observability\uff09",id:"16-\u53ef\u89c2\u6d4b\u6027observability",level:3},{value:"1.7. \u9632\u5fa1\u6027\u7f16\u7a0b",id:"17-\u9632\u5fa1\u6027\u7f16\u7a0b",level:3},{value:"2. \u805a\u5408\u5668\u793a\u4f8b",id:"2-\u805a\u5408\u5668\u793a\u4f8b",level:2},{value:"3. \u53cd\u6a21\u5f0f\uff1a\u975e Future-Proof \u7684\u8bbe\u8ba1",id:"3-\u53cd\u6a21\u5f0f\u975e-future-proof-\u7684\u8bbe\u8ba1",level:2},{value:"4. \u603b\u7ed3",id:"4-\u603b\u7ed3",level:2}];function d(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"future-proof-\u673a\u5236",children:"Future-Proof \u673a\u5236"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u7f16\u7a0b\u548c\u7cfb\u7edf\u8bbe\u8ba1\u4e2d\uff0c",(0,s.jsx)(e.strong,{children:"Future-Proof \u673a\u5236"}),"\u6307\u7684\u662f\u901a\u8fc7\u5408\u7406\u7684\u67b6\u6784\u8bbe\u8ba1\u548c\u6280\u672f\u9009\u62e9\uff0c\u4f7f\u4ee3\u7801\u6216\u7cfb\u7edf\u80fd\u591f\u9002\u5e94\u672a\u6765\u7684\u9700\u6c42\u53d8\u5316\u3001\u6280\u672f\u6f14\u8fdb\u548c\u89c4\u6a21\u6269\u5c55\uff0c\u800c\u65e0\u9700\u5927\u89c4\u6a21\u91cd\u6784\u6216\u91cd\u5199\u3002\u5176\u6838\u5fc3\u76ee\u6807\u662f\u964d\u4f4e\u957f\u671f\u7ef4\u62a4\u6210\u672c\uff0c\u63d0\u9ad8\u53ef\u6269\u5c55\u6027\u3002"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h1,{id:"1-future-proof-\u673a\u5236\u7684\u5173\u952e\u539f\u5219",children:"1. Future-Proof \u673a\u5236\u7684\u5173\u952e\u539f\u5219"}),"\n",(0,s.jsx)(e.p,{children:"\u4ee5\u4e0b\u662f\u5b9e\u73b0 Future-Proof \u4ee3\u7801\u7684\u5173\u952e\u8bbe\u8ba1\u601d\u60f3\uff1a"}),"\n",(0,s.jsx)(e.h3,{id:"11--\u677e\u8026\u5408loose-coupling",children:"1.1.  \u677e\u8026\u5408\uff08Loose Coupling\uff09"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u76ee\u6807"}),"\uff1a\u6a21\u5757\u95f4\u901a\u8fc7\u6e05\u6670\u7684\u63a5\u53e3\u4ea4\u4e92\uff0c\u800c\u975e\u76f4\u63a5\u4f9d\u8d56\u5177\u4f53\u5b9e\u73b0\u3002\u4f7f\u7528\u63a5\u53e3\uff08Go \u7684 ",(0,s.jsx)(e.code,{children:"interface"}),"\uff09\u800c\u975e\u5177\u4f53\u7c7b\u578b\uff0c\u4f9d\u8d56\u6ce8\u5165\u800c\u975e\u786c\u7f16\u7801\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u4f18\u70b9"}),"\uff1a","\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u4e1a\u52a1\u903b\u8f91\u4e0e\u5177\u4f53\u5b9e\u73b0\u89e3\u8026"}),"\n",(0,s.jsx)(e.li,{children:"\u6613\u4e8e\u6269\u5c55\u65b0\u7684\u5b9e\u73b0\u65b9\u5f0f"}),"\n",(0,s.jsx)(e.li,{children:"\u4fbf\u4e8e\u5355\u5143\u6d4b\u8bd5\uff08\u53ef\u4ee5mock Notifier\uff09"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u8bbe\u8ba1\u70b9\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u9762\u5411\u63a5\u53e3\u7f16\u7a0b\uff1a\u4f9d\u8d56\u62bd\u8c61\u800c\u975e\u5177\u4f53\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.li,{children:"\u4f9d\u8d56\u6ce8\u5165\uff1a\u901a\u8fc7\u6784\u9020\u51fd\u6570\u6216\u65b9\u6cd5\u53c2\u6570\u6ce8\u5165\u4f9d\u8d56"}),"\n",(0,s.jsx)(e.li,{children:"\u5355\u4e00\u804c\u8d23\uff1a\u6bcf\u4e2a\u7ec4\u4ef6\u53ea\u5173\u6ce8\u81ea\u5df1\u7684\u6838\u5fc3\u529f\u80fd"}),"\n",(0,s.jsx)(e.li,{children:"\u6700\u5c0f\u77e5\u8bc6\u539f\u5219\uff1a\u7ec4\u4ef6\u53ea\u4e0e\u76f4\u63a5\u76f8\u5173\u7684\u7ec4\u4ef6\u4ea4\u4e92"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u677e\u8026\u5408\u793a\u4f8b\uff1a"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u5b9a\u4e49\u63a5\u53e3"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"// Notifier \u901a\u77e5\u63a5\u53e3\ntype Notifier interface {\n    Send(message string) error\n}\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u63a5\u53e3\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// EmailNotifier \u90ae\u4ef6\u901a\u77e5\u5b9e\u73b0\ntype EmailNotifier struct{}\n\nfunc (e EmailNotifier) Send(message string) error {\n    fmt.Printf("\u53d1\u9001\u90ae\u4ef6\u901a\u77e5: %s\\n", message)\n    return nil\n}\n\n// SMSNotifier \u77ed\u4fe1\u901a\u77e5\u5b9e\u73b0\ntype SMSNotifier struct{}\n\nfunc (s SMSNotifier) Send(message string) error {\n    fmt.Printf("\u53d1\u9001\u77ed\u4fe1\u901a\u77e5: %s\\n", message)\n    return nil\n}\n'})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u4e1a\u52a1\u903b\u8f91\u8c03\u7528\u63a5\u53e3"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// NotificationService \u901a\u77e5\u670d\u52a1\ntype NotificationService struct {\n    notifier Notifier\n}\n\nfunc NewNotificationService(notifier Notifier) *NotificationService {\n    return &NotificationService{notifier: notifier}\n}\n\nfunc (s *NotificationService) ProcessOrder(orderID string) {\n    // \u5904\u7406\u8ba2\u5355\u903b\u8f91...\n    message := fmt.Sprintf("\u8ba2\u5355 %s \u5df2\u5904\u7406", orderID)\n    _ = s.notifier.Send(message)\n}\n'})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u4e3b\u51fd\u6570\u8c03\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'func main() {\n    // \u53ef\u4ee5\u8f7b\u677e\u66ff\u6362\u901a\u77e5\u5b9e\u73b0\n    emailNotifier := EmailNotifier{}\n    service := NewNotificationService(emailNotifier)\n    service.ProcessOrder("12345")\n    \n    // \u5207\u6362\u4e3a\u77ed\u4fe1\u901a\u77e5\u4e0d\u9700\u8981\u4fee\u6539\u4e1a\u52a1\u903b\u8f91\n    smsNotifier := SMSNotifier{}\n    service = NewNotificationService(smsNotifier)\n    service.ProcessOrder("67890")\n}\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u7d27\u8026\u5408\u793a\u4f8b\uff1a"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528\u5177\u4f53\u7c7b\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// EmailSender \u90ae\u4ef6\u53d1\u9001\u5668\ntype EmailSender struct{}\n\nfunc (e EmailSender) SendEmail(message string) error {\n    fmt.Printf("\u53d1\u9001\u90ae\u4ef6: %s\\n", message)\n    return nil\n}\n'})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u4e1a\u52a1\u7c7b\u578b\u4f9d\u8d56\u5177\u4f53\u7c7b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// OrderProcessor \u8ba2\u5355\u5904\u7406\u5668\ntype OrderProcessor struct {\n    emailSender EmailSender\n}\n\nfunc (p *OrderProcessor) ProcessOrder(orderID string) {\n    // \u5904\u7406\u8ba2\u5355\u903b\u8f91...\n    message := fmt.Sprintf("\u8ba2\u5355 %s \u5df2\u5904\u7406", orderID)\n    _ = p.emailSender.SendEmail(message)\n}\n'})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u4e3b\u51fd\u6570\u8c03\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'func main() {\n    processor := OrderProcessor{emailSender: EmailSender{}}\n    processor.ProcessOrder("12345")\n    \n    // \u5982\u679c\u8981\u6539\u4e3a\u77ed\u4fe1\u901a\u77e5\uff0c\u5fc5\u987b\u4fee\u6539OrderProcessor\u7ed3\u6784\u4f53\u548c\u6240\u6709\u76f8\u5173\u4ee3\u7801\n}\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"12-\u53ef\u6269\u5c55\u6027extensibility",children:"1.2. \u53ef\u6269\u5c55\u6027\uff08Extensibility\uff09"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u76ee\u6807"}),"\uff1a\u65b0\u589e\u529f\u80fd\u65f6\u65e0\u9700\u4fee\u6539\u73b0\u6709\u4ee3\u7801\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u793a\u4f8b"}),"\uff1a\u901a\u8fc7\u7ec4\u5408\u800c\u975e\u7ee7\u627f\u6269\u5c55\u884c\u4e3a\uff08Go \u7684 ",(0,s.jsx)(e.code,{children:"embedding"})," \u6216\u4e2d\u95f4\u4ef6\u6a21\u5f0f\uff09\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"type LoggingAggregator struct {\n    *EventAggregator  // \u5d4c\u5165\u539f\u6709\u529f\u80fd\n    logger Logger\n}\n// \u65b0\u589e\u65e5\u5fd7\u80fd\u529b\u800c\u4e0d\u4fee\u6539\u539f\u59cb\u805a\u5408\u5668\n"})}),"\n",(0,s.jsx)(e.h3,{id:"13-\u914d\u7f6e\u5316\u800c\u975e\u786c\u7f16\u7801",children:"1.3. \u914d\u7f6e\u5316\u800c\u975e\u786c\u7f16\u7801"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u76ee\u6807"}),"\uff1a\u5c06\u6613\u53d8\u7684\u53c2\u6570\uff08\u5982\u8d85\u65f6\u65f6\u95f4\u3001\u89c4\u5219\u8def\u5f84\uff09\u5916\u7f6e\u4e3a\u914d\u7f6e\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u793a\u4f8b"}),"\uff1a\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6216\u914d\u7f6e\u6587\u4ef6\u9a71\u52a8\u884c\u4e3a\uff1a"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'timeout := os.Getenv("AGGREGATOR_TIMEOUT") \n'})}),"\n",(0,s.jsx)(e.h3,{id:"14-\u534f\u8bae\u4e0e\u6570\u636e\u683c\u5f0f\u7684\u517c\u5bb9\u6027",children:"1.4. \u534f\u8bae\u4e0e\u6570\u636e\u683c\u5f0f\u7684\u517c\u5bb9\u6027"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u76ee\u6807"}),"\uff1a\u6570\u636e\u4ea4\u4e92\u683c\u5f0f\uff08\u5982 JSON\u3001Protobuf\uff09\u652f\u6301\u5411\u540e\u517c\u5bb9\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u793a\u4f8b"}),"\uff1a\u4f7f\u7528 Protocol Buffers \u7684\u5b57\u6bb5\u7f16\u53f7\u673a\u5236\uff0c\u907f\u514d\u7834\u574f\u65e7\u7248\u89e3\u6790\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"15-\u5e76\u53d1\u6a21\u578b\u7684\u53ef\u9002\u5e94\u6027",children:"1.5. \u5e76\u53d1\u6a21\u578b\u7684\u53ef\u9002\u5e94\u6027"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u76ee\u6807"}),"\uff1a\u5e76\u53d1\u6a21\u578b\u80fd\u968f\u89c4\u6a21\u8c03\u6574\uff08\u5982 Goroutine \u6c60 vs \u56fa\u5b9a Worker\uff09\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u793a\u4f8b"}),"\uff1a\u5728\u4e4b\u524d\u7684\u805a\u5408\u5668\u4ee3\u7801\u4e2d\uff0c\u901a\u8fc7 Channel \u901a\u4fe1\u53ef\u8f7b\u677e\u6269\u5c55\u4e3a\u591a Worker\uff1a"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"for i := 0; i < runtime.NumCPU(); i++ {\n    go aggregator.processRequests() \n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"16-\u53ef\u89c2\u6d4b\u6027observability",children:"1.6. \u53ef\u89c2\u6d4b\u6027\uff08Observability\uff09"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u76ee\u6807"}),"\uff1a\u5185\u7f6e\u65e5\u5fd7\u3001\u6307\u6807\u3001\u94fe\u8def\u8ffd\u8e2a\u7b49\uff0c\u4fbf\u4e8e\u672a\u6765\u8bca\u65ad\u95ee\u9898\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u793a\u4f8b"}),"\uff1a\u5728 ",(0,s.jsx)(e.code,{children:"rulesUpdateRequest"})," \u4e2d\u6dfb\u52a0\u8bf7\u6c42 ID \u548c\u8ba1\u65f6\uff1a"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"type rulesUpdateRequest struct {\n    RequestID string // \u7528\u4e8e\u8ffd\u8e2a\n    StartTime time.Time\n    // ...\u5176\u4ed6\u5b57\u6bb5\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"17-\u9632\u5fa1\u6027\u7f16\u7a0b",children:"1.7. \u9632\u5fa1\u6027\u7f16\u7a0b"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u76ee\u6807"}),"\uff1a\u5904\u7406\u8fb9\u754c\u6761\u4ef6\uff08\u5982 nil Channel\u3001\u8d85\u65f6\uff09\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u793a\u4f8b"}),"\uff1a\u5728 Channel \u901a\u4fe1\u4e2d\u6dfb\u52a0\u8d85\u65f6\uff1a"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'func (a *EventAggregator) UpdateRules(rules []string) error {\n    req := &rulesUpdateRequest{..., response: make(chan error, 1)}\n    select {\n    case a.updateChannel <- req:\n        return <-req.response\n    case <-time.After(1 * time.Second):\n        return errors.New("update timeout")\n    }\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"2-\u805a\u5408\u5668\u793a\u4f8b",children:"2. \u805a\u5408\u5668\u793a\u4f8b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"time"\n)\n\n// EventAggregator manages a set of rules and processes updates through channels\ntype EventAggregator struct {\n\trules         []string\n\tupdateChannel chan *rulesUpdateRequest\n\tshutdownChan  chan struct{}\n}\n\n// rulesUpdateRequest represents a request to update the rules\ntype rulesUpdateRequest struct {\n\tnewRules []string\n\tresponse chan error\n}\n\n// NewEventAggregator creates and starts a new EventAggregator\nfunc NewEventAggregator() *EventAggregator {\n\tagg := &EventAggregator{\n\t\trules:         []string{},\n\t\tupdateChannel: make(chan *rulesUpdateRequest),\n\t\tshutdownChan:  make(chan struct{}),\n\t}\n\t\n\tgo agg.processRequests()\n\treturn agg\n}\n\n// UpdateRules safely updates the rules by sending a request through the channel\nfunc (a *EventAggregator) UpdateRules(newRules []string) error {\n\treq := &rulesUpdateRequest{\n\t\tnewRules: newRules,\n\t\tresponse: make(chan error, 1), // Buffered to avoid blocking\n\t}\n\t\n\ta.updateChannel <- req\n\treturn <-req.response\n}\n\n// Shutdown gracefully stops the aggregator\nfunc (a *EventAggregator) Shutdown() {\n\tclose(a.shutdownChan)\n}\n\n// processRequests handles incoming requests in a thread-safe manner\nfunc (a *EventAggregator) processRequests() {\n\tfor {\n\t\tselect {\n\t\tcase req := <-a.updateChannel:\n\t\t\ta.rules = req.newRules\n\t\t\tfmt.Println("Updated rules:", a.rules)\n\t\t\treq.response <- nil\n\t\tcase <-a.shutdownChan:\n\t\t\tfmt.Println("Shutting down aggregator")\n\t\t\treturn\n\t\t}\n\t}\n}\n\nfunc main() {\n\t// Create and start the aggregator\n\taggregator := NewEventAggregator()\n\tdefer aggregator.Shutdown()\n\n\t// Simulate some updates\n\tgo func() {\n\t\ttime.Sleep(500 * time.Millisecond)\n\t\tif err := aggregator.UpdateRules([]string{"a", "b", "c"}); err != nil {\n\t\t\tfmt.Println("Error updating rules:", err)\n\t\t}\n\t}()\n\n\tgo func() {\n\t\ttime.Sleep(1 * time.Second)\n\t\tif err := aggregator.UpdateRules([]string{"d", "e", "f"}); err != nil {\n\t\t\tfmt.Println("Error updating rules:", err)\n\t\t}\n\t}()\n\n\t// Give time for the updates to process\n\ttime.Sleep(2 * time.Second)\n}\n'})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u72b6\u6001\u9694\u79bb"}),"\uff1a\u6240\u6709\u89c4\u5219\u66f4\u65b0\u901a\u8fc7 Channel \u4e32\u884c\u5316\uff0c\u907f\u514d\u7ade\u6001\u6761\u4ef6\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u6613\u4e8e\u6269\u5c55"}),"\uff1a\u53ef\u65b0\u589e ",(0,s.jsx)(e.code,{children:"QueryRules()"})," \u65b9\u6cd5\u800c\u4e0d\u5f71\u54cd\u73b0\u6709\u903b\u8f91\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5e76\u53d1\u53cb\u597d"}),"\uff1aChannel \u6a21\u578b\u5929\u7136\u652f\u6301\u534f\u7a0b\u6269\u5c55\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5173\u95ed\u63a7\u5236"}),"\uff1a\u901a\u8fc7 ",(0,s.jsx)(e.code,{children:"shutdownChan"})," \u5b9e\u73b0\u4f18\u96c5\u7ec8\u6b62\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.p,{children:"\u6839\u636e\u539f\u5219\uff0c\u6267\u884c\u90e8\u5206\u4f18\u5316"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"context"\n\t"errors"\n\t"fmt"\n\t"sync"\n\t"time"\n)\n\n// RuleSet represents a collection of rules with metadata\ntype RuleSet struct {\n\tRules    []string\n\tVersion  int       // Track changes over time\n\tModified time.Time // Last update timestamp\n}\n\n// SetRulesRequest encapsulates a rules update operation\ntype SetRulesRequest struct {\n\tNewRules  []string\n\tResponse  chan error\n\tRequestID string    // For tracing\n\tTimestamp time.Time // For auditing\n}\n\n// AggregatorOptions configures aggregator behavior\ntype AggregatorOptions struct {\n\tMaxPendingRequests int           // Buffer size for requests\n\tRequestTimeout     time.Duration // Timeout for rule updates\n\tEnableValidation   bool          // Future: validate rules before applying\n}\n\n// Aggregator manages rule sets with thread-safe operations\ntype Aggregator struct {\n\tcurrentRuleSet RuleSet\n\toptions        AggregatorOptions\n\n\trequestChan  chan *SetRulesRequest\n\tqueryChan    chan chan RuleSet // New channel for safe rule queries\n\tcommandChan  chan func()       // Generic command channel for future extensions\n\tstopChan     chan struct{}\n\tshutdownOnce sync.Once\n\tstopWg       sync.WaitGroup\n}\n\n// NewAggregator creates a configured aggregator instance\nfunc NewAggregator(opts AggregatorOptions) *Aggregator {\n\tif opts.MaxPendingRequests <= 0 {\n\t\topts.MaxPendingRequests = 10\n\t}\n\tif opts.RequestTimeout <= 0 {\n\t\topts.RequestTimeout = 2 * time.Second\n\t}\n\n\treturn &Aggregator{\n\t\tcurrentRuleSet: RuleSet{Version: 1},\n\t\toptions:        opts,\n\t\trequestChan:    make(chan *SetRulesRequest, opts.MaxPendingRequests),\n\t\tqueryChan:      make(chan chan RuleSet),\n\t\tcommandChan:    make(chan func()),\n\t\tstopChan:       make(chan struct{}),\n\t}\n}\n\n// Run starts the aggregator\'s processing loop\nfunc (a *Aggregator) Run() {\n\ta.stopWg.Add(1)\n\tdefer a.stopWg.Done()\n\n\tfor {\n\t\tselect {\n\t\tcase req := <-a.requestChan:\n\t\t\ta.handleSetRules(req)\n\t\tcase respChan := <-a.queryChan:\n\t\t\ta.handleGetRules(respChan)\n\t\tcase cmd := <-a.commandChan:\n\t\t\tcmd() // Execute arbitrary commands\n\t\tcase <-a.stopChan:\n\t\t\treturn\n\t\t}\n\t}\n}\n\nfunc (a *Aggregator) handleSetRules(req *SetRulesRequest) {\n\tdefer close(req.Response)\n\n\t// Future: could add validation here\n\tif a.options.EnableValidation {\n\t\t// Validate rules before applying\n\t}\n\n\ta.currentRuleSet = RuleSet{\n\t\tRules:    req.NewRules,\n\t\tVersion:  a.currentRuleSet.Version + 1,\n\t\tModified: time.Now(),\n\t}\n\n\tfmt.Printf("Updated rules (v%d): %v\\n", a.currentRuleSet.Version, a.currentRuleSet.Rules)\n\treq.Response <- nil\n}\n\nfunc (a *Aggregator) handleGetRules(respChan chan RuleSet) {\n\trespChan <- a.currentRuleSet\n\tclose(respChan)\n}\n\n// SetRules updates the rule set with timeout support\nfunc (a *Aggregator) SetRules(ctx context.Context, rules []string) error {\n\treq := &SetRulesRequest{\n\t\tNewRules:  rules,\n\t\tResponse:  make(chan error),\n\t\tRequestID: fmt.Sprintf("req-%d", time.Now().UnixNano()),\n\t\tTimestamp: time.Now(),\n\t}\n\n\tselect {\n\tcase a.requestChan <- req:\n\t\tselect {\n\t\tcase err := <-req.Response:\n\t\t\treturn err\n\t\tcase <-ctx.Done():\n\t\t\treturn ctx.Err()\n\t\t}\n\tcase <-a.stopChan:\n\t\treturn errors.New("aggregator is shutting down")\n\tcase <-ctx.Done():\n\t\treturn ctx.Err()\n\t}\n}\n\n// GetRules safely retrieves the current rule set\nfunc (a *Aggregator) GetRules(ctx context.Context) (RuleSet, error) {\n\trespChan := make(chan RuleSet)\n\n\tselect {\n\tcase a.queryChan <- respChan:\n\t\tselect {\n\t\tcase rules := <-respChan:\n\t\t\treturn rules, nil\n\t\tcase <-ctx.Done():\n\t\t\treturn RuleSet{}, ctx.Err()\n\t\t}\n\tcase <-a.stopChan:\n\t\treturn RuleSet{}, errors.New("aggregator is shutting down")\n\tcase <-ctx.Done():\n\t\treturn RuleSet{}, ctx.Err()\n\t}\n}\n\n// Stop gracefully shuts down the aggregator\nfunc (a *Aggregator) Stop() {\n\ta.shutdownOnce.Do(func() {\n\t\tclose(a.stopChan)\n\t\ta.stopWg.Wait()\n\t\tclose(a.requestChan)\n\t\tclose(a.queryChan)\n\t\tclose(a.commandChan)\n\t\tfmt.Println("Aggregator stopped gracefully")\n\t})\n}\n\n// ExecuteCommand provides extension point for future operations\nfunc (a *Aggregator) ExecuteCommand(ctx context.Context, cmd func()) error {\n\tselect {\n\tcase a.commandChan <- cmd:\n\t\treturn nil\n\tcase <-a.stopChan:\n\t\treturn errors.New("aggregator is shutting down")\n\tcase <-ctx.Done():\n\t\treturn ctx.Err()\n\t}\n}\n\nfunc main() {\n\t// Configurable options\n\topts := AggregatorOptions{\n\t\tMaxPendingRequests: 20,\n\t\tRequestTimeout:     3 * time.Second,\n\t\tEnableValidation:   false, // Could be enabled in future\n\t}\n\n\taggregator := NewAggregator(opts)\n\tgo aggregator.Run()\n\n\t// Example usage with context\n\tctx, cancel := context.WithTimeout(context.Background(), 2*time.Second)\n\tdefer cancel()\n\n\t// Set rules\n\terr := aggregator.SetRules(ctx, []string{"a", "b", "c"})\n\tif err != nil {\n\t\tfmt.Println("Error setting rules:", err)\n\t}\n\n\t// Get rules\n\trules, err := aggregator.GetRules(ctx)\n\tif err != nil {\n\t\tfmt.Println("Error getting rules:", err)\n\t} else {\n\t\tfmt.Printf("Current rules (v%d): %v\\n", rules.Version, rules.Rules)\n\t}\n\n\t// Execute custom command\n\taggregator.ExecuteCommand(ctx, func() {\n\t\tfmt.Println("Executing custom command")\n\t})\n\n\taggregator.Stop()\n}\n'})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Enhanced Rule Metadata"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Added ",(0,s.jsx)(e.code,{children:"RuleSet"})," struct with versioning and timestamps"]}),"\n",(0,s.jsx)(e.li,{children:"Supports audit trails and change tracking"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Configurable Options"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"AggregatorOptions"})," allows tuning without code changes"]}),"\n",(0,s.jsx)(e.li,{children:"Supports future features like validation"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Multiple Communication Channels"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Separate channels for commands (",(0,s.jsx)(e.code,{children:"commandChan"}),") and queries (",(0,s.jsx)(e.code,{children:"queryChan"}),")"]}),"\n",(0,s.jsx)(e.li,{children:"Prevents mixing of operation types"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Context Support"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"All operations respect context for timeouts/cancellation"}),"\n",(0,s.jsx)(e.li,{children:"Better integration with modern Go applications"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Extension Points"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ExecuteCommand"})," method for adding future functionality"]}),"\n",(0,s.jsx)(e.li,{children:"Generic command channel pattern"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Improved Shutdown"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"sync.Once"})," ensures safe single shutdown"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"sync.WaitGroup"})," for proper goroutine cleanup"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Thread-Safe Queries"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Added safe ",(0,s.jsx)(e.code,{children:"GetRules"})," method via channel"]}),"\n",(0,s.jsx)(e.li,{children:"No direct access to internal state"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Request Tracing"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Added request IDs for debugging"}),"\n",(0,s.jsx)(e.li,{children:"Timestamps for all operations"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528\u547d\u4ee4\u6a21\u5f0f\u4f18\u5316"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"context"\n\t"errors"\n\t"fmt"\n\t"sync"\n\t"time"\n)\n\n// Command defines the interface all commands must implement\ntype Command interface {\n\tExecute(ctx context.Context) error\n}\n\n// CommandHandler processes commands\ntype CommandHandler struct {\n\tcommands chan Command\n\tstopChan chan struct{}\n\twg       sync.WaitGroup\n}\n\n// NewCommandHandler creates a new handler with specified queue size\nfunc NewCommandHandler(queueSize int) *CommandHandler {\n\treturn &CommandHandler{\n\t\tcommands: make(chan Command, queueSize),\n\t\tstopChan: make(chan struct{}),\n\t}\n}\n\n// Start begins processing commands\nfunc (h *CommandHandler) Start() {\n\th.wg.Add(1)\n\tgo func() {\n\t\tdefer h.wg.Done()\n\t\tfor {\n\t\t\tselect {\n\t\t\tcase cmd := <-h.commands:\n\t\t\t\tctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)\n\t\t\t\terr := cmd.Execute(ctx)\n\t\t\t\tcancel()\n\t\t\t\tif err != nil {\n\t\t\t\t\tfmt.Printf("Command execution failed: %v\\n", err)\n\t\t\t\t}\n\t\t\tcase <-h.stopChan:\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}()\n}\n\n// Submit sends a command for execution\nfunc (h *CommandHandler) Submit(ctx context.Context, cmd Command) error {\n\tselect {\n\tcase h.commands <- cmd:\n\t\treturn nil\n\tcase <-h.stopChan:\n\t\treturn errors.New("handler is shutting down")\n\tcase <-ctx.Done():\n\t\treturn ctx.Err()\n\t}\n}\n\n// Stop gracefully shuts down the handler\nfunc (h *CommandHandler) Stop() {\n\tclose(h.stopChan)\n\th.wg.Wait()\n\tclose(h.commands)\n}\n\n// --- Concrete Commands ---\n\n// SetRulesCommand implements Command for rule updates\ntype SetRulesCommand struct {\n\tAggregator *Aggregator\n\tNewRules   []string\n}\n\nfunc (c *SetRulesCommand) Execute(ctx context.Context) error {\n\treturn c.Aggregator.SetRules(ctx, c.NewRules)\n}\n\n// GetRulesCommand implements Command for rule queries\ntype GetRulesCommand struct {\n\tAggregator *Aggregator\n\tResultChan chan<- RuleSet\n}\n\nfunc (c *GetRulesCommand) Execute(ctx context.Context) error {\n\trules, err := c.Aggregator.GetRules(ctx)\n\tif err != nil {\n\t\treturn err\n\t}\n\tc.ResultChan <- rules\n\treturn nil\n}\n\n// --- Aggregator Implementation ---\n\ntype RuleSet struct {\n\tRules    []string\n\tVersion  int\n\tModified time.Time\n}\n\ntype Aggregator struct {\n\tmu          sync.Mutex\n\tcurrentRule RuleSet\n}\n\nfunc (a *Aggregator) SetRules(ctx context.Context, rules []string) error {\n\ta.mu.Lock()\n\tdefer a.mu.Unlock()\n\t\n\tselect {\n\tcase <-ctx.Done():\n\t\treturn ctx.Err()\n\tdefault:\n\t\ta.currentRule = RuleSet{\n\t\t\tRules:    rules,\n\t\t\tVersion:  a.currentRule.Version + 1,\n\t\t\tModified: time.Now(),\n\t\t}\n\t\tfmt.Printf("Rules updated to version %d\\n", a.currentRule.Version)\n\t\treturn nil\n\t}\n}\n\nfunc (a *Aggregator) GetRules(ctx context.Context) (RuleSet, error) {\n\ta.mu.Lock()\n\tdefer a.mu.Unlock()\n\t\n\tselect {\n\tcase <-ctx.Done():\n\t\treturn RuleSet{}, ctx.Err()\n\tdefault:\n\t\treturn a.currentRule, nil\n\t}\n}\n\n// --- Usage Example ---\nfunc main() {\n\t// Create components\n\thandler := NewCommandHandler(10)\n\taggregator := &Aggregator{\n\t\tcurrentRule: RuleSet{Version: 0},\n\t}\n\t\n\t// Start command processor\n\thandler.Start()\n\tdefer handler.Stop()\n\n\t// Submit commands\n\tctx := context.Background()\n\t\n\t// Set rules command\n\tsetCmd := &SetRulesCommand{\n\t\tAggregator: aggregator,\n\t\tNewRules:   []string{"a", "b", "c"},\n\t}\n\thandler.Submit(ctx, setCmd)\n\n\t// Get rules command\n\tresultChan := make(chan RuleSet, 1)\n\tgetCmd := &GetRulesCommand{\n\t\tAggregator: aggregator,\n\t\tResultChan: resultChan,\n\t}\n\thandler.Submit(ctx, getCmd)\n\t\n\t// Wait for result\n\tselect {\n\tcase rules := <-resultChan:\n\t\tfmt.Printf("Current rules: %v\\n", rules.Rules)\n\tcase <-time.After(1 * time.Second):\n\t\tfmt.Println("Timeout waiting for rules")\n\t}\n}\n'})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"The Command Handler pattern is a behavioral design pattern that encapsulates requests as objects, allowing for parameterization of clients with different requests, queuing of requests, and support for undoable operations. Here's how to implement it in your aggregator:"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Core Components"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Command Interface"}),": Defines the execution contract"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Concrete Commands"}),": Encapsulate specific actions and parameters"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Invoker"}),": Receives and executes commands"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Receiver"}),": Knows how to perform the operations"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Key Features"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Command Interface"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"type Command interface {\n    Execute(ctx context.Context) error\n}\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Concrete Commands"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Each command encapsulates all parameters needed for execution"}),"\n",(0,s.jsx)(e.li,{children:"Commands can be serialized/deserialized for distributed systems"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Command Handler"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Manages a queue of commands"}),"\n",(0,s.jsx)(e.li,{children:"Processes commands sequentially in a goroutine"}),"\n",(0,s.jsx)(e.li,{children:"Supports graceful shutdown"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Benefits"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Decoupling"}),": Separates command creation from execution"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Extensibility"}),": Easy to add new command types"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Composability"}),": Commands can be combined into macros"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Undo/Redo"}),": Can be extended to support command history"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Advanced Extensions"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Command Middleware"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"type CommandMiddleware func(Command) Command\n\nfunc LoggingMiddleware(next Command) Command {\n    return &loggedCommand{next}\n}\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Transaction Support"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"type TransactionCommand struct {\n    Commands []Command\n}\n\nfunc (t *TransactionCommand) Execute(ctx context.Context) error {\n    // Execute all or nothing\n}\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Priority Commands"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"type PriorityCommand struct {\n    Command\n    Priority int\n}\n      \n// Use priority queue instead of channel\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"3-\u53cd\u6a21\u5f0f\u975e-future-proof-\u7684\u8bbe\u8ba1",children:"3. \u53cd\u6a21\u5f0f\uff1a\u975e Future-Proof \u7684\u8bbe\u8ba1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"// \u786c\u7f16\u7801\u5b9e\u73b0\uff0c\u672a\u6765\u96be\u4ee5\u4fee\u6539\nvar globalRules []string\n\nfunc UpdateRules(rules []string) {\n    globalRules = rules // \u76f4\u63a5\u4fee\u6539\u5168\u5c40\u72b6\u6001\uff0c\u7ebf\u7a0b\u4e0d\u5b89\u5168\n}\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"4-\u603b\u7ed3",children:"4. \u603b\u7ed3"}),"\n",(0,s.jsxs)(e.p,{children:["Future-Proof \u4e0d\u662f\u8fc7\u5ea6\u8bbe\u8ba1\uff0c\u800c\u662f\u901a\u8fc7\u9075\u5faa ",(0,s.jsx)(e.strong,{children:"SOLID \u539f\u5219"}),"\u548c ",(0,s.jsx)(e.strong,{children:"\u5e76\u53d1\u5b89\u5168\u5b9e\u8df5"}),"\uff0c\u8ba9\u4ee3\u7801\u5177\u5907\uff1a"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u9002\u5e94\u53d8\u5316"}),"\u7684\u80fd\u529b"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5e73\u6ed1\u6f14\u8fdb"}),"\u7684\u8def\u5f84"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u8bca\u65ad\u95ee\u9898"}),"\u7684\u624b\u6bb5"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5728 Go \u4e2d\uff0cChannel \u548c Interface \u662f\u6784\u5efa Future-Proof \u7cfb\u7edf\u7684\u6838\u5fc3\u5de5\u5177\u3002"})]})}function u(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>o,x:()=>l});var r=t(96540);const s={},i=r.createContext(s);function o(n){const e=r.useContext(i);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);