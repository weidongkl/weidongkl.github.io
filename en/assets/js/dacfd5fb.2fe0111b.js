"use strict";(self.webpackChunkweidongkl_github_io=self.webpackChunkweidongkl_github_io||[]).push([[1848],{34739:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"note/os/chroot","title":"chroot Usage","description":"1. Overview","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/note/os/chroot.md","sourceDirName":"note/os","slug":"/note/os/chroot","permalink":"/en/docs/note/os/chroot","draft":false,"unlisted":false,"editUrl":"https://github.com/weidongkl/weidongkl.github.io/tree/master/docs/note/os/chroot.md","tags":[],"version":"current","lastUpdatedBy":"weidongkl","lastUpdatedAt":1761818265000,"frontMatter":{},"sidebar":"note","previous":{"title":"\u4f7f\u7528SSH \u96a7\u9053\u8fde\u63a5\u7f51\u7edc","permalink":"/en/docs/note/os/network/ssh_tunnel"},"next":{"title":"Kernel Module Makefile: -y vs -objs","permalink":"/en/docs/note/os/kernel/build_flag"}}');var r=s(74848),t=s(28453);const i={},c="chroot Usage",d={},a=[{value:"1. <strong>Overview</strong>",id:"1-overview",level:2},{value:"2. <strong>How It Works</strong>",id:"2-how-it-works",level:2},{value:"3. <strong>Basic Usage</strong>",id:"3-basic-usage",level:2},{value:"3.1. Enter <code>chroot</code> Environment",id:"31-enter-chroot-environment",level:3},{value:"3.2. Execute Commands in <code>chroot</code> Environment",id:"32-execute-commands-in-chroot-environment",level:3},{value:"4. <strong>Creating a Basic <code>chroot</code> Environment</strong>",id:"4-creating-a-basic-chroot-environment",level:2},{value:"5. <strong>Use Cases</strong>",id:"5-use-cases",level:2},{value:"5.1. <strong>System Recovery</strong>",id:"51-system-recovery",level:3},{value:"5.2. <strong>Isolated Environment (Sandbox)</strong>",id:"52-isolated-environment-sandbox",level:3},{value:"5.3. <strong>Software Package Compilation</strong>",id:"53-software-package-compilation",level:3},{value:"5.4. <strong>Running Specific Versions of Applications</strong>",id:"54-running-specific-versions-of-applications",level:3},{value:"6. <strong>Precautions</strong>",id:"6-precautions",level:2},{value:"7. <strong>Summary</strong>",id:"7-summary",level:2}];function l(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsxs)(n.h1,{id:"chroot-usage",children:[(0,r.jsx)(n.code,{children:"chroot"})," Usage"]})}),"\n",(0,r.jsxs)(n.h2,{id:"1-overview",children:["1. ",(0,r.jsx)(n.strong,{children:"Overview"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"chroot"})," is a Linux command used to change the root directory (",(0,r.jsx)(n.code,{children:"/"}),") of a process and its child processes to a specified directory. In other words, it changes the program's root directory path, making the program unable to access higher-level file systems. It is commonly used for environment isolation, creating sandboxes, system recovery, and other scenarios."]}),"\n",(0,r.jsxs)(n.h2,{id:"2-how-it-works",children:["2. ",(0,r.jsx)(n.strong,{children:"How It Works"})]}),"\n",(0,r.jsxs)(n.p,{children:["When using the ",(0,r.jsx)(n.code,{children:"chroot"})," command, the specified path becomes the new root directory. When the process runs, file system access will be relative to the new root directory (chroot directory), and other parts of the system will not be visible."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"chroot <new_root> [command]\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<new_root>"}),": Specifies the new root directory."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"[command]"}),": Optional command, indicating the command to be executed in the new root directory environment. If no command is specified, an interactive shell will be started by default."]}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"3-basic-usage",children:["3. ",(0,r.jsx)(n.strong,{children:"Basic Usage"})]}),"\n",(0,r.jsxs)(n.h3,{id:"31-enter-chroot-environment",children:["3.1. Enter ",(0,r.jsx)(n.code,{children:"chroot"})," Environment"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo chroot /path/to/new_root\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This command will switch the root directory to ",(0,r.jsx)(n.code,{children:"/path/to/new_root"})," and start an interactive shell."]}),"\n",(0,r.jsxs)(n.h3,{id:"32-execute-commands-in-chroot-environment",children:["3.2. Execute Commands in ",(0,r.jsx)(n.code,{children:"chroot"})," Environment"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo chroot /path/to/new_root /bin/bash\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Execute ",(0,r.jsx)(n.code,{children:"/bin/bash"})," in the ",(0,r.jsx)(n.code,{children:"/path/to/new_root"})," directory and enter a new environment."]}),"\n",(0,r.jsxs)(n.h2,{id:"4-creating-a-basic-chroot-environment",children:["4. ",(0,r.jsxs)(n.strong,{children:["Creating a Basic ",(0,r.jsx)(n.code,{children:"chroot"})," Environment"]})]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Create New Root Directory"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo mkdir -p /path/to/new_root\n"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Mount Necessary Virtual File Systems"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Some system files, such as ",(0,r.jsx)(n.code,{children:"/proc"}),", need to be mounted in the chroot environment."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo mount -t proc /proc /path/to/new_root/proc\nsudo mount -t sysfs /sys /path/to/new_root/sys\nsudo mount -o bind /dev /path/to/new_root/dev\nsudo mount -o bind /dev/pts /path/to/new_root/dev/pts\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Mounting directories such as ",(0,r.jsx)(n.code,{children:"/proc"}),", ",(0,r.jsx)(n.code,{children:"/sys"}),", ",(0,r.jsx)(n.code,{children:"/dev"}),", and ",(0,r.jsx)(n.code,{children:"/dev/pts"})," is to ensure that processes can correctly access and use these virtual file systems, which provide important system information and device interfaces. Without these mounts, some programs or commands may fail because they depend on files in these directories to obtain system status or interact with hardware."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"/proc"})," is a virtual file system that provides data about system processes, kernel information, and other runtime information. In a ",(0,r.jsx)(n.code,{children:"chroot"})," environment, if ",(0,r.jsx)(n.code,{children:"/proc"})," is not mounted, many programs and commands (such as ",(0,r.jsx)(n.code,{children:"ps"}),", ",(0,r.jsx)(n.code,{children:"top"}),", ",(0,r.jsx)(n.code,{children:"free"}),", etc.) cannot work properly because they depend on information in ",(0,r.jsx)(n.code,{children:"/proc"})," to obtain status about the current system and processes."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"/sys"})," is also a virtual file system that provides dynamic information about system hardware, kernel parameters, device status, etc. Many device drivers and system services depend on files in ",(0,r.jsx)(n.code,{children:"/sys"})," for hardware management and system configuration. Without mounting ",(0,r.jsx)(n.code,{children:"/sys"}),", some programs may not be able to obtain hardware information or interact with devices."]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Number of CPU cores in the system"}),"\n",(0,r.jsx)(n.li,{children:"Network interface configuration"}),"\n",(0,r.jsx)(n.li,{children:"Battery status (on laptops)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"/dev"})," directory contains all device files (such as hard drives, terminals, USB devices, etc.). These device files are interfaces for user-space programs to interact with hardware devices. For programs running in a ",(0,r.jsx)(n.code,{children:"chroot"})," environment, access to device files is necessary."]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/dev/sda"}),": Hard drive device file"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/dev/null"}),": Device for discarding data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/dev/tty"}),": Terminal device"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Without mounting ",(0,r.jsx)(n.code,{children:"/dev"}),", programs cannot access hardware devices or interact with terminals, network interfaces, etc."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"/dev/pts"})," directory is used to manage pseudo-terminal devices (pty). It stores terminal-related device files, such as ",(0,r.jsx)(n.code,{children:"/dev/pts/0"}),", etc. This is very important for supporting multi-user, multi-terminal systems, especially for environments running interactive shells and command-line programs."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, when you use ",(0,r.jsx)(n.code,{children:"ssh"})," or ",(0,r.jsx)(n.code,{children:"tmux"})," to log into the system, terminal devices are usually represented through ",(0,r.jsx)(n.code,{children:"/dev/pts"}),". Without mounting ",(0,r.jsx)(n.code,{children:"/dev/pts"}),", you will not be able to start or use interactive terminals (such as when executing ",(0,r.jsx)(n.code,{children:"bash"})," or ",(0,r.jsx)(n.code,{children:"sh"})," commands in a ",(0,r.jsx)(n.code,{children:"chroot"})," environment)."]}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Install Necessary Libraries and Commands"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Ensure that the required libraries and programs are installed in the new root directory. You may need to copy or mount some files to make the chroot environment run normally."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo cp /bin/bash /path/to/new_root/bin/\nsudo cp /lib/x86_64-linux-gnu/libtinfo.so.6 /path/to/new_root/lib/x86_64-linux-gnu/\nsudo cp /lib/x86_64-linux-gnu/libc.so.6 /path/to/new_root/lib/x86_64-linux-gnu/\n"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["Enter ",(0,r.jsx)(n.code,{children:"chroot"})," Environment"]})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo chroot /path/to/new_root /bin/bash\n"})}),"\n",(0,r.jsxs)(n.p,{children:["At this point, you have entered a new chroot environment with the root directory as ",(0,r.jsx)(n.code,{children:"/path/to/new_root"}),"."]}),"\n",(0,r.jsxs)(n.h2,{id:"5-use-cases",children:["5. ",(0,r.jsx)(n.strong,{children:"Use Cases"})]}),"\n",(0,r.jsxs)(n.h3,{id:"51-system-recovery",children:["5.1. ",(0,r.jsx)(n.strong,{children:"System Recovery"})]}),"\n",(0,r.jsxs)(n.p,{children:["When the system cannot start or is damaged, you can use ",(0,r.jsx)(n.code,{children:"chroot"})," to enter the system and fix problems. For example, enter the system's root file system through ",(0,r.jsx)(n.code,{children:"chroot"})," to reinstall the bootloader or fix damaged files."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo mount /dev/sda1 /mnt\nsudo mount --bind /dev /mnt/dev\nsudo mount --bind /proc /mnt/proc\nsudo mount --bind /sys /mnt/sys\nsudo chroot /mnt\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"52-isolated-environment-sandbox",children:["5.2. ",(0,r.jsx)(n.strong,{children:"Isolated Environment (Sandbox)"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"chroot"})," can be used to create a restricted environment, limiting a process to only access specific directories. It is commonly used as the foundation implementation of containerization technology, although modern containers use more powerful tools (such as Docker) to provide isolation."]}),"\n",(0,r.jsxs)(n.h3,{id:"53-software-package-compilation",children:["5.3. ",(0,r.jsx)(n.strong,{children:"Software Package Compilation"})]}),"\n",(0,r.jsx)(n.p,{children:"When building specific versions of programs or testing, you can create a clean environment to avoid the influence of existing packages in the system."}),"\n",(0,r.jsxs)(n.h3,{id:"54-running-specific-versions-of-applications",children:["5.4. ",(0,r.jsx)(n.strong,{children:"Running Specific Versions of Applications"})]}),"\n",(0,r.jsxs)(n.p,{children:["If you need to run a specific version of a program, you can use ",(0,r.jsx)(n.code,{children:"chroot"})," to isolate old versions of libraries and binaries."]}),"\n",(0,r.jsxs)(n.h2,{id:"6-precautions",children:["6. ",(0,r.jsx)(n.strong,{children:"Precautions"})]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Permission Issues"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"chroot"})," requires sufficient permissions, and usually only root users can perform this operation."]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Security"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"chroot"})," only provides a simple isolation method and cannot completely prevent process escape or access to sensitive information. Stronger security measures (such as using ",(0,r.jsx)(n.code,{children:"namespaces"})," or ",(0,r.jsx)(n.code,{children:"containers"}),") should be used for high-security requirement environments."]}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"File System Dependencies"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Some processes require specific system files (such as ",(0,r.jsx)(n.code,{children:"/dev"}),", ",(0,r.jsx)(n.code,{children:"/proc"}),", ",(0,r.jsx)(n.code,{children:"/sys"}),", etc.). If these virtual file systems are not mounted, programs may crash or not work properly."]}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Cannot Escape"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"chroot"})," itself cannot prevent processes from escaping from the chroot environment, so it is not recommended to rely solely on ",(0,r.jsx)(n.code,{children:"chroot"})," for high-security requirement scenarios (such as sandboxes, containers)."]}),"\n",(0,r.jsxs)(n.h2,{id:"7-summary",children:["7. ",(0,r.jsx)(n.strong,{children:"Summary"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"chroot"})," is a powerful tool for isolating processes in a specific directory tree. It is very useful in system recovery, isolated testing, build environments, and other aspects. However, it is not a perfect security isolation tool, and modern containerization technologies provide stronger isolation and security."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"You can expand the content of the document according to your needs, such as adding more detailed security discussions, usage examples, etc."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var o=s(96540);const r={},t=o.createContext(r);function i(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);