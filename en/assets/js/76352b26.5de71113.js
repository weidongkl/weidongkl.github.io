"use strict";(self.webpackChunkweidongkl_github_io=self.webpackChunkweidongkl_github_io||[]).push([[6832],{4674:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>r,toc:()=>s});const r=JSON.parse('{"id":"note/golang/cmd","title":"Golang os/exec \u7528\u6cd5","description":"1. os/exec \u5305\u7b80\u4ecb","source":"@site/docs/note/golang/cmd.md","sourceDirName":"note/golang","slug":"/note/golang/cmd","permalink":"/en/docs/note/golang/cmd","draft":false,"unlisted":false,"editUrl":"https://github.com/weidongkl/weidongkl.github.io/tree/master/docs/note/golang/cmd.md","tags":[],"version":"current","lastUpdatedBy":"weidongkl","lastUpdatedAt":1746436336000,"frontMatter":{},"sidebar":"note","previous":{"title":"Golang bcrypt","permalink":"/en/docs/note/golang/bcrypt"},"next":{"title":"Golang \u5e76\u53d1\u7f16\u7a0b","permalink":"/en/docs/note/golang/concurrency"}}');var d=e(4848),c=e(8453);const i={},o="Golang os/exec \u7528\u6cd5",l={},s=[{value:"1. <code>os/exec</code> \u5305\u7b80\u4ecb",id:"1-osexec-\u5305\u7b80\u4ecb",level:2},{value:"2. <code>exec.Command</code> \u57fa\u672c\u7528\u6cd5",id:"2-execcommand-\u57fa\u672c\u7528\u6cd5",level:2},{value:"2.1 \u83b7\u53d6stdout\u548cstderr",id:"21-\u83b7\u53d6stdout\u548cstderr",level:3},{value:"2.2 \u53ea\u83b7\u53d6stdout",id:"22-\u53ea\u83b7\u53d6stdout",level:3},{value:"3. \u9ad8\u7ea7\u7528\u6cd5",id:"3-\u9ad8\u7ea7\u7528\u6cd5",level:2},{value:"3.1 \u4f7f\u7528cmd.Stdout",id:"31-\u4f7f\u7528cmdstdout",level:3},{value:"3.2 \u4f7f\u7528 <code>StdoutPipe</code>",id:"32-\u4f7f\u7528-stdoutpipe",level:3},{value:"3.3 \u4f20\u9012\u8f93\u5165 (<code>stdin</code>)",id:"33-\u4f20\u9012\u8f93\u5165-stdin",level:3},{value:"3.4 \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf",id:"34-\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf",level:3},{value:"3.5 \u8fd0\u884c\u5e26\u8d85\u65f6\u7684\u547d\u4ee4",id:"35-\u8fd0\u884c\u5e26\u8d85\u65f6\u7684\u547d\u4ee4",level:3},{value:"3.6 \u589e\u52a0\u9519\u8bef\u5224\u65ad",id:"36-\u589e\u52a0\u9519\u8bef\u5224\u65ad",level:3},{value:"3.7 \u4f7f\u7528\u7ba1\u9053\u8fde\u63a5\u591a\u4e2a\u547d\u4ee4",id:"37-\u4f7f\u7528\u7ba1\u9053\u8fde\u63a5\u591a\u4e2a\u547d\u4ee4",level:3},{value:"4. \u7ed3\u8bba",id:"4-\u7ed3\u8bba",level:2}];function a(n){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...n.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(t.header,{children:(0,d.jsxs)(t.h1,{id:"golang-osexec-\u7528\u6cd5",children:["Golang ",(0,d.jsx)(t.code,{children:"os/exec"})," \u7528\u6cd5"]})}),"\n",(0,d.jsxs)(t.h2,{id:"1-osexec-\u5305\u7b80\u4ecb",children:["1. ",(0,d.jsx)(t.code,{children:"os/exec"})," \u5305\u7b80\u4ecb"]}),"\n",(0,d.jsxs)(t.p,{children:[(0,d.jsx)(t.code,{children:"os/exec"})," \u5305\u63d0\u4f9b\u4e86\u8fd0\u884c\u5916\u90e8\u547d\u4ee4\u7684\u65b9\u6cd5\uff0c\u5141\u8bb8 Go \u7a0b\u5e8f\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u5e76\u4e0e\u4e4b\u4ea4\u4e92\u3002"]}),"\n",(0,d.jsxs)(t.h2,{id:"2-execcommand-\u57fa\u672c\u7528\u6cd5",children:["2. ",(0,d.jsx)(t.code,{children:"exec.Command"})," \u57fa\u672c\u7528\u6cd5"]}),"\n",(0,d.jsxs)(t.p,{children:[(0,d.jsx)(t.code,{children:"exec.Command"})," \u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u4ee3\u8868\u5916\u90e8\u547d\u4ee4\u7684 ",(0,d.jsx)(t.code,{children:"Cmd"})," \u7ed3\u6784\u3002"]}),"\n",(0,d.jsx)(t.h3,{id:"21-\u83b7\u53d6stdout\u548cstderr",children:"2.1 \u83b7\u53d6stdout\u548cstderr"}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"os/exec"\n)\n\nfunc main() {\n\tcmd := exec.Command("ls", "-l") // \u5728 Linux/macOS \u4e0a\u5217\u51fa\u5f53\u524d\u76ee\u5f55\u5185\u5bb9\n    // \u83b7\u53d6\u6b63\u786e\u548c\u9519\u8bef\u8f93\u51fa\n\toutput, err := cmd.CombinedOutput()\n\tif err != nil {\n\t\tfmt.Println("Error:", err)\n\t\treturn\n\t}\n\tfmt.Println(string(output))\n}\n'})}),"\n",(0,d.jsx)(t.h3,{id:"22-\u53ea\u83b7\u53d6stdout",children:"2.2 \u53ea\u83b7\u53d6stdout"}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"os/exec"\n)\n\nfunc main() {\n\tcmd := exec.Command("ls", "-l")\n\toutput, err := cmd.Output()\n\tif err != nil {\n\t\tfmt.Println("Error:", err)\n\t\treturn\n\t}\n\tfmt.Println("Output:", string(output))\n}\n'})}),"\n",(0,d.jsx)(t.h2,{id:"3-\u9ad8\u7ea7\u7528\u6cd5",children:"3. \u9ad8\u7ea7\u7528\u6cd5"}),"\n",(0,d.jsx)(t.h3,{id:"31-\u4f7f\u7528cmdstdout",children:"3.1 \u4f7f\u7528cmd.Stdout"}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n\t"bytes"\n\t"fmt"\n\t"os/exec"\n)\n\nfunc main() {\n\tcmd := exec.Command("echo", "Hello, World!")\n\n\tvar out bytes.Buffer\n\tcmd.Stdout = &out\n\n\tif err := cmd.Run(); err != nil {\n\t\tfmt.Println("Error:", err)\n\t}\n\tfmt.Println("Output:", out.String())\n}\n'})}),"\n",(0,d.jsxs)(t.h3,{id:"32-\u4f7f\u7528-stdoutpipe",children:["3.2 \u4f7f\u7528 ",(0,d.jsx)(t.code,{children:"StdoutPipe"})]}),"\n",(0,d.jsxs)(t.p,{children:[(0,d.jsx)(t.code,{children:"StdoutPipe"})," \u5141\u8bb8\u6211\u4eec\u4ee5\u6d41\u5f0f\u65b9\u5f0f\u8bfb\u53d6\u547d\u4ee4\u7684\u6807\u51c6\u8f93\u51fa\u3002"]}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n\t"bufio"\n\t"fmt"\n\t"os/exec"\n)\n\nfunc main() {\n\tcmd := exec.Command("ping", "baidu.com", "-c", "30")\n\tstdout, err := cmd.StdoutPipe()\n\tif err != nil {\n\t\tfmt.Println("Error creating StdoutPipe:", err)\n\t\treturn\n\t}\n\n\tif err := cmd.Start(); err != nil {\n\t\tfmt.Println("Error starting command:", err)\n\t\treturn\n\t}\n\n\tscanner := bufio.NewScanner(stdout)\n\tfor scanner.Scan() {\n\t\tfmt.Println("Output line:", scanner.Text())\n\t}\n\n\tif err := cmd.Wait(); err != nil {\n\t\tfmt.Println("Error waiting for command:", err)\n\t}\n}\n'})}),"\n",(0,d.jsxs)(t.h3,{id:"33-\u4f20\u9012\u8f93\u5165-stdin",children:["3.3 \u4f20\u9012\u8f93\u5165 (",(0,d.jsx)(t.code,{children:"stdin"}),")"]}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n\t"bytes"\n\t"fmt"\n\t"os/exec"\n)\n\nfunc main() {\n\tcmd := exec.Command("cat")\n\n\tvar out bytes.Buffer\n\tcmd.Stdout = &out\n\tcmd.Stdin = bytes.NewBufferString("Hello from stdin!")\n\n\tif err := cmd.Run(); err != nil {\n\t\tfmt.Println("Error:", err)\n\t}\n\tfmt.Println("Output:", out.String())\n}\n'})}),"\n",(0,d.jsx)(t.h3,{id:"34-\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf",children:"3.4 \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf"}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-go",children:'cmd := exec.Command("printenv")\ncmd.Env = append(cmd.Env, "MY_VAR=HelloWorld")\n'})}),"\n",(0,d.jsx)(t.h3,{id:"35-\u8fd0\u884c\u5e26\u8d85\u65f6\u7684\u547d\u4ee4",children:"3.5 \u8fd0\u884c\u5e26\u8d85\u65f6\u7684\u547d\u4ee4"}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n\t"context"\n\t"fmt"\n\t"os/exec"\n\t"time"\n)\n\nfunc main() {\n\tctx, cancel := context.WithTimeout(context.Background(), 2*time.Second)\n\tdefer cancel()\n\n\tcmd := exec.CommandContext(ctx, "sleep", "5")\n\tif err := cmd.Run(); err != nil {\n\t\tfmt.Println("Command timed out or failed:", err)\n\t}\n}\n'})}),"\n",(0,d.jsx)(t.h3,{id:"36-\u589e\u52a0\u9519\u8bef\u5224\u65ad",children:"3.6 \u589e\u52a0\u9519\u8bef\u5224\u65ad"}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-go",children:'package utils\n\nimport (\n\t"os"\n\t"os/exec"\n\t"strings"\n)\n\n// Run executes a shell command without capturing its output.\nfunc Run(command string) error {\n\tcmd := prepareCommand(command)\n\treturn cmd.Run()\n}\n\n// RunWithOutput executes a shell command and returns its combined stdout and stderr output.\nfunc RunWithOutput(command string) ([]byte, error) {\n\tcmd := prepareCommand(command)\n\treturn cmd.CombinedOutput()\n}\n\n// RunWithExitCode executes a shell command and returns its output along with the exit code.\nfunc RunWithExitCode(command string) ([]byte, int, error) {\n\tcmd := prepareCommand(command)\n\toutput, err := cmd.CombinedOutput()\n\tif err != nil {\n\t\tif exitErr, ok := err.(*exec.ExitError); ok {\n\t\t\treturn output, exitErr.ExitCode(), err\n\t\t}\n\t\treturn output, -1, err\n\t}\n\treturn output, 0, nil\n}\n\n// prepareCommand initializes an *exec.Cmd with environment variables.\nfunc prepareCommand(command string) *exec.Cmd {\n\targs := strings.Fields(command)\n\tif len(args) == 0 {\n\t\treturn exec.Command("") // \u5904\u7406\u7a7a\u5b57\u7b26\u4e32\u60c5\u51b5\uff0c\u907f\u514d panic\n\t}\n\tcmd := exec.Command(args[0], args[1:]...)\n\tcmd.Env = append(os.Environ(), "LC_ALL=C", "LANG=C")\n\treturn cmd\n}\n'})}),"\n",(0,d.jsx)(t.h3,{id:"37-\u4f7f\u7528\u7ba1\u9053\u8fde\u63a5\u591a\u4e2a\u547d\u4ee4",children:"3.7 \u4f7f\u7528\u7ba1\u9053\u8fde\u63a5\u591a\u4e2a\u547d\u4ee4"}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-go",children:'package main\n// echo "hello world!" | grep World\nimport (\n\t"bytes"\n\t"fmt"\n\t"os/exec"\n)\n\nfunc main() {\n\tcmd1 := exec.Command("echo", "Hello, World!")\n\tcmd2 := exec.Command("grep", "World")\n\n\t// \u521b\u5efa\u7ba1\u9053\n\tpipe, err := cmd1.StdoutPipe()\n\tif err != nil {\n\t\tfmt.Println("Error creating pipe:", err)\n\t\treturn\n\t}\n\tcmd2.Stdin = pipe\n\n\tvar out bytes.Buffer\n\tcmd2.Stdout = &out\n\n\t// \u542f\u52a8\u7b2c\u4e00\u4e2a\u547d\u4ee4\n\tif err := cmd1.Start(); err != nil {\n\t\tfmt.Println("Error starting cmd1:", err)\n\t\treturn\n\t}\n\n\t// \u542f\u52a8\u7b2c\u4e8c\u4e2a\u547d\u4ee4\n\tif err := cmd2.Start(); err != nil {\n\t\tfmt.Println("Error starting cmd2:", err)\n\t\treturn\n\t}\n\n\t// \u7b49\u5f85\u6240\u6709\u547d\u4ee4\u5b8c\u6210\n\tif err := cmd1.Wait(); err != nil {\n\t\tfmt.Println("Error waiting for cmd1:", err)\n\t\treturn\n\t}\n\tif err := cmd2.Wait(); err != nil {\n\t\tfmt.Println("Error waiting for cmd2:", err)\n\t\treturn\n\t}\n\n\tfmt.Println("Filtered Output:", out.String())\n}\n'})}),"\n",(0,d.jsx)(t.h2,{id:"4-\u7ed3\u8bba",children:"4. \u7ed3\u8bba"}),"\n",(0,d.jsxs)(t.ul,{children:["\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.code,{children:"exec.Command"})," \u7528\u4e8e\u521b\u5efa\u5e76\u8fd0\u884c\u5916\u90e8\u547d\u4ee4\u3002"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.code,{children:"Stdout"})," \u548c ",(0,d.jsx)(t.code,{children:"Stderr"})," \u53ef\u4ee5\u7528\u4e8e\u6355\u83b7\u547d\u4ee4\u8f93\u51fa\u3002"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.code,{children:"StdoutPipe"})," \u9002\u7528\u4e8e\u6d41\u5f0f\u8bfb\u53d6\u547d\u4ee4\u8f93\u51fa\u3002"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.code,{children:"Output()"})," \u4ec5\u83b7\u53d6\u6807\u51c6\u8f93\u51fa\uff0c\u800c ",(0,d.jsx)(t.code,{children:"CombinedOutput()"})," \u540c\u65f6\u83b7\u53d6\u6807\u51c6\u8f93\u51fa\u548c\u6807\u51c6\u9519\u8bef\u3002"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.code,{children:"Stdin"})," \u53ef\u4ee5\u7528\u4e8e\u4f20\u9012\u8f93\u5165\u6570\u636e\u3002"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.code,{children:"exec.CommandContext"})," \u53ef\u7528\u4e8e\u8d85\u65f6\u63a7\u5236\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(t.p,{children:[(0,d.jsx)(t.code,{children:"os/exec"})," \u5305\u9002\u7528\u4e8e\u9700\u8981\u5728 Go \u4ee3\u7801\u4e2d\u6267\u884c\u5916\u90e8\u547d\u4ee4\u7684\u573a\u666f\uff0c\u4f8b\u5982\u81ea\u52a8\u5316\u4efb\u52a1\u3001\u7cfb\u7edf\u7ba1\u7406\u548c\u6570\u636e\u5904\u7406\u3002"]})]})}function m(n={}){const{wrapper:t}={...(0,c.R)(),...n.components};return t?(0,d.jsx)(t,{...n,children:(0,d.jsx)(a,{...n})}):a(n)}},8453:(n,t,e)=>{e.d(t,{R:()=>i,x:()=>o});var r=e(6540);const d={},c=r.createContext(d);function i(n){const t=r.useContext(c);return r.useMemo((function(){return"function"==typeof n?n(t):{...t,...n}}),[t,n])}function o(n){let t;return t=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:i(n.components),r.createElement(c.Provider,{value:t},n.children)}}}]);