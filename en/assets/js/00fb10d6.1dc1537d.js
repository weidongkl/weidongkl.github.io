"use strict";(self.webpackChunkweidongkl_github_io=self.webpackChunkweidongkl_github_io||[]).push([[4114],{1967:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>h,default:()=>a,frontMatter:()=>l,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"note/os/network/bridge_networking","title":"Linux Bridge Networking","description":"1. What Is Linux Bridge?","source":"@site/docs/note/os/network/bridge_networking.md","sourceDirName":"note/os/network","slug":"/note/os/network/bridge_networking","permalink":"/en/docs/note/os/network/bridge_networking","draft":false,"unlisted":false,"editUrl":"https://github.com/weidongkl/weidongkl.github.io/tree/master/docs/note/os/network/bridge_networking.md","tags":[],"version":"current","lastUpdatedBy":"wei dong","lastUpdatedAt":1769438874000,"frontMatter":{},"sidebar":"note","previous":{"title":"\u7f51\u8def","permalink":"/en/docs/category/\u7f51\u8def"},"next":{"title":"\u4f7f\u7528SSH \u96a7\u9053\u8fde\u63a5\u7f51\u7edc","permalink":"/en/docs/note/os/network/ssh_tunnel"}}');var d=i(74848),s=i(28453);const l={},h="Linux Bridge Networking",c={},t=[{value:"1. What Is Linux Bridge?",id:"1-what-is-linux-bridge",level:2},{value:"2. Why Linux Bridge?",id:"2-why-linux-bridge",level:2},{value:"3. Core Components",id:"3-core-components",level:2},{value:"4. Basic Usage",id:"4-basic-usage",level:2},{value:"1\ufe0f\u20e3 \u521b\u5efa bridge",id:"1\ufe0f\u20e3-\u521b\u5efa-bridge",level:3},{value:"2\ufe0f\u20e3 \u521b\u5efa veth pair",id:"2\ufe0f\u20e3-\u521b\u5efa-veth-pair",level:3},{value:"3\ufe0f\u20e3 \u63a5\u5165 bridge",id:"3\ufe0f\u20e3-\u63a5\u5165-bridge",level:3},{value:"5. Frame Forwarding Mechanics",id:"5-frame-forwarding-mechanics",level:2},{value:"1\ufe0f\u20e3 FDB\uff08Forwarding Database\uff09",id:"1\ufe0f\u20e3-fdbforwarding-database",level:3},{value:"2\ufe0f\u20e3 \u5e7f\u64ad / \u672a\u77e5\u5355\u64ad",id:"2\ufe0f\u20e3-\u5e7f\u64ad--\u672a\u77e5\u5355\u64ad",level:3},{value:"6. End-to-End Frame Path",id:"6-end-to-end-frame-path",level:2},{value:"7. Relationship with Layer 3 (IP)",id:"7-relationship-with-layer-3-ip",level:2},{value:"8. Spanning Tree Protocol (STP)",id:"8-spanning-tree-protocol-stp",level:2},{value:"\u4e3a\u4ec0\u4e48\u9700\u8981 STP\uff1f",id:"\u4e3a\u4ec0\u4e48\u9700\u8981-stp",level:3},{value:"\u542f\u7528 STP",id:"\u542f\u7528-stp",level:3},{value:"9. Linux Bridge vs Open vSwitch",id:"9-linux-bridge-vs-open-vswitch",level:2},{value:"10. Containers: Docker / Podman",id:"10-containers-docker--podman",level:2},{value:"Docker bridge \u7f51\u7edc",id:"docker-bridge-\u7f51\u7edc",level:3},{value:"\u7aef\u53e3\u662f\u5426\u51b2\u7a81\uff1f",id:"\u7aef\u53e3\u662f\u5426\u51b2\u7a81",level:3},{value:"11. Bridge and Netfilter",id:"11-bridge-and-netfilter",level:2},{value:"12. Common Questions",id:"12-common-questions",level:2},{value:"Q1\uff1aBridge \u662f\u7528\u6237\u6001\u8fd8\u662f\u5185\u6838\u6001\uff1f",id:"q1bridge-\u662f\u7528\u6237\u6001\u8fd8\u662f\u5185\u6838\u6001",level:3},{value:"Q2\uff1a\u6027\u80fd\u74f6\u9888\uff1f",id:"q2\u6027\u80fd\u74f6\u9888",level:3},{value:"Q3\uff1a\u4e00\u4e2a bridge \u591a\u5927\u89c4\u6a21\uff1f",id:"q3\u4e00\u4e2a-bridge-\u591a\u5927\u89c4\u6a21",level:3},{value:"13. Debugging Cheat Sheet",id:"13-debugging-cheat-sheet",level:2},{value:"14. One-Sentence Summary",id:"14-one-sentence-summary",level:2},{value:"15. Teaching Diagrams",id:"15-teaching-diagrams",level:2},{value:"\u56fe 1\uff1aBridge + veth + namespace \u62d3\u6251\u56fe",id:"\u56fe-1bridge--veth--namespace-\u62d3\u6251\u56fe",level:3},{value:"\u56fe 2\uff1a\u5355\u4e2a\u6570\u636e\u5e27\u7684\u5185\u6838\u8f6c\u53d1\u8def\u5f84",id:"\u56fe-2\u5355\u4e2a\u6570\u636e\u5e27\u7684\u5185\u6838\u8f6c\u53d1\u8def\u5f84",level:3},{value:"16. Teaching Demo: Mini Docker Bridge",id:"16-teaching-demo-mini-docker-bridge",level:2},{value:"Step 1\uff1a\u521b\u5efa bridge",id:"step-1\u521b\u5efa-bridge",level:3},{value:"Step 2\uff1a\u521b\u5efa\u4e24\u4e2a namespace",id:"step-2\u521b\u5efa\u4e24\u4e2a-namespace",level:3},{value:"Step 3\uff1a\u521b\u5efa veth \u5e76\u63a5\u5165 bridge",id:"step-3\u521b\u5efa-veth-\u5e76\u63a5\u5165-bridge",level:3},{value:"Step 4\uff1a\u914d\u7f6e IP",id:"step-4\u914d\u7f6e-ip",level:3},{value:"Step 5\uff1a\u9a8c\u8bc1",id:"step-5\u9a8c\u8bc1",level:3},{value:"17. Bridge / OVS / macvlan / ipvlan Comparison",id:"17-bridge--ovs--macvlan--ipvlan-comparison",level:2},{value:"1\ufe0f\u20e3 \u603b\u89c8\u5bf9\u6bd4\u8868",id:"1\ufe0f\u20e3-\u603b\u89c8\u5bf9\u6bd4\u8868",level:3},{value:"2\ufe0f\u20e3 Linux Bridge",id:"2\ufe0f\u20e3-linux-bridge",level:3},{value:"3\ufe0f\u20e3 Open vSwitch\uff08OVS\uff09",id:"3\ufe0f\u20e3-open-vswitchovs",level:3},{value:"4\ufe0f\u20e3 macvlan",id:"4\ufe0f\u20e3-macvlan",level:3},{value:"5\ufe0f\u20e3 ipvlan",id:"5\ufe0f\u20e3-ipvlan",level:3},{value:"18. Selection Summary",id:"18-selection-summary",level:2}];function x(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"linux-bridge-networking",children:"Linux Bridge Networking"})}),"\n",(0,d.jsx)(n.h2,{id:"1-what-is-linux-bridge",children:"1. What Is Linux Bridge?"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Linux Bridge\uff08\u7f51\u6865\uff09"})," \u662f Linux \u5185\u6838\u4e2d\u5b9e\u73b0\u7684 ",(0,d.jsx)(n.strong,{children:"\u4e8c\u5c42\uff08Layer 2\uff09\u865a\u62df\u4ea4\u6362\u673a"}),"\u3002"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u5de5\u4f5c\u5728 ",(0,d.jsx)(n.strong,{children:"\u6570\u636e\u94fe\u8def\u5c42\uff08Ethernet\uff09"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u4f9d\u636e ",(0,d.jsx)(n.strong,{children:"MAC \u5730\u5740"})," \u8f6c\u53d1\u6570\u636e\u5e27"]}),"\n",(0,d.jsx)(n.li,{children:"\u884c\u4e3a\u7c7b\u4f3c\u4e8e\u7269\u7406\u4ea4\u6362\u673a\uff08Switch\uff09"}),"\n"]}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:"Linux Bridge = \u5185\u6838\u91cc\u7684\u4e8c\u5c42\u4ea4\u6362\u673a"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"2-why-linux-bridge",children:"2. Why Linux Bridge?"}),"\n",(0,d.jsx)(n.p,{children:"\u5178\u578b\u9700\u6c42\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u591a\u4e2a ",(0,d.jsx)(n.strong,{children:"\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\uff08Namespace\uff09/ \u5bb9\u5668 / \u865a\u62df\u673a"})," \u4e92\u901a"]}),"\n",(0,d.jsx)(n.li,{children:"\u5c06\u865a\u62df\u7f51\u7edc\u63a5\u5165\u5bbf\u4e3b\u673a\u7269\u7406\u7f51\u7edc"}),"\n",(0,d.jsx)(n.li,{children:"\u6a21\u62df\u5c40\u57df\u7f51\uff08\u4e8c\u5c42\u5e7f\u64ad\u57df\uff09"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u5bf9\u6bd4\uff1a"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u65b9\u6848"}),(0,d.jsx)(n.th,{children:"\u5c42\u7ea7"}),(0,d.jsx)(n.th,{children:"\u7279\u70b9"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Linux Bridge"}),(0,d.jsx)(n.td,{children:"L2"}),(0,d.jsx)(n.td,{children:"\u7b80\u5355\u3001\u7a33\u5b9a\u3001\u652f\u6301\u5e7f\u64ad"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"veth pair"}),(0,d.jsx)(n.td,{children:"L2"}),(0,d.jsx)(n.td,{children:"\u70b9\u5bf9\u70b9\uff0c\u4e0d\u662f\u4ea4\u6362"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Router / ip route"}),(0,d.jsx)(n.td,{children:"L3"}),(0,d.jsx)(n.td,{children:"\u9700\u8981 IP \u8def\u7531"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"OVS"}),(0,d.jsx)(n.td,{children:"L2/L3"}),(0,d.jsx)(n.td,{children:"\u66f4\u590d\u6742\uff0c\u652f\u6301 SDN"})]})]})]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"3-core-components",children:"3. Core Components"}),"\n",(0,d.jsx)(n.p,{children:"\u4e00\u4e2a Linux Bridge \u7f51\u7edc\uff0c\u81f3\u5c11\u5305\u542b\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"[ veth / eth ] \u2500\u2510\n[ veth / tap ] \u2500\u253c\u2500\u2500 br0 (bridge)\n[ veth / eth ] \u2500\u2518\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u6838\u5fc3\u5bf9\u8c61\uff1a"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u7ec4\u4ef6"}),(0,d.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"bridge\uff08br0\uff09"}),(0,d.jsx)(n.td,{children:"\u865a\u62df\u4ea4\u6362\u673a"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"port"}),(0,d.jsx)(n.td,{children:"\u63a5\u5165 bridge \u7684\u7f51\u5361"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"FDB"}),(0,d.jsx)(n.td,{children:"MAC \u2192 port \u8f6c\u53d1\u8868"})]})]})]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"4-basic-usage",children:"4. Basic Usage"}),"\n",(0,d.jsx)(n.h3,{id:"1\ufe0f\u20e3-\u521b\u5efa-bridge",children:"1\ufe0f\u20e3 \u521b\u5efa bridge"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"ip link add br0 type bridge\nip link set br0 up\n"})}),"\n",(0,d.jsx)(n.h3,{id:"2\ufe0f\u20e3-\u521b\u5efa-veth-pair",children:"2\ufe0f\u20e3 \u521b\u5efa veth pair"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"ip link add veth-a type veth peer name veth-b\n"})}),"\n",(0,d.jsx)(n.h3,{id:"3\ufe0f\u20e3-\u63a5\u5165-bridge",children:"3\ufe0f\u20e3 \u63a5\u5165 bridge"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"ip link set veth-a master br0\nip link set veth-a up\nip link set veth-b up\n"})}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:"veth-b \u901a\u5e38\u4f1a\u88ab\u653e\u5165 namespace / \u5bb9\u5668\u4e2d"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"5-frame-forwarding-mechanics",children:"5. Frame Forwarding Mechanics"}),"\n",(0,d.jsx)(n.h3,{id:"1\ufe0f\u20e3-fdbforwarding-database",children:"1\ufe0f\u20e3 FDB\uff08Forwarding Database\uff09"}),"\n",(0,d.jsx)(n.p,{children:"Bridge \u5185\u6838\u7ef4\u62a4\u4e00\u5f20\u8868\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"MAC Address  \u2192  Port\n"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u5b66\u4e60\uff08Learning\uff09"}),"\uff1a","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u6536\u5230\u5e27\uff0c\u8bb0\u5f55 ",(0,d.jsx)(n.code,{children:"src MAC \u2192 ingress port"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u8f6c\u53d1\uff08Forwarding\uff09"}),"\uff1a","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u67e5 ",(0,d.jsx)(n.code,{children:"dst MAC"})]}),"\n",(0,d.jsx)(n.li,{children:"\u547d\u4e2d \u2192 \u5355\u64ad"}),"\n",(0,d.jsx)(n.li,{children:"\u672a\u547d\u4e2d \u2192 \u6cdb\u6d2a\uff08flood\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"2\ufe0f\u20e3-\u5e7f\u64ad--\u672a\u77e5\u5355\u64ad",children:"2\ufe0f\u20e3 \u5e7f\u64ad / \u672a\u77e5\u5355\u64ad"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"ARP"}),"\n",(0,d.jsx)(n.li,{children:"DHCP"}),"\n",(0,d.jsx)(n.li,{children:"\u672a\u5b66\u4e60\u5230 MAC"}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\ud83d\udc49 \u4f1a ",(0,d.jsx)(n.strong,{children:"\u5411\u9664\u5165\u7aef\u53e3\u5916\u7684\u6240\u6709 port \u8f6c\u53d1"})]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"6-end-to-end-frame-path",children:"6. End-to-End Frame Path"}),"\n",(0,d.jsx)(n.p,{children:"\u4ee5\u5bb9\u5668 A ping \u5bb9\u5668 B \u4e3a\u4f8b\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"container A\n  \u2193 veth\nhost namespace\n  \u2193 bridge br0\n  \u2193 \u67e5 FDB\n  \u2193 veth\ncontainer B\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u5185\u6838\u8def\u5f84\uff08\u7b80\u5316\uff09\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"br_handle_frame()\n  \u251c\u2500 br_fdb_update()\n  \u251c\u2500 br_fdb_find()\n  \u251c\u2500 br_forward()\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"7-relationship-with-layer-3-ip",children:"7. Relationship with Layer 3 (IP)"}),"\n",(0,d.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,d.jsx)(n.strong,{children:"Bridge \u672c\u8eab\u4e0d\u5173\u5fc3 IP"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u53ea\u5904\u7406 Ethernet frame"}),"\n",(0,d.jsx)(n.li,{children:"IP / TCP / UDP \u662f payload"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u4f46\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u53ef\u4ee5\u7ed9 bridge \u914d IP\uff08\u4e09\u5c42\u7f51\u5173\uff09"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"ip addr add 192.168.1.1/24 dev br0\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u7528\u9014\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u5bbf\u4e3b\u673a \u2194 \u5bb9\u5668\u901a\u4fe1"}),"\n",(0,d.jsx)(n.li,{children:"bridge \u4f5c\u4e3a\u9ed8\u8ba4\u7f51\u5173"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"8-spanning-tree-protocol-stp",children:"8. Spanning Tree Protocol (STP)"}),"\n",(0,d.jsx)(n.h3,{id:"\u4e3a\u4ec0\u4e48\u9700\u8981-stp",children:"\u4e3a\u4ec0\u4e48\u9700\u8981 STP\uff1f"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u591a bridge / \u591a\u94fe\u8def"}),"\n",(0,d.jsx)(n.li,{children:"\u9632\u6b62\u4e8c\u5c42\u73af\u8def"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u542f\u7528-stp",children:"\u542f\u7528 STP"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"ip link set br0 type bridge stp_state 1\n"})}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:"Docker \u9ed8\u8ba4\u5173\u95ed STP\uff08\u62d3\u6251\u7b80\u5355\uff09"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"9-linux-bridge-vs-open-vswitch",children:"9. Linux Bridge vs Open vSwitch"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u5bf9\u6bd4\u9879"}),(0,d.jsx)(n.th,{children:"Linux Bridge"}),(0,d.jsx)(n.th,{children:"Open vSwitch"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u590d\u6742\u5ea6"}),(0,d.jsx)(n.td,{children:"\u4f4e"}),(0,d.jsx)(n.td,{children:"\u9ad8"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u6027\u80fd"}),(0,d.jsx)(n.td,{children:"\u597d"}),(0,d.jsx)(n.td,{children:"\u66f4\u597d\uff08DPDK\uff09"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u53ef\u7f16\u7a0b"}),(0,d.jsx)(n.td,{children:"\u5c11"}),(0,d.jsx)(n.td,{children:"\u5f3a\uff08OpenFlow\uff09"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u4e91\u539f\u751f"}),(0,d.jsx)(n.td,{children:"\u57fa\u7840"}),(0,d.jsx)(n.td,{children:"\u4e3b\u6d41\uff08K8s/SDN\uff09"})]})]})]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"10-containers-docker--podman",children:"10. Containers: Docker / Podman"}),"\n",(0,d.jsx)(n.h3,{id:"docker-bridge-\u7f51\u7edc",children:"Docker bridge \u7f51\u7edc"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"docker network create mynet\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u672c\u8d28\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u521b\u5efa\u4e00\u4e2a ",(0,d.jsx)(n.code,{children:"br-xxxx"})]}),"\n",(0,d.jsx)(n.li,{children:"\u5bb9\u5668\u901a\u8fc7 veth \u63a5\u5165"}),"\n",(0,d.jsx)(n.li,{children:"Docker \u7ba1\u7406 IPAM + iptables"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u7aef\u53e3\u662f\u5426\u51b2\u7a81",children:"\u7aef\u53e3\u662f\u5426\u51b2\u7a81\uff1f"}),"\n",(0,d.jsxs)(n.p,{children:["\u274c ",(0,d.jsx)(n.strong,{children:"\u4e0d\u4f1a"}),"\uff08\u5bb9\u5668\u5185\u90e8\u7aef\u53e3\u9694\u79bb\uff09"]}),"\n",(0,d.jsx)(n.p,{children:"\u51b2\u7a81\u53ea\u53d1\u751f\u5728\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"-p 8080:80"})}),"\n",(0,d.jsx)(n.li,{children:"\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7aef\u53e3"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"11-bridge-and-netfilter",children:"11. Bridge and Netfilter"}),"\n",(0,d.jsx)(n.p,{children:"\u9ed8\u8ba4\u60c5\u51b5\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["L2 \u6d41\u91cf ",(0,d.jsx)(n.strong,{children:"\u4e0d\u8d70 iptables"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u5f00\u542f bridge-nf\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"sysctl net.bridge.bridge-nf-call-iptables=1\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u7528\u9014\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Kubernetes"}),"\n",(0,d.jsx)(n.li,{children:"CNI \u7f51\u7edc\u7b56\u7565"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"12-common-questions",children:"12. Common Questions"}),"\n",(0,d.jsx)(n.h3,{id:"q1bridge-\u662f\u7528\u6237\u6001\u8fd8\u662f\u5185\u6838\u6001",children:"Q1\uff1aBridge \u662f\u7528\u6237\u6001\u8fd8\u662f\u5185\u6838\u6001\uff1f"}),"\n",(0,d.jsx)(n.p,{children:"\u2705 \u5185\u6838\u6001\uff08net/bridge\uff09"}),"\n",(0,d.jsx)(n.h3,{id:"q2\u6027\u80fd\u74f6\u9888",children:"Q2\uff1a\u6027\u80fd\u74f6\u9888\uff1f"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"FDB \u67e5\u627e"}),"\n",(0,d.jsx)(n.li,{children:"\u5e7f\u64ad\u6cdb\u6d2a"}),"\n",(0,d.jsx)(n.li,{children:"iptables / conntrack"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"q3\u4e00\u4e2a-bridge-\u591a\u5927\u89c4\u6a21",children:"Q3\uff1a\u4e00\u4e2a bridge \u591a\u5927\u89c4\u6a21\uff1f"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u51e0\u767e\u5230\u4e0a\u5343\u7aef\u53e3\u53ef\u884c"}),"\n",(0,d.jsx)(n.li,{children:"\u8d85\u5927\u89c4\u6a21 \u2192 OVS / SDN"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"13-debugging-cheat-sheet",children:"13. Debugging Cheat Sheet"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"bridge link           # \u67e5\u770b\u7aef\u53e3\nbridge fdb show       # MAC \u8868\nip -d link show br0   # bridge \u8be6\u7ec6\u4fe1\u606f\nbrctl show            # \u4f20\u7edf\u5de5\u5177\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"14-one-sentence-summary",children:"14. One-Sentence Summary"}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Linux Bridge \u662f\u5185\u6838\u91cc\u7684\u4e8c\u5c42\u4ea4\u6362\u673a\uff0c\u901a\u8fc7 veth/tap \u628a namespace\u3001\u5bb9\u5668\u3001\u865a\u62df\u673a\u8fde\u63a5\u6210\u4e00\u4e2a\u865a\u62df\u5c40\u57df\u7f51\u3002"})}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"15-teaching-diagrams",children:"15. Teaching Diagrams"}),"\n",(0,d.jsx)(n.h3,{id:"\u56fe-1bridge--veth--namespace-\u62d3\u6251\u56fe",children:"\u56fe 1\uff1aBridge + veth + namespace \u62d3\u6251\u56fe"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"+-------------------+        +-------------------+\n|   container A    |        |   container B    |\n|  netns A         |        |  netns B         |\n|   eth0           |        |   eth0           |\n+----|--------------+        +-------|-----------+\n     | veth-a                        | veth-b\n     |                               |\n---------------- host namespace -----------------\n     |                               |\n     |        +-----------------+    |\n     +--------|     br0         |----+\n              |  Linux Bridge   |\n              +-----------------+\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u8981\u70b9\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Bridge \u53ea\u770b ",(0,d.jsx)(n.strong,{children:"MAC"})]}),"\n",(0,d.jsx)(n.li,{children:"\u6240\u6709 veth \u7aef\u53e3\u5904\u4e8e\u540c\u4e00\u4e8c\u5c42\u5e7f\u64ad\u57df"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h3,{id:"\u56fe-2\u5355\u4e2a\u6570\u636e\u5e27\u7684\u5185\u6838\u8f6c\u53d1\u8def\u5f84",children:"\u56fe 2\uff1a\u5355\u4e2a\u6570\u636e\u5e27\u7684\u5185\u6838\u8f6c\u53d1\u8def\u5f84"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"NIC / veth RX\n   \u2193\nbr_handle_frame()\n   \u2193 \u5b66\u4e60 src MAC\nbr_fdb_update()\n   \u2193 \u67e5\u627e dst MAC\nbr_fdb_find()\n   \u2193\n\u547d\u4e2d \u2192 br_forward()\n\u672a\u77e5 \u2192 br_flood()\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"16-teaching-demo-mini-docker-bridge",children:"16. Teaching Demo: Mini Docker Bridge"}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:"\u76ee\u6807\uff1a\u4e0d\u7528 Docker / Podman\uff0c\u53ea\u7528 ip \u547d\u4ee4\uff0c\u7406\u89e3 bridge \u7f51\u7edc"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"step-1\u521b\u5efa-bridge",children:"Step 1\uff1a\u521b\u5efa bridge"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"ip link add br-demo type bridge\nip link set br-demo up\n"})}),"\n",(0,d.jsx)(n.h3,{id:"step-2\u521b\u5efa\u4e24\u4e2a-namespace",children:"Step 2\uff1a\u521b\u5efa\u4e24\u4e2a namespace"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"ip netns add ns1\nip netns add ns2\n"})}),"\n",(0,d.jsx)(n.h3,{id:"step-3\u521b\u5efa-veth-\u5e76\u63a5\u5165-bridge",children:"Step 3\uff1a\u521b\u5efa veth \u5e76\u63a5\u5165 bridge"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"ip link add veth1 type veth peer name veth1-br\nip link add veth2 type veth peer name veth2-br\n\nip link set veth1 netns ns1\nip link set veth2 netns ns2\n\nip link set veth1-br master br-demo\nip link set veth2-br master br-demo\n\nip link set veth1-br up\nip link set veth2-br up\n\nip netns exec ns1 ip link set lo up\nip netns exec ns2 ip link set lo up\n"})}),"\n",(0,d.jsx)(n.h3,{id:"step-4\u914d\u7f6e-ip",children:"Step 4\uff1a\u914d\u7f6e IP"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"ip netns exec ns1 ip addr add 10.0.0.2/24 dev veth1\nip netns exec ns2 ip addr add 10.0.0.3/24 dev veth2\n\nip netns exec ns1 ip link set veth1 up\nip netns exec ns2 ip link set veth2 up\n"})}),"\n",(0,d.jsx)(n.h3,{id:"step-5\u9a8c\u8bc1",children:"Step 5\uff1a\u9a8c\u8bc1"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"ip netns exec ns1 ping 10.0.0.3\nbridge fdb show br-demo\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u4f60\u5df2\u7ecf\u590d\u523b\u4e86\uff1a"}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Docker bridge \u7f51\u7edc\u7684 80% \u672c\u8d28"})}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"17-bridge--ovs--macvlan--ipvlan-comparison",children:"17. Bridge / OVS / macvlan / ipvlan Comparison"}),"\n",(0,d.jsx)(n.h3,{id:"1\ufe0f\u20e3-\u603b\u89c8\u5bf9\u6bd4\u8868",children:"1\ufe0f\u20e3 \u603b\u89c8\u5bf9\u6bd4\u8868"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u65b9\u6848"}),(0,d.jsx)(n.th,{children:"\u5de5\u4f5c\u5c42"}),(0,d.jsx)(n.th,{children:"\u662f\u5426\u4e8c\u5c42"}),(0,d.jsx)(n.th,{children:"\u662f\u5426\u5e7f\u64ad"}),(0,d.jsx)(n.th,{children:"\u5178\u578b\u573a\u666f"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Linux Bridge"}),(0,d.jsx)(n.td,{children:"L2"}),(0,d.jsx)(n.td,{children:"\u2705"}),(0,d.jsx)(n.td,{children:"\u2705"}),(0,d.jsx)(n.td,{children:"Docker / VM"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Open vSwitch"}),(0,d.jsx)(n.td,{children:"L2/L3"}),(0,d.jsx)(n.td,{children:"\u2705"}),(0,d.jsx)(n.td,{children:"\u2705"}),(0,d.jsx)(n.td,{children:"K8s / \u4e91\u7f51\u7edc"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"macvlan"}),(0,d.jsx)(n.td,{children:"L2"}),(0,d.jsx)(n.td,{children:"\u2705"}),(0,d.jsx)(n.td,{children:"\u274c"}),(0,d.jsx)(n.td,{children:"\u9ad8\u6027\u80fd\u76f4\u901a"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ipvlan"}),(0,d.jsx)(n.td,{children:"L3"}),(0,d.jsx)(n.td,{children:"\u274c"}),(0,d.jsx)(n.td,{children:"\u274c"}),(0,d.jsx)(n.td,{children:"\u5927\u89c4\u6a21\u5bb9\u5668"})]})]})]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h3,{id:"2\ufe0f\u20e3-linux-bridge",children:"2\ufe0f\u20e3 Linux Bridge"}),"\n",(0,d.jsx)(n.p,{children:"\u4f18\u70b9\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u7b80\u5355\u3001\u7a33\u5b9a\u3001\u5185\u6838\u539f\u751f"}),"\n",(0,d.jsx)(n.li,{children:"\u652f\u6301\u5e7f\u64ad\u3001ARP\u3001DHCP"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u7f3a\u70b9\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u5e7f\u64ad\u98ce\u66b4\u98ce\u9669"}),"\n",(0,d.jsx)(n.li,{children:"\u53ef\u7f16\u7a0b\u6027\u5f31"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u9002\u5408\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u5355\u673a\u5bb9\u5668"}),"\n",(0,d.jsx)(n.li,{children:"\u6559\u5b66 / \u5b66\u4e60\u7f51\u7edc\u539f\u7406"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h3,{id:"3\ufe0f\u20e3-open-vswitchovs",children:"3\ufe0f\u20e3 Open vSwitch\uff08OVS\uff09"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"veth \u2192 ovs datapath \u2192 flow table \u2192 action\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u7279\u70b9\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Flow-based forwarding"}),"\n",(0,d.jsx)(n.li,{children:"OpenFlow / eBPF / DPDK"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u9002\u5408\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Kubernetes CNI"}),"\n",(0,d.jsx)(n.li,{children:"\u4e91\u5382\u5546 VPC"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u4e00\u53e5\u8bdd\uff1a"}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:"Bridge \u7684\u300c\u53ef\u7f16\u7a0b + \u5de5\u4e1a\u7ea7\u7248\u672c\u300d"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h3,{id:"4\ufe0f\u20e3-macvlan",children:"4\ufe0f\u20e3 macvlan"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"eth0\n \u251c\u2500 macvlan A (\u72ec\u7acb MAC)\n \u251c\u2500 macvlan B\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u7279\u70b9\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u6bcf\u4e2a\u5bb9\u5668\u4e00\u4e2a MAC"}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"\u7ed5\u8fc7 bridge"})}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u9650\u5236\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u7236\u63a5\u53e3\u65e0\u6cd5\u548c\u5b50\u63a5\u53e3\u901a\u4fe1\uff08\u9ed8\u8ba4\uff09"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u9002\u5408\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u6781\u81f4\u6027\u80fd"}),"\n",(0,d.jsx)(n.li,{children:"\u76f4\u8fde\u7269\u7406\u7f51\u7edc"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h3,{id:"5\ufe0f\u20e3-ipvlan",children:"5\ufe0f\u20e3 ipvlan"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"eth0 (\u4e00\u4e2a MAC)\n \u251c\u2500 ipvlan A (IP \u533a\u5206)\n \u251c\u2500 ipvlan B\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u7279\u70b9\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u4e0d\u5b66\u4e60 MAC"}),"\n",(0,d.jsx)(n.li,{children:"\u4f9d\u8d56 L3 \u8f6c\u53d1"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u9002\u5408\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u5927\u89c4\u6a21\u5bb9\u5668"}),"\n",(0,d.jsx)(n.li,{children:"\u4e91\u539f\u751f\u9ad8\u5bc6\u5ea6\u8282\u70b9"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"18-selection-summary",children:"18. Selection Summary"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\ud83e\uddea \u5b66\u4e60 / \u6559\u5b66\uff1a",(0,d.jsx)(n.strong,{children:"Linux Bridge"})]}),"\n",(0,d.jsxs)(n.li,{children:["\ud83d\udc33 Docker \u9ed8\u8ba4\uff1a",(0,d.jsx)(n.strong,{children:"Linux Bridge"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u2601\ufe0f \u4e91 / K8s\uff1a",(0,d.jsx)(n.strong,{children:"OVS / eBPF CNI"})]}),"\n",(0,d.jsxs)(n.li,{children:["\ud83d\ude80 \u6781\u81f4\u6027\u80fd\uff1a",(0,d.jsx)(n.strong,{children:"macvlan / ipvlan"})]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(x,{...e})}):x(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>h});var r=i(96540);const d={},s=r.createContext(d);function l(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function h(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:l(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);