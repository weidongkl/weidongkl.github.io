"use strict";(self.webpackChunkweidongkl_github_io=self.webpackChunkweidongkl_github_io||[]).push([[8494],{7550:(n,e,c)=>{c.r(e),c.d(e,{assets:()=>l,contentTitle:()=>d,default:()=>x,frontMatter:()=>s,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"note/golang/concurrency","title":"Golang \u5e76\u53d1\u7f16\u7a0b","description":"\u5728 Golang \u4e2d\uff0c\u591a\u534f\u7a0b goroutine\u4e4b\u95f4\u7684\u4ea4\u4e92\u4e3b\u8981\u901a\u8fc7\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\u5b9e\u73b0\uff1a","source":"@site/docs/note/golang/concurrency.md","sourceDirName":"note/golang","slug":"/note/golang/concurrency","permalink":"/docs/note/golang/concurrency","draft":false,"unlisted":false,"editUrl":"https://github.com/weidongkl/weidongkl.github.io/tree/master/docs/note/golang/concurrency.md","tags":[],"version":"current","lastUpdatedBy":"weidongkl","lastUpdatedAt":1745329263000,"frontMatter":{},"sidebar":"note","previous":{"title":"Golang os/exec \u7528\u6cd5","permalink":"/docs/note/golang/cmd"},"next":{"title":"Golang runtime/debug \u7528\u6cd5","permalink":"/docs/note/golang/debug"}}');var i=c(4848),r=c(8453);const s={},d="Golang \u5e76\u53d1\u7f16\u7a0b",l={},o=[{value:"1. Channel\uff08\u63a8\u8350\u65b9\u5f0f\uff09",id:"1-channel\u63a8\u8350\u65b9\u5f0f",level:2},{value:"1.1 Channel \u7684\u7279\u70b9",id:"11-channel-\u7684\u7279\u70b9",level:3},{value:"1.2 \u57fa\u7840\u793a\u4f8b\uff1a",id:"12-\u57fa\u7840\u793a\u4f8b",level:3},{value:"1.3 select \u7ed3\u5408 channel \u7528\u6cd5",id:"13-select-\u7ed3\u5408-channel-\u7528\u6cd5",level:3},{value:"1.4 Channel \u7684\u9002\u7528\u573a\u666f",id:"14-channel-\u7684\u9002\u7528\u573a\u666f",level:3},{value:"2. sync.WaitGroup`",id:"2-syncwaitgroup",level:2},{value:"3.  <code>sync.Mutex</code>",id:"3--syncmutex",level:2},{value:"4.  <code>sync.Cond</code> \u8fdb\u884c\u4e8b\u4ef6\u901a\u77e5",id:"4--synccond-\u8fdb\u884c\u4e8b\u4ef6\u901a\u77e5",level:2},{value:"5.  <code>sync.Once</code>",id:"5--synconce",level:2},{value:"6.  <code>atomic</code>",id:"6--atomic",level:2},{value:"\u793a\u4f8b\uff1a",id:"\u793a\u4f8b",level:3},{value:"7.  <code>context</code>",id:"7--context",level:2},{value:"\u793a\u4f8b\uff1a",id:"\u793a\u4f8b-1",level:3},{value:"<strong>\u603b\u7ed3</strong>",id:"\u603b\u7ed3",level:2}];function h(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"golang-\u5e76\u53d1\u7f16\u7a0b",children:"Golang \u5e76\u53d1\u7f16\u7a0b"})}),"\n",(0,i.jsx)(e.p,{children:"\u5728 Golang \u4e2d\uff0c\u591a\u534f\u7a0b goroutine\u4e4b\u95f4\u7684\u4ea4\u4e92\u4e3b\u8981\u901a\u8fc7\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\u5b9e\u73b0\uff1a"}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"1-channel\u63a8\u8350\u65b9\u5f0f",children:"1. Channel\uff08\u63a8\u8350\u65b9\u5f0f\uff09"}),"\n",(0,i.jsxs)(e.p,{children:["Golang \u63d0\u4f9b\u4e86 ",(0,i.jsx)(e.strong,{children:"channel"})," \u4f5c\u4e3a goroutine \u4e4b\u95f4\u901a\u4fe1\u7684\u4e3b\u8981\u65b9\u5f0f\u3002\u5b83\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u5e76\u4e14\u53ef\u4ee5\u907f\u514d\u6570\u636e\u7ade\u4e89\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"11-channel-\u7684\u7279\u70b9",children:"1.1 Channel \u7684\u7279\u70b9"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u907f\u514d\u7ade\u4e89\uff1a",(0,i.jsx)(e.code,{children:"channel"})," \u901a\u8fc7\u6d88\u606f\u4f20\u9012\uff0c\u800c\u4e0d\u662f\u5171\u4eab\u53d8\u91cf\uff0c\u51cf\u5c11\u6570\u636e\u7ade\u4e89\u7684\u53ef\u80fd\u6027\u3002"]}),"\n",(0,i.jsx)(e.li,{children:"\u66f4\u7b26\u5408 Go \u8bed\u8a00\u54f2\u5b66\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u4ee3\u7801\u66f4\u7b80\u6d01\uff1a\u907f\u514d\u624b\u52a8\u52a0\u9501\u548c\u89e3\u9501\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"12-\u57fa\u7840\u793a\u4f8b",children:"1.2 \u57fa\u7840\u793a\u4f8b\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"time"\n)\n\nfunc worker(ch chan string) {\n\ttime.Sleep(2 * time.Second)\n\tch <- "\u4efb\u52a1\u5b8c\u6210"\n}\n\nfunc main() {\n\tch := make(chan string) // \u521b\u5efa\u4e00\u4e2a\u65e0\u7f13\u51b2 channel\n\tgo worker(ch)           // \u542f\u52a8 goroutine\n\n\tfmt.Println("\u7b49\u5f85\u4efb\u52a1\u5b8c\u6210...")\n\tmsg := <-ch // \u63a5\u6536\u6570\u636e\uff08\u963b\u585e\uff09\n\tfmt.Println("\u6536\u5230\u6d88\u606f:", msg)\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u91ca"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"ch := make(chan string)"})," \u521b\u5efa\u4e86\u4e00\u4e2a\u65e0\u7f13\u51b2\u7684 channel\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"go worker(ch)"})," \u542f\u52a8\u4e00\u4e2a\u534f\u7a0b ",(0,i.jsx)(e.code,{children:"worker"}),"\uff0c\u5e76\u901a\u8fc7 channel \u53d1\u9001\u6d88\u606f\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"msg := <-ch"})," \u5728\u4e3b\u7ebf\u7a0b\u963b\u585e\u7b49\u5f85\uff0c\u76f4\u5230 ",(0,i.jsx)(e.code,{children:"worker"})," \u53d1\u9001\u6570\u636e\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"13-select-\u7ed3\u5408-channel-\u7528\u6cd5",children:"1.3 select \u7ed3\u5408 channel \u7528\u6cd5"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"select"})," \u8bed\u53e5\u5141\u8bb8\u4ece\u591a\u4e2a ",(0,i.jsx)(e.code,{children:"channel"})," \u8bfb\u53d6\u6570\u636e\uff0c\u6216\u8005\u5728\u901a\u9053\u65e0\u6570\u636e\u65f6\u6267\u884c\u9ed8\u8ba4\u64cd\u4f5c\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"time"\n)\n\nfunc main() {\n\tch1 := make(chan string)\n\tch2 := make(chan string)\n\n\t// \u542f\u52a8 goroutine \u5411 ch1 \u53d1\u9001\u6570\u636e\n\tgo func() {\n\t\ttime.Sleep(2 * time.Second)\n\t\tch1 <- "Message from ch1"\n\t}()\n\n\t// \u542f\u52a8 goroutine \u5411 ch2 \u53d1\u9001\u6570\u636e\n\tgo func() {\n\t\ttime.Sleep(1 * time.Second)\n\t\tch2 <- "Message from ch2"\n\t}()\n\n\t// `select` \u76d1\u542c\u591a\u4e2a `channel`\n\tselect {\n\tcase msg1 := <-ch1:\n\t\tfmt.Println("Received:", msg1)\n\tcase msg2 := <-ch2:\n\t\tfmt.Println("Received:", msg2)\n\tcase <-time.After(3 * time.Second):\n\t\tfmt.Println("Timeout: No message received")\n\t}\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4ee3\u7801\u89e3\u6790"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"select"})," \u76d1\u542c ",(0,i.jsx)(e.code,{children:"ch1"})," \u548c ",(0,i.jsx)(e.code,{children:"ch2"}),"\uff0c\u54ea\u4e2a ",(0,i.jsx)(e.code,{children:"channel"})," \u5148\u6709\u6570\u636e\uff0c\u5c31\u4f1a\u6267\u884c\u5bf9\u5e94\u7684 ",(0,i.jsx)(e.code,{children:"case"}),"\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c 3 \u79d2\u5185\u6ca1\u6709\u6d88\u606f\u5230\u8fbe\uff0c\u5219 ",(0,i.jsx)(e.code,{children:"case <-time.After(3 * time.Second)"})," \u89e6\u53d1\uff0c\u9632\u6b62\u6c38\u4e45\u963b\u585e\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4f7f\u7528\u573a\u666f"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u76d1\u542c\u591a\u4e2a ",(0,i.jsx)(e.code,{children:"channel"}),"\uff0c\u907f\u514d\u963b\u585e\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8d85\u65f6\u63a7\u5236\uff1a\u5982 ",(0,i.jsx)(e.code,{children:"time.After"})," \u7ed3\u5408 ",(0,i.jsx)(e.code,{children:"select"})," \u9650\u5236\u8bf7\u6c42\u65f6\u95f4\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"14-channel-\u7684\u9002\u7528\u573a\u666f",children:"1.4 Channel \u7684\u9002\u7528\u573a\u666f"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4efb\u52a1\u961f\u5217\uff08\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\uff09\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u591a\u4e2a worker \u5904\u7406\u4efb\u52a1\uff0c\u907f\u514d\u5171\u4eab\u53d8\u91cf\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u9650\u5236\u5e76\u53d1\u4efb\u52a1\u7684\u6570\u91cf\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"2-syncwaitgroup",children:"2. sync.WaitGroup`"}),"\n",(0,i.jsxs)(e.p,{children:["\u5982\u679c\u591a\u4e2a goroutine \u9700\u8981\u540c\u6b65\u6267\u884c\u5b8c\u6bd5\u540e\u518d\u7ee7\u7eed\uff0c",(0,i.jsx)(e.code,{children:"sync.WaitGroup"})," \u662f\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u6cd5\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u793a\u4f8b\uff1a"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"sync"\n\t"time"\n)\n\nfunc worker(id int, wg *sync.WaitGroup) {\n\tdefer wg.Done() // \u6267\u884c\u5b8c\u6210\u540e\u51cf\u5c11\u8ba1\u6570\n\tfmt.Printf("Worker %d \u5f00\u59cb\u5de5\u4f5c...\\n", id)\n\ttime.Sleep(2 * time.Second)\n\tfmt.Printf("Worker %d \u5b8c\u6210\u5de5\u4f5c!\\n", id)\n}\n\nfunc main() {\n\tvar wg sync.WaitGroup\n\n\tfor i := 1; i <= 3; i++ {\n\t\twg.Add(1)           // \u589e\u52a0\u8ba1\u6570\n\t\tgo worker(i, &wg)   // \u542f\u52a8 goroutine\n\t}\n\n\twg.Wait() // \u7b49\u5f85\u6240\u6709\u4efb\u52a1\u5b8c\u6210\n\tfmt.Println("\u6240\u6709\u4efb\u52a1\u5b8c\u6210")\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u91ca"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"wg.Add(1)"})," \u589e\u52a0\u8ba1\u6570\uff0c\u6bcf\u4e2a goroutine \u5f00\u59cb\u65f6\u8c03\u7528\u4e00\u6b21\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"defer wg.Done()"})," \u5728 goroutine \u7ed3\u675f\u65f6\u51cf\u5c11\u8ba1\u6570\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"wg.Wait()"})," \u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u76f4\u5230\u6240\u6709 ",(0,i.jsx)(e.code,{children:"wg.Done()"})," \u8c03\u7528\u5b8c\u6bd5\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsxs)(e.h2,{id:"3--syncmutex",children:["3.  ",(0,i.jsx)(e.code,{children:"sync.Mutex"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u5f53\u591a\u4e2a goroutine \u9700\u8981\u4fee\u6539\u5171\u4eab\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"sync.Mutex"})," \u9632\u6b62\u7ade\u6001\u6761\u4ef6\uff08race condition\uff09\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u793a\u4f8b\uff1a"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"sync"\n\t"time"\n)\n\nvar (\n\tcounter int\n\tmu      sync.Mutex\n)\n\nfunc worker(id int, wg *sync.WaitGroup) {\n\tdefer wg.Done()\n\n\tmu.Lock()\n\tcounter++\n\tfmt.Printf("Worker %d \u8ba1\u6570: %d\\n", id, counter)\n\tmu.Unlock()\n}\n\nfunc main() {\n\tvar wg sync.WaitGroup\n\n\tfor i := 1; i <= 5; i++ {\n\t\twg.Add(1)\n\t\tgo worker(i, &wg)\n\t}\n\n\twg.Wait()\n\tfmt.Println("\u6700\u7ec8\u8ba1\u6570:", counter)\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u91ca"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"mu.Lock()"})," \u4fdd\u62a4 ",(0,i.jsx)(e.code,{children:"counter"}),"\uff0c\u9632\u6b62\u591a\u4e2a goroutine \u5e76\u53d1\u4fee\u6539\u65f6\u53d1\u751f\u7ade\u6001\u6761\u4ef6\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"mu.Unlock()"})," \u91ca\u653e\u9501\uff0c\u5141\u8bb8\u5176\u4ed6 goroutine \u7ee7\u7eed\u6267\u884c\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsxs)(e.h2,{id:"4--synccond-\u8fdb\u884c\u4e8b\u4ef6\u901a\u77e5",children:["4.  ",(0,i.jsx)(e.code,{children:"sync.Cond"})," \u8fdb\u884c\u4e8b\u4ef6\u901a\u77e5"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"sync.Cond"})," \u9002\u7528\u4e8e\u7b49\u5f85\u67d0\u4e2a\u6761\u4ef6\u6ee1\u8db3\u540e\u518d\u6267\u884c\u7684\u573a\u666f\uff0c\u4f8b\u5982\u591a\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u67d0\u4e2a\u4e8b\u4ef6\u89e6\u53d1\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u793a\u4f8b"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"sync"\n\t"time"\n)\n\nvar (\n\tready = false\n\tcond  = sync.NewCond(&sync.Mutex{})\n)\n\nfunc worker(id int) {\n\tcond.L.Lock()\n\tfor !ready {\n\t\tcond.Wait() // \u7b49\u5f85\u6761\u4ef6\u53d8\u4e3a true\n\t}\n\tfmt.Printf("Worker %d \u5f00\u59cb\u5de5\u4f5c!\\n", id)\n\tcond.L.Unlock()\n}\n\nfunc main() {\n\tvar wg sync.WaitGroup\n\n\tfor i := 1; i <= 3; i++ {\n\t\twg.Add(1)\n\t\tgo func(id int) {\n\t\t\tdefer wg.Done()\n\t\t\tworker(id)\n\t\t}(i)\n\t}\n\n\ttime.Sleep(2 * time.Second)\n\n\t// \u89e6\u53d1\u4e8b\u4ef6\n\tcond.L.Lock()\n\tready = true\n\tcond.L.Unlock()\n\tcond.Broadcast() // \u901a\u77e5\u6240\u6709\u7b49\u5f85\u7684 goroutine\n\n\twg.Wait()\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u91ca"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"cond.Wait()"})," \u7b49\u5f85\u6761\u4ef6 ",(0,i.jsx)(e.code,{children:"ready == true"}),"\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"cond.Broadcast()"})," \u5524\u9192\u6240\u6709\u7b49\u5f85\u7684 goroutine\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsxs)(e.h2,{id:"5--synconce",children:["5.  ",(0,i.jsx)(e.code,{children:"sync.Once"})]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"sync.Once"})," \u786e\u4fdd\u67d0\u4e2a\u64cd\u4f5c\u5728\u591a\u4e2a goroutine \u4e2d\u53ea\u6267\u884c\u4e00\u6b21\uff0c\u4f8b\u5982\u521d\u59cb\u5316\u64cd\u4f5c\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u793a\u4f8b"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"sync"\n)\n\nvar once sync.Once\n\nfunc initialize() {\n\tfmt.Println("\u521d\u59cb\u5316\u64cd\u4f5c")\n}\n\nfunc worker(wg *sync.WaitGroup) {\n\tdefer wg.Done()\n\tonce.Do(initialize)\n\tfmt.Println("Worker \u6267\u884c")\n}\n\nfunc main() {\n\tvar wg sync.WaitGroup\n\tfor i := 0; i < 5; i++ {\n\t\twg.Add(1)\n\t\tgo worker(&wg)\n\t}\n\n\twg.Wait()\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u91ca"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"once.Do(initialize)"})," \u786e\u4fdd ",(0,i.jsx)(e.code,{children:"initialize()"})," \u53ea\u6267\u884c\u4e00\u6b21\uff0c\u65e0\u8bba\u591a\u5c11\u4e2a goroutine \u8bbf\u95ee\u5b83\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsxs)(e.h2,{id:"6--atomic",children:["6.  ",(0,i.jsx)(e.code,{children:"atomic"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u5bf9\u4e8e\u7b80\u5355\u7684\u6570\u503c\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"sync/atomic"})," \u63d0\u4f9b\u7684\u539f\u5b50\u64cd\u4f5c\u4ee3\u66ff ",(0,i.jsx)(e.code,{children:"sync.Mutex"}),"\uff0c\u63d0\u5347\u6027\u80fd\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"\u793a\u4f8b",children:"\u793a\u4f8b\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"sync"\n\t"sync/atomic"\n)\n\nvar counter int64\n\nfunc worker(wg *sync.WaitGroup) {\n\tdefer wg.Done()\n\tatomic.AddInt64(&counter, 1) // \u539f\u5b50\u9012\u589e\n}\n\nfunc main() {\n\tvar wg sync.WaitGroup\n\tfor i := 0; i < 10; i++ {\n\t\twg.Add(1)\n\t\tgo worker(&wg)\n\t}\n\twg.Wait()\n\tfmt.Println("\u6700\u7ec8\u8ba1\u6570:", counter)\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u91ca"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"atomic.AddInt64(&counter, 1)"})," \u786e\u4fdd ",(0,i.jsx)(e.code,{children:"counter"})," \u5728\u591a\u4e2a goroutine \u4e2d\u5b89\u5168\u9012\u589e\uff0c\u65e0\u9700\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"sync.Mutex"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsxs)(e.h2,{id:"7--context",children:["7.  ",(0,i.jsx)(e.code,{children:"context"})]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"context.Context"})," \u9002\u7528\u4e8e\u63a7\u5236\u591a\u4e2a goroutine \u7684\u751f\u547d\u5468\u671f\uff0c\u4f8b\u5982\u8d85\u65f6\u3001\u53d6\u6d88\u4efb\u52a1\u7b49\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"\u793a\u4f8b-1",children:"\u793a\u4f8b\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"context"\n\t"fmt"\n\t"time"\n)\n\nfunc worker(ctx context.Context) {\n\tfor {\n\t\tselect {\n\t\tcase <-ctx.Done():\n\t\t\tfmt.Println("Worker \u4efb\u52a1\u8d85\u65f6\uff0c\u9000\u51fa")\n\t\t\treturn\n\t\tdefault:\n\t\t\tfmt.Println("Worker \u6b63\u5728\u5de5\u4f5c...")\n\t\t\ttime.Sleep(500 * time.Millisecond)\n\t\t}\n\t}\n}\n\nfunc main() {\n\tctx, cancel := context.WithTimeout(context.Background(), 2*time.Second)\n\tdefer cancel()\n\n\tgo worker(ctx)\n\n\ttime.Sleep(3 * time.Second) // \u4e3b\u7ebf\u7a0b\u7b49\u5f85\n\tfmt.Println("\u4e3b\u7ebf\u7a0b\u9000\u51fa")\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u91ca"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"context.WithTimeout"})," 2 \u79d2\u540e\u4f1a\u81ea\u52a8\u53d6\u6d88 ",(0,i.jsx)(e.code,{children:"ctx"}),"\uff0c\u901a\u77e5 ",(0,i.jsx)(e.code,{children:"worker"})," \u9000\u51fa\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u603b\u7ed3",children:(0,i.jsx)(e.strong,{children:"\u603b\u7ed3"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u65b9\u5f0f"}),(0,i.jsx)(e.th,{children:"\u9002\u7528\u573a\u666f"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Channel"}),(0,i.jsx)(e.td,{children:"\u5b89\u5168\u7684\u6570\u636e\u4f20\u9012\uff0c\u907f\u514d\u7ade\u6001\u6761\u4ef6"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"WaitGroup"}),(0,i.jsx)(e.td,{children:"\u7b49\u5f85\u591a\u4e2a goroutine \u7ed3\u675f"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Mutex"}),(0,i.jsx)(e.td,{children:"\u4fdd\u62a4\u5171\u4eab\u8d44\u6e90\uff0c\u9632\u6b62\u7ade\u6001"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Cond"}),(0,i.jsx)(e.td,{children:"\u4e8b\u4ef6\u89e6\u53d1\uff0c\u7b49\u5f85\u901a\u77e5"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Once"}),(0,i.jsx)(e.td,{children:"\u53ea\u6267\u884c\u4e00\u6b21\uff08\u5355\u4f8b\u6a21\u5f0f\uff09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Atomic"}),(0,i.jsx)(e.td,{children:"\u9ad8\u6548\u6570\u503c\u8ba1\u7b97\uff0c\u65e0\u9501\u5e76\u53d1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Context"}),(0,i.jsx)(e.td,{children:"\u8d85\u65f6\u3001\u53d6\u6d88\u4efb\u52a1"})]})]})]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c\u4e3b\u8981\u662f goroutine \u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"channel"}),"\uff08\u66f4\u5b89\u5168\uff0c\u907f\u514d\u9501\u7ade\u4e89\uff09\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c\u662f\u591a\u4e2a goroutine \u64cd\u4f5c\u540c\u4e00\u4e2a\u53d8\u91cf\uff0c\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"mutex"}),"\uff08\u66f4\u9ad8\u6548\uff09\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c\u8981\u9650\u5236\u5e76\u53d1\u6570\uff0c\u4e8c\u8005\u53ef\u4ee5\u7ed3\u5408\u4f7f\u7528\uff0c\u5982 ",(0,i.jsx)(e.code,{children:"channel"})," \u63a7\u5236\u5e76\u53d1\uff0c",(0,i.jsx)(e.code,{children:"mutex"})," \u4fdd\u62a4\u6570\u636e\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"select"})," \u9002\u7528\u4e8e\u76d1\u542c\u591a\u4e2a ",(0,i.jsx)(e.code,{children:"channel"})," \u548c\u8d85\u65f6\u63a7\u5236\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u63a8\u8350\u505a\u6cd5\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4f18\u5148\u8003\u8651 ",(0,i.jsx)(e.code,{children:"channel"}),"\uff0c\u7b26\u5408 Go \u8bed\u8a00\u98ce\u683c\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c\u6027\u80fd\u74f6\u9888\u660e\u663e\uff08\u9ad8\u9891\u6570\u636e\u8bbf\u95ee\uff09\uff0c\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"sync.Mutex"})," \u8fdb\u884c\u4f18\u5316\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c\u6709\u5e76\u53d1\u63a7\u5236\u9700\u6c42\uff0c\u53ef\u4ee5\u7ed3\u5408 ",(0,i.jsx)(e.code,{children:"channel"})," \u548c ",(0,i.jsx)(e.code,{children:"mutex"}),"\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"select"})," \u9002\u7528\u4e8e\u76d1\u542c\u591a\u4e2a ",(0,i.jsx)(e.code,{children:"channel"})," \u548c\u8d85\u65f6\u63a7\u5236\u3002"]}),"\n"]})]})}function x(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},8453:(n,e,c)=>{c.d(e,{R:()=>s,x:()=>d});var t=c(6540);const i={},r=t.createContext(i);function s(n){const e=t.useContext(r);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:s(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);