"use strict";(self.webpackChunkweidongkl_github_io=self.webpackChunkweidongkl_github_io||[]).push([[79],{2770:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>a,frontMatter:()=>t,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"note/golang/design/microkernel/microkernel2","title":"microkernel \u8bbe\u8ba12","description":"microkernel \u8bbe\u8ba11 \u76ee\u524d\u53ea\u652f\u6301\u670d\u52a1\u53d1\u9001\u6d88\u606f\uff0c\u5185\u6838\u63a5\u53d7\u6d88\u606f\u3002","source":"@site/docs/note/golang/design/microkernel/microkernel2.md","sourceDirName":"note/golang/design/microkernel","slug":"/note/golang/design/microkernel/microkernel2","permalink":"/docs/note/golang/design/microkernel/microkernel2","draft":false,"unlisted":false,"editUrl":"https://github.com/weidongkl/weidongkl.github.io/tree/master/docs/note/golang/design/microkernel/microkernel2.md","tags":[],"version":"current","lastUpdatedBy":"weidongkl","lastUpdatedAt":1745719941000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"note","previous":{"title":"microkernel \u8bbe\u8ba11","permalink":"/docs/note/golang/design/microkernel/microkernel1"},"next":{"title":"microkernel \u8bbe\u8ba13","permalink":"/docs/note/golang/design/microkernel/microkernel3"}}');var i=r(4848),o=r(8453);const t={sidebar_position:2},s="microkernel \u8bbe\u8ba12",c={},d=[{value:"1. \u76ee\u6807",id:"1-\u76ee\u6807",level:2},{value:"2. \u4ee3\u7801\u6539\u52a8",id:"2-\u4ee3\u7801\u6539\u52a8",level:2},{value:"2.1 Kernel\uff08\u6838\u5fc3\uff09",id:"21-kernel\u6838\u5fc3",level:3},{value:"2.2 LogService",id:"22-logservice",level:3},{value:"2.3 \u4e3b\u7a0b\u5e8f\uff08\u8fd0\u884c\u5fae\u5185\u6838 + \u670d\u52a1\uff09",id:"23-\u4e3b\u7a0b\u5e8f\u8fd0\u884c\u5fae\u5185\u6838--\u670d\u52a1",level:3},{value:"2.4 \u8fd0\u884c\u7ed3\u679c",id:"24-\u8fd0\u884c\u7ed3\u679c",level:3},{value:"2.5 \u4f18\u5316\u51fd\u6570\u548c\u53d8\u91cf\u547d\u540d",id:"25-\u4f18\u5316\u51fd\u6570\u548c\u53d8\u91cf\u547d\u540d",level:3}];function g(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"microkernel-\u8bbe\u8ba12",children:"microkernel \u8bbe\u8ba12"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"./microkernel1",children:"microkernel \u8bbe\u8ba11"})," \u76ee\u524d\u53ea\u652f\u6301\u670d\u52a1\u53d1\u9001\u6d88\u606f\uff0c\u5185\u6838\u63a5\u53d7\u6d88\u606f\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u672c\u7ae0\u8282\uff0c\u6211\u4f1a\u589e\u52a0\u5185\u6838\u53d1\u9001\u6d88\u606f\u5230\u670d\u52a1"}),"\n",(0,i.jsx)(n.h2,{id:"1-\u76ee\u6807",children:"1. \u76ee\u6807"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5185\u6838\u53d1\u9001\u6d88\u606f\u5230\u670d\u52a1"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-\u4ee3\u7801\u6539\u52a8",children:"2. \u4ee3\u7801\u6539\u52a8"}),"\n",(0,i.jsx)(n.h3,{id:"21-kernel\u6838\u5fc3",children:"2.1 Kernel\uff08\u6838\u5fc3\uff09"}),"\n",(0,i.jsx)(n.p,{children:"\u670d\u52a1\u589e\u52a0\u6d88\u606f\u5904\u7406\u65b9\u6cd5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// kernel/kernel.go\ntype Service interface {\n\tStart() error\n\tStop() error\n\tName() string\n    // \u589e\u52a0\u6d88\u606f\u5904\u7406\u65b9\u6cd5\n\tHandle(msg string) string\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4e8b\u4ef6\u589e\u52a0\u53d1\u9001\u5730\u5740"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// kernel/kernel.go\n// Event \u5b9a\u4e49\u5185\u6838\u4e8b\u4ef6\uff08\u7528\u4e8e\u670d\u52a1\u95f4\u901a\u4fe1\uff09\ntype Event struct {\n\tTo      string\n\tFrom    string\n\tType    string\n\tContent string\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5185\u6838\u53d1\u9001\u4e8b\u4ef6\u5230\u670d\u52a1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// kernel/kernel.go\n// HandleEvent \u5904\u7406\u4e8b\u4ef6\uff08\u6a21\u62df\u670d\u52a1\u95f4\u901a\u4fe1\uff09\nfunc (k *Kernel) HandleEvent(evt Event) (msg string) {\n\tk.mutex.RLock()\n\tdefer k.mutex.RUnlock()\n\n\tif svc, ok := k.services[evt.To]; ok {\n\t\treturn svc.Handle(evt.Content)\n\t}\n\treturn "service not found"\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"22-logservice",children:"2.2 LogService"}),"\n",(0,i.jsx)(n.p,{children:"\u589e\u52a0Handle\u65b9\u6cd5\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// service/log.go\n// service \u589e\u52a0Handle\u63a5\u53e3\u5b9e\u73b0\nfunc (l *LogService) Handle(msg string) string {\n\tfmt.Printf("[%s] LOG handle kernel event: %s\\n", l.name, msg)\n\treturn fmt.Sprintf("[%s] LOG Handle: %s\\n", l.name, msg)\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"23-\u4e3b\u7a0b\u5e8f\u8fd0\u884c\u5fae\u5185\u6838--\u670d\u52a1",children:"2.3 \u4e3b\u7a0b\u5e8f\uff08\u8fd0\u884c\u5fae\u5185\u6838 + \u670d\u52a1\uff09"}),"\n",(0,i.jsx)(n.p,{children:"kernel\u53d1\u9001\u6d88\u606f\u5230service"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// main.go\n// 6. microKernel \u53d1\u9001\u4e8b\u4ef6\u5230\u6307\u5b9a\u670d\u52a1\n\tmicroKernel.HandleEvent(kernel.Event{\n\t\tFrom:    "microKernel",\n\t\tTo:      "logger",\n\t\tType:    "log",\n\t\tContent: "Hello, Log!",\n\t})\n\ttime.Sleep(1 * time.Millisecond)\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"24-\u8fd0\u884c\u7ed3\u679c",children:"2.4 \u8fd0\u884c\u7ed3\u679c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[logger] starting...\n[logger] LOG: Hello, Microkernel!\n[Kernel] Event from logger: log - Hello, Microkernel!\n[logger] LOG handle kernel event: Hello, Log!\n[logger] stopping...\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u67e5\u770b",(0,i.jsx)(n.a,{href:"https://gitee.com/weidongkl/weidongkl.github.io/blob/master/docs/note/golang/design/microkernel/microkernel2-1",children:"\u5b8c\u6574\u4ee3\u7801"})]}),"\n",(0,i.jsx)(n.h3,{id:"25-\u4f18\u5316\u51fd\u6570\u548c\u53d8\u91cf\u547d\u540d",children:"2.5 \u4f18\u5316\u51fd\u6570\u548c\u53d8\u91cf\u547d\u540d"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"HandleEvent"})," \u4fee\u6539\u4e3a ",(0,i.jsx)(n.code,{children:"Send"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SendEvent"})," \u4fee\u6539\u4e3a ",(0,i.jsx)(n.code,{children:"Push"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"LoopEvent"})," \u4fee\u6539\u4e3a",(0,i.jsx)(n.code,{children:"Listen"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mutex"}),"\u4fee\u6539\u4e3a ",(0,i.jsx)(n.code,{children:"mu"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u67e5\u770b",(0,i.jsx)(n.a,{href:"https://gitee.com/weidongkl/weidongkl.github.io/blob/master/docs/note/golang/design/microkernel/microkernel2-2",children:"\u5b8c\u6574\u4ee3\u7801"})]}),"\n",(0,i.jsx)(n.h3,{id:""})]})}function a(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(g,{...e})}):g(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>s});var l=r(6540);const i={},o=l.createContext(i);function t(e){const n=l.useContext(o);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);