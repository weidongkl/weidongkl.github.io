"use strict";(self.webpackChunkweidongkl_github_io=self.webpackChunkweidongkl_github_io||[]).push([[3507],{40604:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"note/web/django/django_drf","title":"Django + DRF \u57fa\u7840","description":"1. \u57fa\u7840\u4ecb\u7ecd","source":"@site/docs/note/web/django/django_drf.md","sourceDirName":"note/web/django","slug":"/note/web/django/django_drf","permalink":"/docs/note/web/django/django_drf","draft":false,"unlisted":false,"editUrl":"https://github.com/weidongkl/weidongkl.github.io/tree/master/docs/note/web/django/django_drf.md","tags":[],"version":"current","lastUpdatedBy":"weidongkl","lastUpdatedAt":1757580691000,"frontMatter":{},"sidebar":"note","previous":{"title":"Gin + Swagger","permalink":"/docs/note/web/gin/swagger"},"next":{"title":"Golang","permalink":"/docs/category/golang"}}');var l=s(74848),i=s(28453);const t={},d="Django + DRF \u57fa\u7840",c={},o=[{value:"1. \u57fa\u7840\u4ecb\u7ecd",id:"1-\u57fa\u7840\u4ecb\u7ecd",level:2},{value:"1.1 Django \u7b80\u4ecb",id:"11-django-\u7b80\u4ecb",level:3},{value:"1.2 Django REST framework (DRF) \u7b80\u4ecb",id:"12-django-rest-framework-drf-\u7b80\u4ecb",level:3},{value:"2. \u73af\u5883\u642d\u5efa",id:"2-\u73af\u5883\u642d\u5efa",level:2},{value:"2.1 \u5b89\u88c5",id:"21-\u5b89\u88c5",level:3},{value:"2.2 \u521b\u5efa\u9879\u76ee",id:"22-\u521b\u5efa\u9879\u76ee",level:3},{value:"3. \u6a21\u578b\u5b9a\u4e49",id:"3-\u6a21\u578b\u5b9a\u4e49",level:2},{value:"3.1 \u5e38\u7528\u5b57\u6bb5",id:"31-\u5e38\u7528\u5b57\u6bb5",level:3},{value:"3.1.1 \u5b57\u6bb5\u901a\u7528\u53c2\u6570",id:"311-\u5b57\u6bb5\u901a\u7528\u53c2\u6570",level:4},{value:"3.1.2 \u91cd\u70b9\u53c2\u6570\u8be6\u89e3",id:"312-\u91cd\u70b9\u53c2\u6570\u8be6\u89e3",level:4},{value:"<code>blank</code> vs <code>null</code> \u533a\u522b",id:"blank-vs-null-\u533a\u522b",level:3},{value:"<code>DateTimeField</code> \u65f6\u95f4\u53c2\u6570",id:"datetimefield-\u65f6\u95f4\u53c2\u6570",level:3},{value:"<code>ForeignKey</code> \u5916\u952e\u53c2\u6570",id:"foreignkey-\u5916\u952e\u53c2\u6570",level:3},{value:"<code>choices</code> \u679a\u4e3e\u5b57\u6bb5\u7528\u6cd5",id:"choices-\u679a\u4e3e\u5b57\u6bb5\u7528\u6cd5",level:3},{value:"3.2 Demo \u793a\u4f8b",id:"32-demo-\u793a\u4f8b",level:3},{value:"4. \u5e8f\u5217\u5316\u5668",id:"4-\u5e8f\u5217\u5316\u5668",level:2},{value:"5. \u89c6\u56fe &amp; \u8def\u7531",id:"5-\u89c6\u56fe--\u8def\u7531",level:2},{value:"5.1 \u89c6\u56fe",id:"51-\u89c6\u56fe",level:3},{value:"5.2 \u8def\u7531",id:"52-\u8def\u7531",level:3},{value:"6. API \u793a\u4f8b\u6548\u679c",id:"6-api-\u793a\u4f8b\u6548\u679c",level:2},{value:"6.1 \u521b\u5efa\u7528\u6237",id:"61-\u521b\u5efa\u7528\u6237",level:3},{value:"6.2 \u521b\u5efa\u9879\u76ee\uff08\u591a\u5bf9\u4e00\uff09",id:"62-\u521b\u5efa\u9879\u76ee\u591a\u5bf9\u4e00",level:3},{value:"6.3 \u521b\u5efa\u4efb\u52a1\uff08\u591a\u5bf9\u591a + \u5916\u952e\uff09",id:"63-\u521b\u5efa\u4efb\u52a1\u591a\u5bf9\u591a--\u5916\u952e",level:3},{value:"6.4 \u67e5\u8be2\u9879\u76ee\uff08\u4e00\u5bf9\u591a\uff09",id:"64-\u67e5\u8be2\u9879\u76ee\u4e00\u5bf9\u591a",level:3},{value:"7. \u8fdb\u9636\u7528\u6cd5",id:"7-\u8fdb\u9636\u7528\u6cd5",level:2},{value:"7.1 \u5206\u9875\u5b9a\u5236",id:"71-\u5206\u9875\u5b9a\u5236",level:3},{value:"7.1.1 \u9ed8\u8ba4\u5206\u9875",id:"711-\u9ed8\u8ba4\u5206\u9875",level:4},{value:"7.1.2 \u81ea\u5b9a\u4e49\u5206\u9875",id:"712-\u81ea\u5b9a\u4e49\u5206\u9875",level:4},{value:"7.2 \u81ea\u5b9a\u4e49\u7edf\u4e00\u54cd\u5e94\u7ed3\u6784",id:"72-\u81ea\u5b9a\u4e49\u7edf\u4e00\u54cd\u5e94\u7ed3\u6784",level:3},{value:"7.2.1 \u81ea\u5b9a\u4e49 Response \u5c01\u88c5",id:"721-\u81ea\u5b9a\u4e49-response-\u5c01\u88c5",level:4},{value:"7.2.2 \u5168\u5c40\u7edf\u4e00\uff08Renderer\uff09",id:"722-\u5168\u5c40\u7edf\u4e00renderer",level:4},{value:"7.3 \u81ea\u52a8\u751f\u6210 API \u6587\u6863",id:"73-\u81ea\u52a8\u751f\u6210-api-\u6587\u6863",level:3},{value:"7.3.1 drf-yasg \u65b9\u5f0f",id:"731-drf-yasg-\u65b9\u5f0f",level:4},{value:"7.3.2 drf-spectacular \u65b9\u5f0f\uff08\u63a8\u8350\uff09",id:"732-drf-spectacular-\u65b9\u5f0f\u63a8\u8350",level:4},{value:"7.4 \u8fc7\u6ee4\u548c\u641c\u7d22",id:"74-\u8fc7\u6ee4\u548c\u641c\u7d22",level:3},{value:"7.5 \u8ba4\u8bc1\u548c\u6743\u9650",id:"75-\u8ba4\u8bc1\u548c\u6743\u9650",level:3},{value:"7.5.1 \u5e38\u89c1\u8ba4\u8bc1\u65b9\u5f0f",id:"751-\u5e38\u89c1\u8ba4\u8bc1\u65b9\u5f0f",level:4},{value:"7.5.2 \u6743\u9650\u63a7\u5236",id:"752-\u6743\u9650\u63a7\u5236",level:4},{value:"7.6 Middleware",id:"76-middleware",level:3},{value:"7.6.1 \u7b80\u4ecb",id:"761-\u7b80\u4ecb",level:4},{value:"7.6.2 Middleware \u751f\u547d\u5468\u671f",id:"762-middleware-\u751f\u547d\u5468\u671f",level:4},{value:"7.6.3 \u81ea\u5b9a\u4e49 Middleware \u793a\u4f8b",id:"763-\u81ea\u5b9a\u4e49-middleware-\u793a\u4f8b",level:4},{value:"7.7 DRF Exception Handler",id:"77-drf-exception-handler",level:3},{value:"7.7.1 \u4f5c\u7528",id:"771-\u4f5c\u7528",level:4},{value:"7.7.2 \u81ea\u5b9a\u4e49 Exception Handler",id:"772-\u81ea\u5b9a\u4e49-exception-handler",level:4},{value:"7.7.3 \u6548\u679c",id:"773-\u6548\u679c",level:4},{value:"8. \u53c2\u8003\u8d44\u6e90",id:"8-\u53c2\u8003\u8d44\u6e90",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"django--drf-\u57fa\u7840",children:"Django + DRF \u57fa\u7840"})}),"\n",(0,l.jsx)(n.h2,{id:"1-\u57fa\u7840\u4ecb\u7ecd",children:"1. \u57fa\u7840\u4ecb\u7ecd"}),"\n",(0,l.jsx)(n.h3,{id:"11-django-\u7b80\u4ecb",children:"1.1 Django \u7b80\u4ecb"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4e00\u4e2a\u9ad8\u7ea7 Python Web \u6846\u67b6\uff0c\u9075\u5faa ",(0,l.jsx)(n.strong,{children:"MTV \u6a21\u5f0f\uff08Model-Template-View\uff09"}),"\u3002"]}),"\n",(0,l.jsx)(n.li,{children:"\u63d0\u4f9b ORM\u3001\u8def\u7531\u3001\u6a21\u677f\u3001\u8ba4\u8bc1\u7cfb\u7edf\u3001\u540e\u53f0\u7ba1\u7406\u7b49\u529f\u80fd\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u9002\u5408\u5feb\u901f\u5f00\u53d1\uff0c\u5c24\u5176\u662f\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf\u548c API\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"12-django-rest-framework-drf-\u7b80\u4ecb",children:"1.2 Django REST framework (DRF) \u7b80\u4ecb"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Django \u7684\u7b2c\u4e09\u65b9\u5e93\uff0c\u7528\u4e8e\u5feb\u901f\u5f00\u53d1 ",(0,l.jsx)(n.strong,{children:"RESTful API"}),"\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u7279\u70b9\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5e8f\u5217\u5316\uff08Serializers\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u8ba4\u8bc1\u4e0e\u6743\u9650\uff08Authentication & Permissions\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u5206\u9875\uff08Pagination\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u8fc7\u6ee4\u4e0e\u641c\u7d22"}),"\n",(0,l.jsx)(n.li,{children:"\u6d4f\u89c8\u5668\u53ef\u89c6\u5316 API"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"2-\u73af\u5883\u642d\u5efa",children:"2. \u73af\u5883\u642d\u5efa"}),"\n",(0,l.jsx)(n.h3,{id:"21-\u5b89\u88c5",children:"2.1 \u5b89\u88c5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"python3 -m venv venv\nsource venv/bin/activate\npip install django djangorestframework\npip install drf-yasg # \u6587\u6863\uff0c\u53ef\u4e0d\u5b89\u88c5\npip install drf-spectacular # \u6587\u6863\uff0c\u53ef\u4e0d\u5b89\u88c5\npip install djangorestframework-simplejwt # \u8ba4\u8bc1\n"})}),"\n",(0,l.jsx)(n.h3,{id:"22-\u521b\u5efa\u9879\u76ee",children:"2.2 \u521b\u5efa\u9879\u76ee"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"django-admin startproject myproject\ncd myproject\npython manage.py startapp demo\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6ce8\u518c\u5e94\u7528\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"INSTALLED_APPS = [\n    ...\n    'rest_framework',\n    'demo',\n]\n"})}),"\n",(0,l.jsx)(n.h2,{id:"3-\u6a21\u578b\u5b9a\u4e49",children:"3. \u6a21\u578b\u5b9a\u4e49"}),"\n",(0,l.jsx)(n.h3,{id:"31-\u5e38\u7528\u5b57\u6bb5",children:"3.1 \u5e38\u7528\u5b57\u6bb5"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"\u5b57\u6bb5\u7c7b\u578b"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"\u8bf4\u660e"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"\u5e38\u7528\u573a\u666f"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"\u793a\u4f8b"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"CharField(max_length=...)"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u5b57\u7b26\u4e32\u5b57\u6bb5"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u77ed\u6587\u672c\u6570\u636e\uff08\u6807\u9898\u3001\u540d\u79f0\u7b49\uff09"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"title = CharField(max_length=100)"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"TextField"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u957f\u6587\u672c\u5b57\u6bb5"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u6587\u7ae0\u5185\u5bb9\u3001\u8be6\u7ec6\u63cf\u8ff0\u7b49\u5927\u6bb5\u6587\u672c"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"content = TextField()"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"IntegerField"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u6574\u6570\u5b57\u6bb5"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u6570\u91cf\u3001\u5e74\u9f84\u3001\u8bc4\u5206\u7b49\u6574\u6570\u503c"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"age = IntegerField()"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"BooleanField"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u5e03\u5c14\u503c\u5b57\u6bb5"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u662f\u5426\u542f\u7528\u3001\u662f\u5426\u5b8c\u6210\u7b49\u4e8c\u503c\u72b6\u6001"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"is_active = BooleanField(default=True)"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"DateTimeField"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u65e5\u671f\u65f6\u95f4\u5b57\u6bb5"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u521b\u5efa\u65f6\u95f4\u3001\u66f4\u65b0\u65f6\u95f4\u7b49\u65f6\u95f4\u6233"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"created_at = DateTimeField(auto_now_add=True)"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"ForeignKey"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u5916\u952e\u5173\u8054"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u4e00\u5bf9\u591a\u5173\u7cfb\uff08\u5982\u7528\u6237\u4e0e\u6587\u7ae0\uff09"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"author = ForeignKey(User, on_delete=models.CASCADE)"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"ManyToManyField"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u591a\u5bf9\u591a\u5173\u8054"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u591a\u5bf9\u591a\u5173\u7cfb\uff08\u5982\u6587\u7ae0\u4e0e\u6807\u7b7e\uff09"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"tags = ManyToManyField(Tag)"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"choices"})," + ",(0,l.jsx)(n.code,{children:"get_xxx_display()"})]})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u679a\u4e3e\u9009\u62e9\u5b57\u6bb5"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u72b6\u6001\u3001\u7c7b\u578b\u7b49\u6709\u9650\u9009\u9879\u5b57\u6bb5"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"status = CharField(max_length=10, choices=STATUS_CHOICES)"})})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"311-\u5b57\u6bb5\u901a\u7528\u53c2\u6570",children:"3.1.1 \u5b57\u6bb5\u901a\u7528\u53c2\u6570"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"\u53c2\u6570"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"\u7c7b\u578b"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"\u8bf4\u660e"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"\u9002\u7528\u5b57\u6bb5"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"\u793a\u4f8b"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"max_length"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"int"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.strong,{children:"\u6700\u5927\u957f\u5ea6\u9650\u5236"}),"\uff08\u5fc5\u586b\uff09"]}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.code,{children:"CharField"}),"\u53ca\u57fa\u4e8e\u5b83\u7684\u5b57\u6bb5"]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"max_length=100"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"verbose_name"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"str"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.strong,{children:"\u5b57\u6bb5\u663e\u793a\u540d\u79f0"}),"\uff08\u7528\u4e8eAdmin\u548c\u8868\u5355\uff09"]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u6240\u6709\u5b57\u6bb5"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:'verbose_name="\u7528\u6237\u59d3\u540d"'})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"unique"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"bool"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.strong,{children:"\u552f\u4e00\u6027\u7ea6\u675f"}),"\uff08\u4e0d\u5141\u8bb8\u91cd\u590d\u503c\uff09"]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u6240\u6709\u5b57\u6bb5"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"unique=True"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"blank"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"bool"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.strong,{children:"\u8868\u5355\u9a8c\u8bc1"}),"\u5c42\u9762\u662f\u5426\u5141\u8bb8\u4e3a\u7a7a"]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u6240\u6709\u5b57\u6bb5"}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.code,{children:"blank=True"}),"\uff08\u8868\u5355\u53ef\u9009\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"null"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"bool"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.strong,{children:"\u6570\u636e\u5e93"}),"\u5c42\u9762\u662f\u5426\u5141\u8bb8\u5b58\u50a8",(0,l.jsx)(n.code,{children:"NULL"}),"\u503c"]}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["\u9664",(0,l.jsx)(n.code,{children:"CharField"}),"/",(0,l.jsx)(n.code,{children:"TextField"}),"\u5916\u7684\u5b57\u6bb5"]}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.code,{children:"null=True"}),"\uff08\u6570\u636e\u5e93\u53ef\u7a7a\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"help_text"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"str"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.strong,{children:"\u5e2e\u52a9\u6587\u672c"}),"\uff08\u5728\u8868\u5355\u4e2d\u663e\u793a\u63d0\u793a\u4fe1\u606f\uff09"]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u6240\u6709\u5b57\u6bb5"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:'help_text="\u8bf7\u8f93\u5165\u60a8\u7684\u90ae\u7bb1\u5730\u5740"'})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"default"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"any"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.strong,{children:"\u9ed8\u8ba4\u503c"}),"\uff08\u521b\u5efa\u8bb0\u5f55\u65f6\u7684\u521d\u59cb\u503c\uff09"]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"\u6240\u6709\u5b57\u6bb5"}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.code,{children:"default=0"}),", ",(0,l.jsx)(n.code,{children:'default=""'})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"choices"})})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"list"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.strong,{children:"\u679a\u4e3e\u9009\u9879"}),"\uff08\u9650\u5236\u5b57\u6bb5\u53ef\u9009\u503c\u8303\u56f4\uff09"]}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.code,{children:"CharField"}),", ",(0,l.jsx)(n.code,{children:"IntegerField"}),"\u7b49"]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"choices=GENDER_CHOICES"})})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"312-\u91cd\u70b9\u53c2\u6570\u8be6\u89e3",children:"3.1.2 \u91cd\u70b9\u53c2\u6570\u8be6\u89e3"}),"\n",(0,l.jsxs)(n.h3,{id:"blank-vs-null-\u533a\u522b",children:[(0,l.jsx)(n.code,{children:"blank"})," vs ",(0,l.jsx)(n.code,{children:"null"})," \u533a\u522b"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"blank=True"})}),"\uff1a\u8868\u5355\u9a8c\u8bc1\u65f6\u5141\u8bb8\u4e3a\u7a7a\uff08\u524d\u7aef\u53ef\u9009\uff09\u3002\u5982\u679c\u4f60\u4e0d\u586b\u5199\uff0cDjango \u4f1a\u5b58\u50a8\u4e00\u4e2a",(0,l.jsx)(n.strong,{children:"\u7a7a\u5b57\u7b26\u4e32"})," (",(0,l.jsx)(n.code,{children:"''"}),")\uff0c\u800c\u4e0d\u662f ",(0,l.jsx)(n.code,{children:"NULL"}),"\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"null=True"})}),"\uff1a\u6570\u636e\u5e93\u5141\u8bb8\u5b58\u50a8",(0,l.jsx)(n.code,{children:"NULL"}),"\u503c\uff08\u6570\u636e\u5e93\u53ef\u7a7a\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u6700\u4f73\u5b9e\u8df5"}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5bf9\u4e8e",(0,l.jsx)(n.code,{children:"CharField"}),"/",(0,l.jsx)(n.code,{children:"TextField"}),"\uff1a\u901a\u5e38\u53ea\u8bbe\u7f6e",(0,l.jsx)(n.code,{children:"blank=True"}),"\uff08\u5b58\u50a8\u7a7a\u5b57\u7b26\u4e32\u800c\u975e",(0,l.jsx)(n.code,{children:"NULL"}),"\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:["\u540c\u65f6\u8bbe\u7f6e ",(0,l.jsx)(n.code,{children:"blank=True"})," \u548c ",(0,l.jsx)(n.code,{children:"null=True"})," (\u5bf9\u4e8e\u975e\u5b57\u7b26\u4e32\u5b57\u6bb5\u6216 ",(0,l.jsx)(n.code,{children:"ForeignKey"}),")\u3002\u8868\u793a\u4e00\u4e2a\u201c\u672a\u77e5\u201d\u6216\u201c\u672a\u8bbe\u7f6e\u201d\u7684\u72b6\u6001\uff0c\u5e76\u4e14\u8be5\u72b6\u6001\u4e0d\u662f\u7a7a\u5b57\u7b26\u4e32\u65f6\uff0c\u4f7f\u7528\u8fd9\u4e2a\u7ec4\u5408"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"datetimefield-\u65f6\u95f4\u53c2\u6570",children:[(0,l.jsx)(n.code,{children:"DateTimeField"})," \u65f6\u95f4\u53c2\u6570"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"auto_now_add=True"})}),"\uff1a\u53ea\u5728",(0,l.jsx)(n.strong,{children:"\u521b\u5efa\u65f6"}),"\u81ea\u52a8\u8bbe\u7f6e\u4e3a\u5f53\u524d\u65f6\u95f4"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"auto_now=True"})}),"\uff1a\u6bcf\u6b21",(0,l.jsx)(n.strong,{children:"\u4fdd\u5b58\u65f6"}),"\u81ea\u52a8\u66f4\u65b0\u4e3a\u5f53\u524d\u65f6\u95f4"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u6ce8\u610f"}),"\uff1a\u4e24\u8005\u4e92\u65a5\uff0c\u901a\u5e38\u7528\u4e8e",(0,l.jsx)(n.code,{children:"created_at"}),"\u548c",(0,l.jsx)(n.code,{children:"updated_at"}),"\u5b57\u6bb5"]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"foreignkey-\u5916\u952e\u53c2\u6570",children:[(0,l.jsx)(n.code,{children:"ForeignKey"})," \u5916\u952e\u53c2\u6570"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"on_delete"})}),"\uff08\u5fc5\u586b\uff09\uff1a\u5220\u9664\u5173\u8054\u5bf9\u8c61\u65f6\u7684\u884c\u4e3a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"CASCADE"}),"\uff1a\u7ea7\u8054\u5220\u9664"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"PROTECT"}),"\uff1a\u4fdd\u62a4\u6a21\u5f0f\uff08\u963b\u6b62\u5220\u9664\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SET_NULL"}),"\uff1a\u8bbe\u7f6e\u4e3a",(0,l.jsx)(n.code,{children:"NULL"}),"\uff08\u9700\u8bbe\u7f6e",(0,l.jsx)(n.code,{children:"null=True"}),"\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SET_DEFAULT"}),"\uff1a\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u503c"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"related_name"})}),"\uff1a\u53cd\u5411\u67e5\u8be2\u540d\u79f0","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"# \u5b9a\u4e49\nauthor = ForeignKey(User, on_delete=models.CASCADE, related_name='articles')\n\n# \u4f7f\u7528\uff1a\u901a\u8fc7\u7528\u6237\u83b7\u53d6\u6240\u6709\u6587\u7ae0\nuser.articles.all()\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"choices-\u679a\u4e3e\u5b57\u6bb5\u7528\u6cd5",children:[(0,l.jsx)(n.code,{children:"choices"})," \u679a\u4e3e\u5b57\u6bb5\u7528\u6cd5"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"class Article(models.Model):\n    STATUS_CHOICES = [\n        ('draft', '\u8349\u7a3f'),\n        ('published', '\u5df2\u53d1\u5e03'),\n        ('archived', '\u5df2\u5f52\u6863'),\n    ]\n    \n    status = CharField(max_length=10, choices=STATUS_CHOICES, default='draft')\n\n# \u6a21\u677f\u4e2d\u4f7f\u7528 get_xxx_display() \u83b7\u53d6\u663e\u793a\u503c\n# {{ article.get_status_display }}\n"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528\u5efa\u8bae"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u5b57\u7b26\u4e32\u5b57\u6bb5"}),"\u4f18\u5148\u4f7f\u7528",(0,l.jsx)(n.code,{children:"CharField"}),"\uff0c\u5927\u6bb5\u6587\u672c\u4f7f\u7528",(0,l.jsx)(n.code,{children:"TextField"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u5916\u952e\u5b57\u6bb5"}),"\u5fc5\u987b\u6307\u5b9a",(0,l.jsx)(n.code,{children:"on_delete"}),"\u53c2\u6570"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u65f6\u95f4\u5b57\u6bb5"}),"\u5408\u7406\u4f7f\u7528",(0,l.jsx)(n.code,{children:"auto_now_add"}),"\u548c",(0,l.jsx)(n.code,{children:"auto_now"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u679a\u4e3e\u5b57\u6bb5"}),"\u4f7f\u7528",(0,l.jsx)(n.code,{children:"choices"}),"\u63d0\u9ad8\u6570\u636e\u4e00\u81f4\u6027"]}),"\n",(0,l.jsxs)(n.li,{children:["\u59cb\u7ec8\u4e3a\u5b57\u6bb5\u8bbe\u7f6e\u6070\u5f53\u7684",(0,l.jsx)(n.code,{children:"verbose_name"}),"\u548c",(0,l.jsx)(n.code,{children:"help_text"}),"\u63d0\u5347\u53ef\u7ef4\u62a4\u6027"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"32-demo-\u793a\u4f8b",children:"3.2 Demo \u793a\u4f8b"}),"\n",(0,l.jsx)(n.p,{children:"\u5728 Demo \u4e2d\uff0c\u6211\u4eec\u8bbe\u8ba1\u4e09\u4e2a\u8868\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u7528\u6237 UserDemo"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u9879\u76ee ProjectDemo"}),"\uff08\u591a\u5bf9\u4e00 \u2192 \u7528\u6237\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u4efb\u52a1 TaskDemo"}),"\uff08\u591a\u5bf9\u4e00 \u2192 \u9879\u76ee\uff0c\u591a\u5bf9\u591a \u2192 \u7528\u6237\uff09"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'# demo/models.py\nfrom django.db import models\n\n# \u7528\u6237\u8868\nclass UserDemo(models.Model):\n    name = models.CharField(max_length=50)\n\n    def __str__(self):\n        return self.name\n\n# \u9879\u76ee\u8868\uff08\u591a\u5bf9\u4e00\uff1a\u4e00\u4e2a\u9879\u76ee\u5c5e\u4e8e\u4e00\u4e2a\u7528\u6237\uff09\nclass ProjectDemo(models.Model):\n    name = models.CharField(max_length=100)\n    owner = models.ForeignKey(UserDemo, on_delete=models.CASCADE, related_name="projects")\n\n    def __str__(self):\n        return self.name\n\n# \u4efb\u52a1\u8868\uff08\u591a\u5bf9\u591a\uff1a\u4e00\u4e2a\u4efb\u52a1\u53ef\u4ee5\u5173\u8054\u591a\u4e2a\u7528\u6237\uff09\nclass TaskDemo(models.Model):\n    title = models.CharField(max_length=100)\n    project = models.ForeignKey(ProjectDemo, on_delete=models.CASCADE, related_name="tasks")\n    assignees = models.ManyToManyField(UserDemo, related_name="tasks")\n\n    def __str__(self):\n        return self.title\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u8fc1\u79fb\u6570\u636e\u5e93\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"python manage.py makemigrations\npython manage.py migrate\n"})}),"\n",(0,l.jsx)(n.h2,{id:"4-\u5e8f\u5217\u5316\u5668",children:"4. \u5e8f\u5217\u5316\u5668"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'# demo/serializers.py\nfrom rest_framework import serializers\nfrom .models import UserDemo, ProjectDemo, TaskDemo\n\n# \u7528\u6237\u5e8f\u5217\u5316\nclass UserDemoSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = UserDemo\n        fields = ["id", "name"]\n\n# \u9879\u76ee\u5e8f\u5217\u5316\uff08\u591a\u5bf9\u4e00 + \u4e00\u5bf9\u591a\uff09\nclass ProjectDemoSerializer(serializers.ModelSerializer):\n    owner_name = serializers.CharField(source="owner.name", read_only=True)\n    tasks = serializers.StringRelatedField(many=True, read_only=True)  # \u4e00\u5bf9\u591a\u5c55\u793a\u4efb\u52a1\n\n    class Meta:\n        model = ProjectDemo\n        fields = ["id", "name", "owner", "owner_name", "tasks"]\n\n# \u4efb\u52a1\u5e8f\u5217\u5316\uff08\u591a\u5bf9\u591a + \u5916\u952e\uff09\nclass TaskDemoSerializer(serializers.ModelSerializer):\n    project_name = serializers.CharField(source="project.name", read_only=True)\n    assignees_detail = UserDemoSerializer(source="assignees", many=True, read_only=True)\n    another_name = serializers.CharField(source=\'title\', read_only=True, help_text="\u6f14\u793a\u5b57\u6bb5\u91cd\u547d\u540d")\n\n    class Meta:\n        model = TaskDemo\n        fields = ["id", "title", "project", "project_name","another_name", "assignees", "assignees_detail"]\n        read_only_fields = ["id"] # \n'})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u5e8f\u5217\u5316\uff08\u8f93\u51fa\uff0c\u5982 GET \u8bf7\u6c42\uff09"}),"\uff1a read_only\u5b57\u6bb5\u4f1a",(0,l.jsx)(n.strong,{children:"\u6b63\u5e38\u663e\u793a"}),"\u5728\u8f93\u51fa\u7684 JSON \u6570\u636e\u4e2d\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u53cd\u5e8f\u5217\u5316\uff08\u8f93\u5165\uff0c\u5982 POST/PUT/PATCH \u8bf7\u6c42\uff09"}),"\uff1a\u8fd9\u4e9b\u5b57\u6bb5\u4f1a",(0,l.jsx)(n.strong,{children:"\u88ab\u5ffd\u7565"})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u5bf9\u4e8e",(0,l.jsx)(n.strong,{children:"\u6a21\u578b\u672c\u8eab\u5b58\u5728\u7684\u5b57\u6bb5"}),"\uff08\u5982 ",(0,l.jsx)(n.code,{children:"id"}),", \uff09\uff0c\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"Meta.read_only_fields"})," \u6765\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\u66f4\u52a0\u7b80\u6d01\u3002\u5bf9\u4e8e\u4f60",(0,l.jsx)(n.strong,{children:"\u81ea\u5df1\u6dfb\u52a0\u7684\u3001\u6a21\u578b\u4e2d\u4e0d\u5b58\u5728\u7684\u5e8f\u5217\u5316\u5668\u5b57\u6bb5"}),"\uff08\u5982 ",(0,l.jsx)(n.code,{children:"project_name"}),", ",(0,l.jsx)(n.code,{children:"assignees_detail"}),"\uff09\uff0c\u4f60\u5fc5\u987b\u5728\u58f0\u660e\u8be5\u5b57\u6bb5\u65f6\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"read_only=True"}),"\uff0c\u56e0\u4e3a\u5b83\u4eec\u5bf9\u5e8f\u5217\u5316\u5668\u6765\u8bf4\u662f\u201c\u65b0\u201d\u7684\uff0c",(0,l.jsx)(n.code,{children:"read_only_fields"})," \u5217\u8868\u4e0d\u8ba4\u8bc6\u5b83\u4eec\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"5-\u89c6\u56fe--\u8def\u7531",children:"5. \u89c6\u56fe & \u8def\u7531"}),"\n",(0,l.jsx)(n.h3,{id:"51-\u89c6\u56fe",children:"5.1 \u89c6\u56fe"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"# demo/views.py\nfrom rest_framework import viewsets\nfrom .models import UserDemo, ProjectDemo, TaskDemo\nfrom .serializers import UserDemoSerializer, ProjectDemoSerializer, TaskDemoSerializer\n\nclass UserDemoViewSet(viewsets.ModelViewSet):\n    queryset = UserDemo.objects.all()\n    serializer_class = UserDemoSerializer\n\nclass ProjectDemoViewSet(viewsets.ModelViewSet):\n    queryset = ProjectDemo.objects.all()\n    serializer_class = ProjectDemoSerializer\n\nclass TaskDemoViewSet(viewsets.ModelViewSet):\n    queryset = TaskDemo.objects.all()\n    serializer_class = TaskDemoSerializer\n"})}),"\n",(0,l.jsx)(n.h3,{id:"52-\u8def\u7531",children:"5.2 \u8def\u7531"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"# myproject/urls.py \nfrom django.contrib import admin\nfrom django.urls import path, include\nfrom rest_framework.routers import DefaultRouter\nfrom demo.views import UserDemoViewSet, ProjectDemoViewSet, TaskDemoViewSet\n\nrouter = DefaultRouter()\nrouter.register(r'users', UserDemoViewSet)\nrouter.register(r'projects', ProjectDemoViewSet)\nrouter.register(r'tasks', TaskDemoViewSet)\n\nurlpatterns = [\n    path('admin/', admin.site.urls),\n    path('api/', include(router.urls)),\n]\n"})}),"\n",(0,l.jsx)(n.h2,{id:"6-api-\u793a\u4f8b\u6548\u679c",children:"6. API \u793a\u4f8b\u6548\u679c"}),"\n",(0,l.jsx)(n.h3,{id:"61-\u521b\u5efa\u7528\u6237",children:"6.1 \u521b\u5efa\u7528\u6237"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-http",children:'POST /api/users/\n{\n  "name": "Alice"\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "id": 1,\n  "name": "Alice"\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"62-\u521b\u5efa\u9879\u76ee\u591a\u5bf9\u4e00",children:"6.2 \u521b\u5efa\u9879\u76ee\uff08\u591a\u5bf9\u4e00\uff09"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-http",children:'POST /api/projects/\n{\n  "name": "Demo Project",\n  "owner": 1\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "id": 1,\n  "name": "Demo Project",\n  "owner": 1,\n  "owner_name": "Alice",\n  "tasks": []\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"63-\u521b\u5efa\u4efb\u52a1\u591a\u5bf9\u591a--\u5916\u952e",children:"6.3 \u521b\u5efa\u4efb\u52a1\uff08\u591a\u5bf9\u591a + \u5916\u952e\uff09"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-http",children:'POST /api/tasks/\n{\n  "title": "First Task",\n  "project": 1,\n  "assignees": [1]\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "id": 1,\n  "title": "First Task",\n  "project": 1,\n  "project_name": "Demo Project",\n  "assignees": [1],\n  "assignees_detail": [\n    {"id": 1, "name": "Alice"}\n  ]\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"64-\u67e5\u8be2\u9879\u76ee\u4e00\u5bf9\u591a",children:"6.4 \u67e5\u8be2\u9879\u76ee\uff08\u4e00\u5bf9\u591a\uff09"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-http",children:"GET /api/projects/1/\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "id": 1,\n  "name": "Demo Project",\n  "owner": 1,\n  "owner_name": "Alice",\n  "tasks": ["First Task"]\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"7-\u8fdb\u9636\u7528\u6cd5",children:"7. \u8fdb\u9636\u7528\u6cd5"}),"\n",(0,l.jsx)(n.h3,{id:"71-\u5206\u9875\u5b9a\u5236",children:"7.1 \u5206\u9875\u5b9a\u5236"}),"\n",(0,l.jsx)(n.h4,{id:"711-\u9ed8\u8ba4\u5206\u9875",children:"7.1.1 \u9ed8\u8ba4\u5206\u9875"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"REST_FRAMEWORK = {\n    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',\n    'PAGE_SIZE': 10\n}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"712-\u81ea\u5b9a\u4e49\u5206\u9875",children:"7.1.2 \u81ea\u5b9a\u4e49\u5206\u9875"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'demo/pagination.py\nfrom rest_framework.pagination import PageNumberPagination\nfrom rest_framework.response import Response\n\nclass CustomPageNumberPagination(PageNumberPagination):\n    page_size = 5\n    page_query_param = "current"\n    page_size_query_param = \'page_size\'\n    max_page_size = 100\n\n    def get_paginated_response(self, data):\n        return Response({\n            "code": 0,\n            "message": "success",\n            "data": {\n                "total": self.page.paginator.count,\n                "page": self.page.number,\n                "page_size": self.page_size,\n                "list": data\n            }\n        })\n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u5728 ",(0,l.jsx)(n.code,{children:"settings.py"})," \u914d\u7f6e\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"REST_FRAMEWORK = {\n    'DEFAULT_PAGINATION_CLASS': 'demo.pagination.CustomPageNumberPagination',\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"72-\u81ea\u5b9a\u4e49\u7edf\u4e00\u54cd\u5e94\u7ed3\u6784",children:"7.2 \u81ea\u5b9a\u4e49\u7edf\u4e00\u54cd\u5e94\u7ed3\u6784"}),"\n",(0,l.jsx)(n.h4,{id:"721-\u81ea\u5b9a\u4e49-response-\u5c01\u88c5",children:"7.2.1 \u81ea\u5b9a\u4e49 Response \u5c01\u88c5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'demo/utils/response.py\nfrom rest_framework.response import Response\n\ndef success_response(data=None, message="success", code=0):\n    return Response({\n        "code": code,\n        "message": message,\n        "data": data\n    })\n\ndef error_response(message="error", code=1):\n    return Response({\n        "code": code,\n        "message": message,\n        "data": None\n    })\n'})}),"\n",(0,l.jsx)(n.h4,{id:"722-\u5168\u5c40\u7edf\u4e00renderer",children:"7.2.2 \u5168\u5c40\u7edf\u4e00\uff08Renderer\uff09"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'demo/utils/renderer.py\nfrom rest_framework.renderers import JSONRenderer\n\nclass CustomJSONRenderer(JSONRenderer):\n    def render(self, data, accepted_media_type=None, renderer_context=None):\n        response = renderer_context["response"]\n        if response.status_code >= 400:\n            return super().render({\n                "code": response.status_code,\n                "message": data.get("detail", "error"),\n                "data": None\n            }, accepted_media_type, renderer_context)\n\n        return super().render({\n            "code": 0,\n            "message": "success",\n            "data": data\n        }, accepted_media_type, renderer_context)\nsettings.py\nREST_FRAMEWORK = {\n    \'DEFAULT_RENDERER_CLASSES\': [\'demo.utils.renderer.CustomJSONRenderer\'],\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"API \u8fd4\u56de\u7ed3\u679c\u5c06\u7edf\u4e00\u4e3a\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "code": 0,\n  "message": "success",\n  "data": {...}\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"73-\u81ea\u52a8\u751f\u6210-api-\u6587\u6863",children:"7.3 \u81ea\u52a8\u751f\u6210 API \u6587\u6863"}),"\n",(0,l.jsxs)(n.p,{children:["\u5728\u4f01\u4e1a\u5f00\u53d1\u4e2d\uff0c",(0,l.jsx)(n.strong,{children:"API \u6587\u6863\u7684\u81ea\u52a8\u751f\u6210"})," \u662f\u540e\u7aef\u5f00\u53d1\u5fc5\u5907\u80fd\u529b\u3002\u6211\u4eec\u63a8\u8350\u4e24\u79cd\u65b9\u5f0f\uff1a"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"drf-yasg"}),"\uff1a\u6210\u719f\u3001\u5e38\u7528\uff0cSwagger UI / ReDoc \u652f\u6301\u597d\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"drf-spectacular"}),"\uff1a\u57fa\u4e8e OpenAPI 3 \u6807\u51c6\uff0c\u66f4\u73b0\u4ee3\uff0c\u63a8\u8350\u65b0\u9879\u76ee\u4f7f\u7528\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"731-drf-yasg-\u65b9\u5f0f",children:"7.3.1 drf-yasg \u65b9\u5f0f"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5b89\u88c5"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pip install drf-yasg\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u914d\u7f6e"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"# settings.py\nINSTALLED_APPS = [\n    ...\n    'drf_yasg',\n    ...,\n]\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u914d\u7f6e\u8def\u7531"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5728 ",(0,l.jsx)(n.code,{children:"myproject/urls.py"})," \u589e\u52a0\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from django.contrib import admin\nfrom django.urls import path, include\nfrom rest_framework import permissions\nfrom drf_yasg.views import get_schema_view\nfrom drf_yasg import openapi\nfrom demo.views import UserDemoViewSet, ProjectDemoViewSet, TaskDemoViewSet\nfrom rest_framework.routers import DefaultRouter\n\n# API \u8def\u7531\nrouter = DefaultRouter()\nrouter.register(r'users', UserDemoViewSet)\nrouter.register(r'projects', ProjectDemoViewSet)\nrouter.register(r'tasks', TaskDemoViewSet)\n\n# Swagger \u914d\u7f6e\nschema_view = get_schema_view(\n    openapi.Info(\n        title=\"Demo API\",\n        default_version=\"v1\",\n        description=\"Django + DRF Demo \u9879\u76ee API \u6587\u6863\",\n        contact=openapi.Contact(email=\"dev@example.com\"),\n    ),\n    public=True,\n    permission_classes=[permissions.AllowAny],\n)\n\nurlpatterns = [\n    path('admin/', admin.site.urls),\n    path('api/', include(router.urls)),\n\n    # Swagger & ReDoc\n    path('swagger/', schema_view.with_ui('swagger', cache_timeout=0), name=\"schema-swagger-ui\"),\n    path('redoc/', schema_view.with_ui('redoc', cache_timeout=0), name=\"schema-redoc\"),\n]\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u6548\u679c"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Swagger UI: ",(0,l.jsx)(n.code,{children:"http://127.0.0.1:8000/swagger/"})]}),"\n",(0,l.jsxs)(n.li,{children:["ReDoc: ",(0,l.jsx)(n.code,{children:"http://127.0.0.1:8000/redoc/"})]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["API \u4f1a\u6839\u636e ",(0,l.jsx)(n.strong,{children:"ViewSet + Serializer"})," \u81ea\u52a8\u751f\u6210\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"732-drf-spectacular-\u65b9\u5f0f\u63a8\u8350",children:"7.3.2 drf-spectacular \u65b9\u5f0f\uff08\u63a8\u8350\uff09"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5b89\u88c5"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pip install drf-spectacular\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u914d\u7f6e"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"# settings.py\nREST_FRAMEWORK = {\n    'DEFAULT_SCHEMA_CLASS': 'drf_spectacular.openapi.AutoSchema',\n}\n\nSPECTACULAR_SETTINGS = {\n    'TITLE': 'Demo API',\n    'DESCRIPTION': 'Django + DRF Demo \u9879\u76ee API \u6587\u6863',\n    'VERSION': '1.0.0',\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u8def\u7531"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"myproject/urls.py\nfrom django.urls import path, include\nfrom rest_framework.routers import DefaultRouter\nfrom demo.views import UserDemoViewSet, ProjectDemoViewSet, TaskDemoViewSet\nfrom drf_spectacular.views import SpectacularAPIView, SpectacularRedocView, SpectacularSwaggerView\n\nrouter = DefaultRouter()\nrouter.register(r'users', UserDemoViewSet)\nrouter.register(r'projects', ProjectDemoViewSet)\nrouter.register(r'tasks', TaskDemoViewSet)\n\nurlpatterns = [\n    path('api/', include(router.urls)),\n\n    # OpenAPI schema\n    path('api/schema/', SpectacularAPIView.as_view(), name='schema'),\n    path('api/schema/swagger-ui/', SpectacularSwaggerView.as_view(url_name='schema'), name='swagger-ui'),\n    path('api/schema/redoc/', SpectacularRedocView.as_view(url_name='schema'), name='redoc'),\n]\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u6548\u679c"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["OpenAPI JSON: ",(0,l.jsx)(n.code,{children:"http://127.0.0.1:8000/api/schema/"})]}),"\n",(0,l.jsxs)(n.li,{children:["Swagger UI: ",(0,l.jsx)(n.code,{children:"http://127.0.0.1:8000/api/schema/swagger-ui/"})]}),"\n",(0,l.jsxs)(n.li,{children:["ReDoc: ",(0,l.jsx)(n.code,{children:"http://127.0.0.1:8000/api/schema/redoc/"})]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7ed9 ViewSet \u52a0\u6ce8\u91ca"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u53c2\u6570"}),"\uff1a\u7528 ",(0,l.jsx)(n.code,{children:"OpenApiParameter"}),"\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u8bf7\u6c42\u4f53"}),"\uff1a\u7528 ",(0,l.jsx)(n.code,{children:"request=Serializer"}),"\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u54cd\u5e94\u4f53"}),"\uff1a\u7528 ",(0,l.jsx)(n.code,{children:"responses={code: Serializer}"})," \u6216 ",(0,l.jsx)(n.code,{children:"OpenApiResponse"}),"\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u6279\u91cf\u6ce8\u91ca"}),"\uff1a ",(0,l.jsx)(n.code,{children:"@extend_schema_view"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u6279\u91cf\u65b9\u5f0f\u793a\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from django.shortcuts import render\nfrom .models import UserDemo, ProjectDemo, TaskDemo\nfrom .serializers import UserDemoSerializer, ProjectDemoSerializer, TaskDemoSerializer\nfrom rest_framework import viewsets\n\n# \u7528\u4e8e\u751f\u6210OpenAPI schema\nfrom drf_spectacular.utils import extend_schema, extend_schema_view, OpenApiParameter, OpenApiResponse\n\n\n@extend_schema_view(\n    list=extend_schema(\n        summary="\u83b7\u53d6\u7528\u6237\u5217\u8868",\n        parameters=[\n            OpenApiParameter(name="q", description="\u641c\u7d22\u5173\u952e\u5b57", required=False, type=str),\n        ],\n        responses={200: UserDemoSerializer(many=True)},\n    ),     \n    retrieve=extend_schema(\n        summary="\u83b7\u53d6\u5355\u4e2a\u7528\u6237",\n        responses={\n            200: OpenApiResponse(UserDemoSerializer, description="\u6210\u529f\u8fd4\u56de\u7528\u6237"),\n            404: OpenApiResponse(description="\u7528\u6237\u4e0d\u5b58\u5728"),\n        },\n    ),\n    create=extend_schema(\n        summary="\u521b\u5efa\u65b0\u7528\u6237",\n        request=UserDemoSerializer,\n        responses={201: UserDemoSerializer},\n    ),    update=extend_schema(summary="\u66f4\u65b0\u7528\u6237"),\n    destroy=extend_schema(summary="\u5220\u9664\u7528\u6237"),\n)\n\n\nclass UserDemoViewSet(viewsets.ModelViewSet):\n    queryset = UserDemo.objects.all()\n    serializer_class = UserDemoSerializer\n'})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u5355\u72ec\u7684action\u793a\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from django.shortcuts import render\nfrom .models import UserDemo, ProjectDemo, TaskDemo\nfrom .serializers import UserDemoSerializer, ProjectDemoSerializer, TaskDemoSerializer\nfrom rest_framework import viewsets\n\n# \u7528\u4e8e\u751f\u6210OpenAPI schema\nfrom drf_spectacular.utils import extend_schema, OpenApiExample, OpenApiParameter, OpenApiResponse\n\nclass UserDemoViewSet(viewsets.ModelViewSet):\n    queryset = UserDemo.objects.all()\n    serializer_class = UserDemoSerializer\n    @extend_schema(\n        parameters=[\n            OpenApiParameter(name="active", description="\u662f\u5426\u6fc0\u6d3b\u7528\u6237", required=False, type=bool),\n        ],\n        responses={200: UserDemoSerializer(many=True)},\n    )\n    def list(self, request, *args, **kwargs):\n        return super().list(request, *args, **kwargs)\n\n    @extend_schema(\n    responses={\n        200: OpenApiResponse(\n            response=UserDemoSerializer,\n            description="\u6210\u529f\u8fd4\u56de",\n            examples=[\n                OpenApiExample(\n                    "\u793a\u4f8b\u7528\u6237",\n                    value={"id": 1, "username": "alice", "email": "alice@example.com"},\n                )\n            ],\n        )\n    }\n)\n    def retrieve(self, request, *args, **kwargs):\n        return super().retrieve(request, *args, **kwargs)\n'})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"74-\u8fc7\u6ee4\u548c\u641c\u7d22",children:"7.4 \u8fc7\u6ee4\u548c\u641c\u7d22"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5b89\u88c5"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pip install django-filter\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u914d\u7f6e"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"# settings.py\nINSTALLED_APPS += ['django_filters']\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u4f7f\u7528"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"class UserDemoViewSet(viewsets.ModelViewSet):\n    queryset = UserDemo.objects.all()\n    serializer_class = UserDemoSerializer\n    filter_backends = [filters.SearchFilter, filters.OrderingFilter]\n    search_fields = ['name']\n    ordering_fields = ['name']\n"})}),"\n",(0,l.jsx)(n.h3,{id:"75-\u8ba4\u8bc1\u548c\u6743\u9650",children:"7.5 \u8ba4\u8bc1\u548c\u6743\u9650"}),"\n",(0,l.jsx)(n.h4,{id:"751-\u5e38\u89c1\u8ba4\u8bc1\u65b9\u5f0f",children:"7.5.1 \u5e38\u89c1\u8ba4\u8bc1\u65b9\u5f0f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"SessionAuthentication\uff08\u9002\u5408\u540e\u53f0\u7ba1\u7406\uff09"}),"\n",(0,l.jsx)(n.li,{children:"TokenAuthentication\uff08\u9002\u5408\u79fb\u52a8\u7aef / API\uff09"}),"\n",(0,l.jsx)(n.li,{children:"JWT Authentication\uff08\u63a8\u8350\uff0c\u5b89\u5168\u6027\u66f4\u9ad8\uff09"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u5b89\u88c5 JWT\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pip install djangorestframework-simplejwt\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u914d\u7f6e\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'# settings.py\nREST_FRAMEWORK = {\n    "DEFAULT_AUTHENTICATION_CLASSES": (\n        "rest_framework_simplejwt.authentication.JWTAuthentication",\n    ),\n    "DEFAULT_PERMISSION_CLASSES": (\n        "rest_framework.permissions.IsAuthenticated",\n    ),\n    "DEFAULT_SCHEMA_CLASS": "drf_spectacular.openapi.AutoSchema",  # \u5982\u679c\u4f7f\u7528 drf-spectacular\n}\n\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'# urls.py\nfrom django.urls import path, include\nfrom rest_framework_simplejwt.views import (\n    TokenObtainPairView,\n    TokenRefreshView,\n)\nfrom rest_framework.routers import DefaultRouter\nfrom demo.views import UserDemoViewSet, ProjectDemoViewSet, TaskDemoViewSet\n\nrouter = DefaultRouter()\nrouter.register(r\'users\', UserDemoViewSet)\nrouter.register(r\'projects\', ProjectDemoViewSet)\nrouter.register(r\'tasks\', TaskDemoViewSet)\n\nurlpatterns = [\n    path("api/", include(router.urls)),\n\n    # JWT Token \u83b7\u53d6 & \u5237\u65b0\n    path("api/token/", TokenObtainPairView.as_view(), name="token_obtain_pair"),\n    path("api/token/refresh/", TokenRefreshView.as_view(), name="token_refresh"),\n]\n\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u83b7\u53d6 Token\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-http",children:'POST /api/token/\n{\n  "username": "admin",\n  "password": "123456"\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"752-\u6743\u9650\u63a7\u5236",children:"7.5.2 \u6743\u9650\u63a7\u5236"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"# views.py\nfrom rest_framework.permissions import IsAuthenticated\n\nclass BookViewSet(viewsets.ModelViewSet):\n    ...\n    permission_classes = [IsAuthenticated]\n"})}),"\n",(0,l.jsx)(n.h3,{id:"76-middleware",children:"7.6 Middleware"}),"\n",(0,l.jsx)(n.h4,{id:"761-\u7b80\u4ecb",children:"7.6.1 \u7b80\u4ecb"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Middleware"}),"\uff08\u4e2d\u95f4\u4ef6\uff09\u662f Django \u5728 ",(0,l.jsx)(n.strong,{children:"\u8bf7\u6c42\u548c\u54cd\u5e94\u5904\u7406\u6d41\u7a0b"})," \u4e2d\u95f4\u63d2\u5165\u7684\u94a9\u5b50\u51fd\u6570\u3002"]}),"\n",(0,l.jsx)(n.li,{children:"\u6bcf\u4e2a\u8bf7\u6c42\u5230\u8fbe\u89c6\u56fe\u524d\u3001\u6bcf\u4e2a\u54cd\u5e94\u8fd4\u56de\u5ba2\u6237\u7aef\u524d\uff0c\u90fd\u4f1a\u7ecf\u8fc7\u4e2d\u95f4\u4ef6\u3002"}),"\n",(0,l.jsxs)(n.li,{children:["\u5e38\u89c1\u7528\u9014\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8ba4\u8bc1\u4e0e\u6743\u9650\u68c0\u67e5"}),"\n",(0,l.jsx)(n.li,{children:"\u8bf7\u6c42\u65e5\u5fd7"}),"\n",(0,l.jsx)(n.li,{children:"\u6027\u80fd\u76d1\u63a7\uff08\u8017\u65f6\u7edf\u8ba1\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u5f02\u5e38\u5904\u7406"}),"\n",(0,l.jsx)(n.li,{children:"CORS \u5904\u7406"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"762-middleware-\u751f\u547d\u5468\u671f",children:"7.6.2 Middleware \u751f\u547d\u5468\u671f"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u8bf7\u6c42\u9636\u6bb5"}),"\uff1a",(0,l.jsx)(n.code,{children:"__call__"})," \u2192 ",(0,l.jsx)(n.code,{children:"process_view"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u89c6\u56fe\u5904\u7406"}),"\uff1a\u6267\u884c View"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u54cd\u5e94\u9636\u6bb5"}),"\uff1a",(0,l.jsx)(n.code,{children:"process_exception"}),"\uff08\u5982\u6709\u5f02\u5e38\uff09\u2192 ",(0,l.jsx)(n.code,{children:"process_template_response"})," \u2192 \u8fd4\u56de Response"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"763-\u81ea\u5b9a\u4e49-middleware-\u793a\u4f8b",children:"7.6.3 \u81ea\u5b9a\u4e49 Middleware \u793a\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'import time\nfrom django.utils.deprecation import MiddlewareMixin\n\nclass RequestLogMiddleware(MiddlewareMixin):\n    #  \u65e7\u5199\u6cd5\n    # def process_request(self, request):\n    #     request.start_time = time.time()\n    #     print(f"\u8bf7\u6c42\u5f00\u59cb: {request.method} {request.path}")\n\n    # def process_response(self, request, response):\n    #     duration = time.time() - getattr(request, \'start_time\', time.time())\n    #     print(f"\u8bf7\u6c42\u7ed3\u675f: {request.method} {request.path} \u7528\u65f6 {duration:.2f}s")\n    #     return response\n\n    # \u65b0\u5199\u6cd5\n    def __init__(self, get_response):\n        self.get_response = get_response\n        print("RequestLogMiddleware __init__") # \u670d\u52a1\u542f\u52a8\u65f6\u6253\u5370\u4e00\u6b21\n        # \u4e00\u6b21\u6027\u914d\u7f6e\u548c\u521d\u59cb\u5316\n\n    def __call__(self, request):\n        # \u5728\u6bcf\u4e2a\u8bf7\u6c42\u4e0a\u8c03\u7528\u89c6\u56fe\u4e4b\u524d\u6267\u884c\n        print(f"Processing request: {request.path}")\n        \n        # \u53ef\u4ee5\u4fee\u6539\u8bf7\u6c42\u5bf9\u8c61\n        request.custom_attribute = "custom_value"\n        \n        response = self.get_response(request)\n        \n        # \u5728\u6bcf\u4e2a\u54cd\u5e94\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u4e4b\u524d\u6267\u884c\n        print(f"Returning response for: {request.path}")\n        \n        # \u53ef\u4ee5\u4fee\u6539\u54cd\u5e94\u5bf9\u8c61\n        response[\'X-Custom-Header\'] = \'Custom Value\'\n        \n        return response\n\n    def process_view(self, request, view_func, view_args, view_kwargs):\n        # \u5728\u8c03\u7528\u89c6\u56fe\u4e4b\u524d\uff0c\u4f46\u5728URL\u89e3\u6790\u4e4b\u540e\u6267\u884c\n        print(f"About to call view: {view_func.__name__}")\n        # \u5982\u679c\u8fd4\u56de HttpResponse\uff0c\u5c06\u8df3\u8fc7\u89c6\u56fe\n        return None\n\n    def process_exception(self, request, exception):\n        # \u5f53\u89c6\u56fe\u629b\u51fa\u5f02\u5e38\u65f6\u8c03\u7528\n        print(f"Exception occurred: {exception}")\n        # \u53ef\u4ee5\u8fd4\u56de\u81ea\u5b9a\u4e49\u54cd\u5e94\n        return None\n\n    def process_template_response(self, request, response):\n        # \u5982\u679c\u54cd\u5e94\u6709 render() \u65b9\u6cd5\uff08\u5982TemplateResponse\uff09\u65f6\u8c03\u7528\n        print("Processing template response")\n        return response\n\n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u6ce8\u518c\u5230 ",(0,l.jsx)(n.code,{children:"settings.py"}),"\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"MIDDLEWARE = [\n    'django.middleware.security.SecurityMiddleware',\n    'django.contrib.sessions.middleware.SessionMiddleware',\n    ...,\n    'demo.middleware.RequestLogMiddleware',\n]\n"})}),"\n",(0,l.jsx)(n.h3,{id:"77-drf-exception-handler",children:"7.7 DRF Exception Handler"}),"\n",(0,l.jsx)(n.h4,{id:"771-\u4f5c\u7528",children:"7.7.1 \u4f5c\u7528"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["DRF \u63d0\u4f9b\u4e86\u5168\u5c40\u5f02\u5e38\u5904\u7406\u51fd\u6570 ",(0,l.jsx)(n.code,{children:"EXCEPTION_HANDLER"}),"\uff0c\u7528\u4e8e\u5c06 ",(0,l.jsx)(n.strong,{children:"Python \u5f02\u5e38 \u2192 DRF Response"}),"\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u9ed8\u8ba4\u884c\u4e3a\uff1a\u5e38\u89c1\u5f02\u5e38\uff08\u5982 ",(0,l.jsx)(n.code,{children:"ValidationError"}),", ",(0,l.jsx)(n.code,{children:"PermissionDenied"}),"\uff09\u4f1a\u8fd4\u56de JSON \u683c\u5f0f\u54cd\u5e94\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"772-\u81ea\u5b9a\u4e49-exception-handler",children:"7.7.2 \u81ea\u5b9a\u4e49 Exception Handler"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'# demo/utils/exception.py\nfrom rest_framework.views import exception_handler\nfrom rest_framework.response import Response\n\ndef custom_exception_handler(exc, context):\n    response = exception_handler(exc, context)\n\n    if response is not None:\n        return Response({\n            "code": response.status_code,\n            "message": response.data.get("detail", "error"),\n            "data": None\n        }, status=response.status_code)\n\n    # \u672a\u5904\u7406\u7684\u5f02\u5e38\n    return Response({\n        "code": 500,\n        "message": str(exc),\n        "data": None\n    }, status=500)\n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u5728 ",(0,l.jsx)(n.code,{children:"settings.py"})," \u914d\u7f6e\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"REST_FRAMEWORK = {\n    'EXCEPTION_HANDLER': 'demo.utils.exception.custom_exception_handler'\n}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"773-\u6548\u679c",children:"7.7.3 \u6548\u679c"}),"\n",(0,l.jsx)(n.p,{children:"\u8bf7\u6c42\u53c2\u6570\u9519\u8bef\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-http",children:"POST /api/users/\n{}\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "code": 400,\n  "message": "This field is required.",\n  "data": null\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u670d\u52a1\u5668\u9519\u8bef\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "code": 500,\n  "message": "division by zero",\n  "data": null\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"8-\u53c2\u8003\u8d44\u6e90",children:"8. \u53c2\u8003\u8d44\u6e90"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Django \u5b98\u65b9\u6587\u6863: ",(0,l.jsx)(n.a,{href:"https://docs.djangoproject.com/",children:"https://docs.djangoproject.com/"})]}),"\n",(0,l.jsxs)(n.li,{children:["DRF \u5b98\u65b9\u6587\u6863: ",(0,l.jsx)(n.a,{href:"https://www.django-rest-framework.org/",children:"https://www.django-rest-framework.org/"})]}),"\n",(0,l.jsxs)(n.li,{children:["JWT \u6269\u5c55: ",(0,l.jsx)(n.a,{href:"https://django-rest-framework-simplejwt.readthedocs.io/",children:"https://django-rest-framework-simplejwt.readthedocs.io/"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>d});var r=s(96540);const l={},i=r.createContext(l);function t(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);