"use strict";(self.webpackChunkweidongkl_github_io=self.webpackChunkweidongkl_github_io||[]).push([[1994],{3359:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>o,contentTitle:()=>l,default:()=>a,frontMatter:()=>c,metadata:()=>s,toc:()=>i});const s=JSON.parse('{"id":"note/golang/bcrypt","title":"Golang bcrypt","description":"1. \u6982\u8ff0","source":"@site/docs/note/golang/bcrypt.md","sourceDirName":"note/golang","slug":"/note/golang/bcrypt","permalink":"/docs/note/golang/bcrypt","draft":false,"unlisted":false,"editUrl":"https://github.com/weidongkl/weidongkl.github.io/tree/master/docs/note/golang/bcrypt.md","tags":[],"version":"current","lastUpdatedBy":"weidongkl","lastUpdatedAt":1747299794000,"frontMatter":{},"sidebar":"note","previous":{"title":"Golang \u591agoroutine\u4ea4\u4e92\u6a21\u578b","permalink":"/docs/note/golang/design/multi_goroutine"},"next":{"title":"Golang os/exec \u7528\u6cd5","permalink":"/docs/note/golang/cmd"}}');var t=r(4848),d=r(8453);const c={},l="Golang bcrypt",o={},i=[{value:"1. \u6982\u8ff0",id:"1-\u6982\u8ff0",level:2},{value:"2. \u5b89\u88c5",id:"2-\u5b89\u88c5",level:2},{value:"3. \u57fa\u672c\u7528\u6cd5",id:"3-\u57fa\u672c\u7528\u6cd5",level:2},{value:"3.1 \u751f\u6210\u54c8\u5e0c\u5bc6\u7801",id:"31-\u751f\u6210\u54c8\u5e0c\u5bc6\u7801",level:3},{value:"3.2 \u6821\u9a8c\u5bc6\u7801",id:"32-\u6821\u9a8c\u5bc6\u7801",level:3},{value:"3.3 \u4fee\u6539\u5bc6\u7801",id:"33-\u4fee\u6539\u5bc6\u7801",level:3},{value:"3.4 \u786e\u5b9a\u54c8\u5e0c\u662f\u5426\u9700\u8981\u66f4\u65b0",id:"34-\u786e\u5b9a\u54c8\u5e0c\u662f\u5426\u9700\u8981\u66f4\u65b0",level:3},{value:"4. \u9002\u7528\u573a\u666f",id:"4-\u9002\u7528\u573a\u666f",level:2},{value:"5. \u603b\u7ed3",id:"5-\u603b\u7ed3",level:2}];function h(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsxs)(e.h1,{id:"golang-bcrypt",children:["Golang ",(0,t.jsx)(e.code,{children:"bcrypt"})]})}),"\n",(0,t.jsx)(e.h2,{id:"1-\u6982\u8ff0",children:"1. \u6982\u8ff0"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"bcrypt"})," \u662f\u4e00\u79cd\u5b89\u5168\u7684\u5bc6\u7801\u54c8\u5e0c\u7b97\u6cd5\uff0c\u9002\u7528\u4e8e\u5b58\u50a8\u7528\u6237\u5bc6\u7801\uff0c\u9632\u6b62\u660e\u6587\u6cc4\u9732\u3002Golang \u63d0\u4f9b ",(0,t.jsx)(e.code,{children:"golang.org/x/crypto/bcrypt"})," \u5305\u6765\u7b80\u5316 ",(0,t.jsx)(e.code,{children:"bcrypt"})," \u7684\u4f7f\u7528\u3002"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"2-\u5b89\u88c5",children:"2. \u5b89\u88c5"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"bcrypt"})," \u5c5e\u4e8e Go \u7684\u6269\u5c55\u5e93\uff0c\u9700\u8981\u624b\u52a8\u5b89\u88c5\uff1a"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sh",children:"go get golang.org/x/crypto/bcrypt\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"3-\u57fa\u672c\u7528\u6cd5",children:"3. \u57fa\u672c\u7528\u6cd5"}),"\n",(0,t.jsx)(e.h3,{id:"31-\u751f\u6210\u54c8\u5e0c\u5bc6\u7801",children:"3.1 \u751f\u6210\u54c8\u5e0c\u5bc6\u7801"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"golang.org/x/crypto/bcrypt"\n)\n\nfunc main() {\n\tpassword := "my_secure_password"\n\n\t// \u751f\u6210 bcrypt \u54c8\u5e0c\n\thashedPassword, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)\n\tif err != nil {\n\t\tfmt.Println("Error generating hash:", err)\n\t\treturn\n\t}\n\n\tfmt.Println("Hashed Password:", string(hashedPassword))\n}\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u8bf4\u660e"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)"})," \u751f\u6210\u54c8\u5e0c\u5bc6\u7801\u3002"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"bcrypt.DefaultCost"})," \u662f\u9ed8\u8ba4\u7684\u8ba1\u7b97\u6210\u672c\uff08",(0,t.jsx)(e.code,{children:"10"}),"\uff09\uff0c\u53ef\u4ee5\u8c03\u6574\u4e3a ",(0,t.jsx)(e.code,{children:"bcrypt.MinCost"}),"\uff08\u8f83\u5feb\uff09\u6216 ",(0,t.jsx)(e.code,{children:"bcrypt.MaxCost"}),"\uff08\u66f4\u5b89\u5168\u4f46\u66f4\u6162\uff09\u3002"]}),"\n",(0,t.jsxs)(e.li,{children:["\u751f\u6210\u7684\u54c8\u5e0c\u5bc6\u7801\u4f1a\u81ea\u52a8\u5305\u542b ",(0,t.jsx)(e.code,{children:"bcrypt"})," \u7248\u672c\u3001\u6210\u672c\u56e0\u5b50\u548c\u76d0\u503c\u3002"]}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h3,{id:"32-\u6821\u9a8c\u5bc6\u7801",children:"3.2 \u6821\u9a8c\u5bc6\u7801"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"golang.org/x/crypto/bcrypt"\n)\n\nfunc main() {\n\tpassword := "my_secure_password"\n\thashedPassword := "$2a$10$P8HU5POQ9mC9dp5BqGkgYOdxz9b7zRbhq2bEn5B2c5rYrXsEoaQve" // \u4e4b\u524d\u5b58\u50a8\u7684\u54c8\u5e0c\n\n\t// \u9a8c\u8bc1\u5bc6\u7801\n\terr := bcrypt.CompareHashAndPassword([]byte(hashedPassword), []byte(password))\n\tif err != nil {\n\t\tfmt.Println("Password incorrect")\n\t} else {\n\t\tfmt.Println("Password correct")\n\t}\n}\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u8bf4\u660e"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"bcrypt.CompareHashAndPassword(hashedPassword, password)"})," \u9a8c\u8bc1\u5bc6\u7801\u662f\u5426\u5339\u914d\u54c8\u5e0c\u503c\u3002"]}),"\n",(0,t.jsxs)(e.li,{children:["\u5982\u679c\u5bc6\u7801\u5339\u914d\uff0c\u8fd4\u56de ",(0,t.jsx)(e.code,{children:"nil"}),"\uff0c\u5426\u5219\u8fd4\u56de ",(0,t.jsx)(e.code,{children:"error"}),"\u3002"]}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h3,{id:"33-\u4fee\u6539\u5bc6\u7801",children:"3.3 \u4fee\u6539\u5bc6\u7801"}),"\n",(0,t.jsx)(e.p,{children:"\u8981\u4fee\u6539\u5bc6\u7801\uff0c\u76f4\u63a5\u751f\u6210\u65b0\u54c8\u5e0c\u5e76\u5b58\u50a8\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-go",children:'newPassword := "new_secure_password"\nnewHashedPassword, _ := bcrypt.GenerateFromPassword([]byte(newPassword), bcrypt.DefaultCost)\nfmt.Println("Updated Hashed Password:", string(newHashedPassword))\n'})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h3,{id:"34-\u786e\u5b9a\u54c8\u5e0c\u662f\u5426\u9700\u8981\u66f4\u65b0",children:"3.4 \u786e\u5b9a\u54c8\u5e0c\u662f\u5426\u9700\u8981\u66f4\u65b0"}),"\n",(0,t.jsxs)(e.p,{children:["\u5982\u679c\u54c8\u5e0c\u5bc6\u7801\u7684\u6210\u672c\u8fc7\u4f4e\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,t.jsx)(e.code,{children:"bcrypt.Cost()"})," \u786e\u5b9a\u662f\u5426\u9700\u8981\u66f4\u65b0\uff1a"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-go",children:'cost, err := bcrypt.Cost([]byte(hashedPassword))\nif err == nil && cost < bcrypt.DefaultCost {\n\tfmt.Println("Password hash is outdated, consider updating")\n}\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u76d1\u6d4b\u54c8\u5e0c\u6210\u672c\u5e76\u5347\u7ea7"})}),"\n",(0,t.jsxs)(e.p,{children:["\u5982\u679c ",(0,t.jsx)(e.code,{children:"bcrypt.Cost"})," \u8fd4\u56de\u7684\u503c\u5c0f\u4e8e\u5f53\u524d\u63a8\u8350\u503c\uff08\u5982 ",(0,t.jsx)(e.code,{children:"12"}),"\uff09\uff0c\u5219\u9700\u8981\u91cd\u65b0\u54c8\u5e0c\u5bc6\u7801\uff1a"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-go",children:'const recommendedCost = 12\n\nfunc upgradePasswordHash(storedHash string, password string) string {\n\tcost, err := bcrypt.Cost([]byte(storedHash))\n\tif err != nil {\n\t\tfmt.Println("Error getting cost:", err)\n\t\treturn storedHash\n\t}\n\n\t// \u5982\u679c\u6210\u672c\u56e0\u5b50\u8fc7\u4f4e\uff0c\u5219\u91cd\u65b0\u751f\u6210\u54c8\u5e0c\n\tif cost < recommendedCost {\n\t\tnewHash, err := bcrypt.GenerateFromPassword([]byte(password), recommendedCost)\n\t\tif err != nil {\n\t\t\tfmt.Println("Error upgrading hash:", err)\n\t\t\treturn storedHash\n\t\t}\n\t\tfmt.Println("Password hash upgraded.")\n\t\treturn string(newHash)\n\t}\n\n\treturn storedHash\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"4-\u9002\u7528\u573a\u666f",children:"4. \u9002\u7528\u573a\u666f"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"\u573a\u666f"}),(0,t.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"\u7528\u6237\u5bc6\u7801\u5b58\u50a8"}),(0,t.jsx)(e.td,{children:"\u5b89\u5168\u5b58\u50a8\u7528\u6237\u5bc6\u7801\uff0c\u9632\u6b62\u660e\u6587\u6cc4\u9732"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"\u5bc6\u7801\u9a8c\u8bc1"}),(0,t.jsx)(e.td,{children:"\u5728\u7528\u6237\u767b\u5f55\u65f6\u8fdb\u884c\u54c8\u5e0c\u5339\u914d"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"\u5bc6\u7801\u66f4\u65b0"}),(0,t.jsx)(e.td,{children:"\u68c0\u6d4b\u54c8\u5e0c\u662f\u5426\u8fc7\u65f6\uff0c\u5e76\u91cd\u65b0\u52a0\u5bc6"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"\u9632\u6b62\u66b4\u529b\u7834\u89e3"}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"bcrypt"})," \u8ba1\u7b97\u5f00\u9500\u9ad8\uff0c\u80fd\u6709\u6548\u963b\u6b62\u66b4\u529b\u653b\u51fb"]})]})]})]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"5-\u603b\u7ed3",children:"5. \u603b\u7ed3"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"bcrypt.GenerateFromPassword()"})})," \u751f\u6210\u54c8\u5e0c\u5bc6\u7801\u3002"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"bcrypt.CompareHashAndPassword()"})})," \u9a8c\u8bc1\u5bc6\u7801\u3002"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"bcrypt.Cost()"})})," \u68c0\u67e5\u54c8\u5e0c\u6210\u672c\uff0c\u786e\u5b9a\u662f\u5426\u9700\u8981\u5347\u7ea7\u3002"]}),"\n"]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:["Linux ",(0,t.jsx)(e.code,{children:"/etc/shadow"})," \u5b58\u50a8\u7684\u662f\u52a0\u5bc6\u540e\u7684\u5bc6\u7801\u54c8\u5e0c\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"$<\u52a0\u5bc6\u7b97\u6cd5>$<\u6210\u672c\u56e0\u5b50\u6216\u8fed\u4ee3\u6b21\u6570>$<salt+hash>\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u5e38\u89c1\u7684\u52a0\u5bc6\u7b97\u6cd5\uff1a"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"$1$"}),"  \u2192 MD5"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"$2a$"})," / ",(0,t.jsx)(e.code,{children:"$2b$"})," / ",(0,t.jsx)(e.code,{children:"$2y$"}),"  \u2192 ",(0,t.jsx)(e.strong,{children:"bcrypt"})]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"$5$"}),"  \u2192 SHA-256"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"$6$"}),"  \u2192 SHA-512"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u793a\u4f8b\uff08bcrypt\uff09\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"$2y$10$XGnVZqM9JpWcPKCqGRBBtuNA7E6x2ZK.7JsZh9y1X1Ij0wY2brJve\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"$2y$"}),"  \u2192 \u4f7f\u7528 ",(0,t.jsx)(e.strong,{children:"bcrypt"})," \u52a0\u5bc6"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"10"}),"  \u2192 \u8ba1\u7b97\u6210\u672c\uff08cost factor\uff09"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"XGnVZqM9JpWcPKCqGRBBtu"}),"  \u2192 \u76d0\uff08salt\uff09"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"NA7E6x2ZK.7JsZh9y1X1Ij0wY2brJve"}),"  \u2192 \u54c8\u5e0c\u540e\u7684\u5bc6\u7801"]}),"\n"]}),"\n"]})]})}function a(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(h,{...n})}):h(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>c,x:()=>l});var s=r(6540);const t={},d=s.createContext(t);function c(n){const e=s.useContext(d);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:c(n.components),s.createElement(d.Provider,{value:e},n.children)}}}]);